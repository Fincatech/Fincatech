let empleadoCore={Empresa:Object(),empresa:Object(),Model:{Empleado:Object(),Empleados:Object(),get:async function(idEmpleado,callback){await apiFincatech.get(`empleado/${idEmpleado}`).then(result=>{if(console.log("----"),result){var datosEmpleado=JSON.parse(result);return empleadoCore.Model.Empleado=datosEmpleado.data.Empleado[0],callback(),!0}return CoreUI.Modal.Error("No se ha podido recuperar la información del empleado","Error"),!1})},getAll:function(idEmpresa=null,idComunidad=null){},save:function(){core.Forms.Save(!0)}},init:async function(){this.events(),$("#listadoEmpleado").length&&empleadoCore.renderTabla(),empleadoCore.renderTablaEmpresasEmpleado(core.modelId),$(".titulo-modulo").length&&"Empleado"==core.model&&CoreUI.setTitulo("nombre")},events:async function(){$("body").on(core.helper.clickEventType,".btnEliminarEmpleado",evt=>{evt.stopImmediatePropagation(),empleadoCore.eliminar($(evt.currentTarget).attr("data-id"),$(evt.currentTarget).attr("data-nombre"))}),$("body").on(core.helper.clickEventType,".btnNuevoEmpleadoComunidad",(function(evt){"get"==core.actionModel?"-1"==core.Modelo.entity.Comunidad[0].idspa||null==core.Modelo.entity.Comunidad[0].idspa?CoreUI.Modal.Error("Para dar de alta un empleado debe asignar primero un SPA a la comunidad","Comunidad sin SPA asignado",(function(){Swal.close()})):empleadoCore.mostrarModalNuevoEmpleado():CoreUI.Modal.Info("Para dar de alta un empleado en esta comunidad, primero debe guardarla","Alta de nuevo empleado")}))},mostrarModalNuevoEmpleado:async function(){apiFincatech.getView("empleado","form").then(resultHTML=>{Swal.fire({text:"",html:resultHTML,grow:"false",width:"120rem",showCancelButton:!0,showConfirmButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:'<i class="bi bi-save mr-2"></i> Guardar',cancelButtonText:'<i class="bi bi-x-circle mr-2"></i> Cancelar',reverseButtons:!0,buttonsStyling:!1,customClass:{actions:"text-center p-3 shadow-inset rounded-pill border-light border-2 bg-white",confirmButton:"btn btnSaveData btn-success shadow d-block pb-2 pt-2 confirmButtonModal",cancelButton:" btn btn-danger btnCancelSave shadow d-block pb-2 pt-2 mr-3 cancelButtonModal",popup:"bg-transparent"},didOpen:function(e){$(".formEmpleadoComunidad #idcomunidad").val(core.modelId),$(".formEmpleadoComunidad .nombreComunidad").text(core.Modelo.entity.Comunidad[0].nombre),core.Forms.getSelectData("Tipopuestoempleado","Tipopuestoempleado.nombre","Tipopuestoempleado.id","","","puestoEmpleadoComunidad",!0).then(()=>{$("body .formEmpleadoComunidad #puestoEmpleadoComunidad").select2({dropdownParent:$(".swal2-container"),theme:"bootstrap4"})}),core.Forms.getSelectData("Provincia","Provincia.Nombre","Provincia.Id","","","provinciaEmpleadoComunidad",!0).then(()=>{$("body .formEmpleadoComunidad #provinciaEmpleadoComunidad").select2({dropdownParent:$(".swal2-container"),theme:"bootstrap4"})}),$(".swal2-container .btnSaveData").removeClass("btnSaveData")},preConfirm:function(e){return!!core.Forms.Validate("formEmpleadoComunidad")||(Swal.showValidationMessage("Debe completar todos los campos marcados como obligatorios"),!1)}}).then(result=>{result.isConfirmed&&(core.Forms.mapDataToSave("formEmpleadoComunidad"),core.Modelo.Insert("empleado",core.Forms.data,!1).then(()=>{window.tablelistadoEmpleadosComunidad.ajax.reload()}))})})},eliminar:function(id,nombre){core.Modelo.Delete("empleado",id,nombre,"listadoEmpleado"),Swal.fire({title:`¿Desea eliminar el empleado:<br>${nombre}?`,text:"Se va a eliminar el empleado y toda la información asociada",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(result=>{result.isConfirmed&&apiFincatech.delete("empleado",id).then(result=>{Swal.fire("Empleado eliminado correctamente","","success"),$("#listadoEmpleado").DataTable().ajax.reload()})})},asignarEmpleadoComunidad:function(idComunidad,idEmpleado){var data=Object();apiFincatech.post("comunidad/"+idComunidad+"/empleado/"+idEmpleado+"/asignar",data).then(result=>{var resultado;"error"==JSON.parse(result).data?CoreUI.Modal.Error("El empleado ya está asignado a esta comunidad","Empleados",(function(){contratista.mostrarModalAsignarEmpleadoComunidad()})):CoreUI.Modal.Success("El empleado ha sido asignado correctamente a esta comunidad","Empleados")})},renderTabla:async function(){if($("#listadoEmpleado").length){CoreUI.tableData.init(),CoreUI.tableData.addColumnRow("listadoEmpleado","documentacionprl"),CoreUI.tableData.addColumn("listadoEmpleado","nombre","Nombre",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleado","numerodocumento","DNI/NIE",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleado","direccion","Dirección",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleado","email","EMAIL",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleado","telefono","TELEFONO",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleado","localidad","Localidad",null,"text-left");var html="data:estado$";CoreUI.tableData.addColumn("listadoEmpleado",null,"Estado",html);var html='<ul class="nav justify-content-center accionesTabla">';html+=`<li class="nav-item"><a href="${baseURL}empleado/data:id$" class="btnEditarEmpleado d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="edit" class="text-success img-fluid"></i></a></li>`,html+='<li class="nav-item"><a href="javascript:void(0);" class="btnEliminarEmpleado d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="trash-2" class="text-danger img-fluid"></i></li></ul>',CoreUI.tableData.addColumn("listadoEmpleado",null,"",html),CoreUI.tableData.render("listadoEmpleado","Empleado","empleado/list")}},renderTablaEmpresasEmpleado:function(idempleado){if($("#listadoEmpresasEmpleado").length){CoreUI.tableData.init(),CoreUI.tableData.addColumn("listadoEmpresasEmpleado","razonsocial","Empresa",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpresasEmpleado","puesto","Puesto",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpresasEmpleado","fechaalta","Fecha alta",null,"text-center","80px"),CoreUI.tableData.addColumn("listadoEmpresasEmpleado","fechabaja","Fecha baja",null,"text-center","80px");var html="data:estado$";CoreUI.tableData.addColumn("listadoEmpresasEmpleado",null,"Estado",html,"text-center","90px"),CoreUI.tableData.render("listadoEmpresasEmpleado","Empresasempleado",`empleado/${idempleado}/empresas`,!1,!1,!1)}},renderTablaEmpleadosComunidad:function(idcomunidad){if($("#listadoEmpleadosComunidad").length&&void 0!==idcomunidad&&""!=idcomunidad&&null!=idcomunidad){CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumnRow("listadoEmpleadosComunidad","documentacionprl"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad",(function(row,type,val,meta){var icono='<i class="bi bi-shop pr-2"></i>',clase="";return"Comunidad"==row.tipoempleado&&(icono='<i class="bi bi-building pr-2"></i>',clase="text-info"),`<span class="text-uppercase ${clase}">${icono} <span style="font-size: 12px;">${row.tipoempleado}</span></span>`}),"Contratación",null,"text-center","100px"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","razonsocial","Empresa / Comunidad",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","nombre","Nombre y apellidos",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","puesto","Puesto",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","email","Correo electrónico",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","fechaalta","Fecha alta",null,"text-center","80px"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","fechabaja","Fecha baja",null,"text-center","80px"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad",(function(row,type,val,meta){var iDoc=0,iDocAdjuntos=0;for(i=0;i<row.documentacionprl.length;i++)iDoc++,null!=row.documentacionprl[i].idficherorequerimiento&&iDocAdjuntos++;var icono='<i class="bi bi-x-circle text-danger" style="font-size:24px;"></i>';return iDocAdjuntos==iDoc&&(icono='<i class="bi bi-check2-square text-success" style="font-size:24px;"></i>'),`<p class="m-0 text-center">${icono}</p>`}),"DOC. ADJUNTADA",null,"text-center");var html="data:estado$";CoreUI.tableData.addColumn("listadoEmpleadosComunidad",null,"Estado",html,"text-center","80px"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad",(function(row,type,val,meta){var salida="";return"Comunidad"==row.tipoempleado&&(salida=`<ul class="nav justify-content-center accionesTabla">\n                                        <li class="nav-item">\n                                            <a href="${baseURL}empleado/${row.idempleado}" class="btnEditarEmpleado d-inline-block" data-id="${row.idempleado}" data-nombre="${row.nombre}"><i data-feather="edit" class="text-success img-fluid mr-2"></i></a>\n                                        </li>\n                                        <li class="nav-item">\n                                            <a href="javascript:void(0);" class="btnEliminarEmpleado d-inline-block" data-id="${row.idempleado}" data-nombre="${row.nombre}"><i data-feather="trash-2" class="text-danger img-fluid"></i></a>\n                                        </li>\n                                </ul>`),salida}),"&nbsp;",null,"text-center","70px"),$("#listadoEmpleadosComunidad").addClass("no-clicable"),CoreUI.tableData.render("listadoEmpleadosComunidad","Empleado",`comunidad/${idcomunidad}/empleados`,!1,!1,!1)}},renderTablaEmpleadosEmpresaComunidad:function(idEmpresa,idComunidad){if($("#listadoEmpleadosComunidad").length&&void 0!==idComunidad&&""!=idComunidad&&null!=idComunidad){CoreUI.tableData.init(),CoreUI.tableData.addColumnRow("listadoEmpleadosComunidad","documentacionprl"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad",(function(row,type,val,meta){var icono='<i class="bi bi-shop pr-2"></i>',clase="";return"Comunidad"==row.tipoempleado&&(icono='<i class="bi bi-building pr-2"></i>',clase="text-info"),`<span class="text-uppercase ${clase}">${icono} <span style="font-size: 12px;">${row.tipoempleado}</span></span>`}),"Contratación",null,"text-center","100px"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","razonsocial","Empresa / Comunidad",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","nombre","Nombre y apellidos",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","puesto","Puesto",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","email","Correo electrónico",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","fechaalta","Fecha alta",null,"text-center","80px"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad","fechabaja","Fecha baja",null,"text-center","80px"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad",(function(row,type,val,meta){var iDoc=0,iDocAdjuntos=0;if(row.Empleados){for(i=0;i<row.documentacionprl.length;i++)iDoc++,null!=row.documentacionprl[i].idficherorequerimiento&&iDocAdjuntos++;var icono='<i class="bi bi-x-circle text-danger" style="font-size:24px;"></i>';return iDocAdjuntos==iDoc&&(icono='<i class="bi bi-check2-square text-success" style="font-size:24px;"></i>'),`<p class="m-0 text-center">${icono}</p>`}}),"DOC. ADJUNTADA",null,"text-center");var html="data:estado$";CoreUI.tableData.addColumn("listadoEmpleadosComunidad",null,"Estado",html,"text-center","80px"),CoreUI.tableData.addColumn("listadoEmpleadosComunidad",(function(row,type,val,meta){var salida="";return"Comunidad"==row.tipoempleado&&(salida=`<ul class="nav justify-content-center accionesTabla">\n                                    <li class="nav-item">\n                                        <a href="${baseURL}empleado/${row.idempleado}" class="btnEditarEmpleado d-inline-block" data-id="${row.idempleado}" data-nombre="${row.nombre}"><i data-feather="edit" class="text-success img-fluid mr-2"></i></a>\n                                    </li>\n                                    <li class="nav-item">\n                                        <a href="javascript:void(0);" class="btnEliminarEmpleado d-inline-block" data-id="${row.idempleado}" data-nombre="${row.nombre}"><i data-feather="trash-2" class="text-danger img-fluid"></i></a>\n                                    </li>\n                            </ul>`),salida}),"&nbsp;",null,"text-center","70px"),$("#listadoEmpleadosComunidad").addClass("no-clicable"),CoreUI.tableData.render("listadoEmpleadosComunidad","Empleado",`empresa/${idEmpresa}/comunidad/${idComunidad}/empleados`,!1,!1,!1)}},renderTablaDocumentacionEmpleado:function(idEmpleado,tablaDestino){$(`#${tablaDestino}`).length?documentalCore.CAE.renderTablaDocumentacionEmpleado(idEmpleado,tablaDestino):console.log("No hay tabla sobre la que renderizar")}};$(()=>{empleadoCore.init()});