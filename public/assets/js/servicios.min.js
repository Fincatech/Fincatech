let serviciosCore={servicios:Object(),servicio:Object(),caeContratado:!1,rgpdContratado:!1,Model:{actualizarServicios:function(){var dataServicios=Object();dataServicios.type="bulk",dataServicios.servicesdata=[],$("body #listadoServiciosContratadosComunidades tbody tr").each((function(){let comunidadId=$(this).attr("data-idcomunidad"),fila=$(this);$(this).find(".servicio_contratado").each((function(){let idServicio=$(this).attr("data-id"),idTipoServicio=$(this).attr("data-idtiposervicio"),sTipoServicio=$(this).attr("data-tipo"),servicio=Object();servicio.idcomunidad=comunidadId,servicio.id=idServicio,servicio.idtiposervicio=idTipoServicio,servicio.contratado=!!$(this).is(":checked"),servicio.mesfacturacion=$(fila).find(`.mes-facturacion-${sTipoServicio} option:selected`).val(),servicio.precio=$(fila).find(`.precio-${sTipoServicio}`).val(),servicio.preciocomunidad=$(fila).find(`.precio-comunidad-${sTipoServicio}`).val(),dataServicios.servicesdata.push(servicio)}))})),dataServicios.servicesdata.length>0&&apiFincatech.put("servicios/0",dataServicios).then(result=>{var data=JSON.parse(result);console.log(data),CoreUI.Modal.Success("Los servicios modificados se han actualizado satisfactoriamente","Actualización de Servicios Contratados",(function(){comunidadesCore.Render.tablaServiciosContratadosComunidades()}))})}},init:async function(){serviciosCore.events(),await serviciosCore.renderServicios()},events:function(){$("body").on(core.helper.clickEventType,".btnGuardarPreciosServicios",(function(e){serviciosCore.Model.actualizarServicios()}))},eliminar:function(id,nombre){},mapServiciosContratados:function(){core.Forms.data.comunidadservicioscontratados=[],$("body .dataServicioContratado").each((function(){var servicioContratado=0,servicioID=$(this).attr("data-idservicio"),servicioComunidadId=$(this).attr("data-idserviciocomunidad"),servicioPrecio=0,servicioPrecioComunidad=0,servicioMesFacturacion=12;servicioContratado=$(this).find(".servicioContratado").is(":checked")?1:0,servicioPrecio=$(this).find(".servicioPrecio").val(),servicioMesFacturacion=$(this).find(".servicio-mesfacturacion option:selected").val(),servicioPrecioComunidad=$(this).find(".servicioPrecioComunidad").val(),infoServicio=Object(),infoServicio.idserviciocomunidad=servicioComunidadId,infoServicio.idcomunidad=core.modelId,infoServicio.idservicio=servicioID,infoServicio.precio=servicioPrecio,infoServicio.preciocomunidad=servicioPrecioComunidad,infoServicio.contratado=servicioContratado,infoServicio["servicio-mesfacturacion"]=""==servicioMesFacturacion?"12":servicioMesFacturacion,core.Forms.data.comunidadservicioscontratados.push(infoServicio)}))},addServiceToTable:function(servicioData,idServicioComunidad,fullInfo=!1){var checked=1==servicioData.contratado?' checked="checked" ':"";if(fullInfo){var retorno=parseFloat(servicioData.preciocomunidad)-parseFloat(servicioData.precio),html=`\n            <tr class="dataServicioContratado" data-idservicio="${servicioData.id}" data-idserviciocomunidad="${idServicioComunidad}">\n                <td class="mb-0 pb-0">\n                    <div class="form-check">\n                    <input type="hidden" class="data" hs-entity-related="comunidadservicioscontratados" hs-entity="Comunidad" hs-field="idservicio" value="${servicioData.id}">\n                        <input class="form-check-input servicioContratado" type="checkbox" ${checked} value="${servicioData.id}" data-id="${servicioData.id}" id="id-${servicioData.id}">\n                        <label class="form-check-label" for="id-${servicioData.id}">${servicioData.nombre}</label>\n                    </div>\n                </td>\n                <td class="mb-0 pb-0">\n                    <input type="number" class="form-control text-center data servicioPrecio" maxlength="6" hs-entity-related="comunidadservicioscontratados" hs-entity="Comunidad" hs-field="precio" value="${servicioData.precio}">\n                </td>\n                <td class="mb-0 pb-0">\n                    <input type="number" class="form-control text-center data servicioPrecioComunidad" maxlength="6" hs-entity-related="comunidadservicioscontratados" hs-entity="Comunidad" hs-field="preciocomunidad" value="${servicioData.preciocomunidad}">\n                </td>\n                <td class="mb-0 pb-0 text-center">\n                    <select id="mesfacturacion-${servicioData.id}" name="mesfacturacion-${servicioData.id}" class=" servicio-mesfacturacion custom-select select-picker form-control w-100">\n                        <option value="1" ${1==servicioData.mesfacturacion?"selected":""}>Enero</option>\n                        <option value="2" ${2==servicioData.mesfacturacion?"selected":""}>Febrero</option>\n                        <option value="3" ${3==servicioData.mesfacturacion?"selected":""}>Marzo</option>\n                        <option value="4" ${4==servicioData.mesfacturacion?"selected":""}>Abril</option>\n                        <option value="5" ${5==servicioData.mesfacturacion?"selected":""}>Mayo</option>\n                        <option value="6" ${6==servicioData.mesfacturacion?"selected":""}>Junio</option>\n                        <option value="7" ${7==servicioData.mesfacturacion?"selected":""}>Julio</option>\n                        <option value="8" ${8==servicioData.mesfacturacion?"selected":""}>Agosto</option>\n                        <option value="9" ${9==servicioData.mesfacturacion?"selected":""}>Septiembre</option>\n                        <option value="10" ${10==servicioData.mesfacturacion?"selected":""}>Octubre</option>\n                        <option value="11" ${11==servicioData.mesfacturacion?"selected":""}>Noviembre</option>\n                        <option value="12" ${12==servicioData.mesfacturacion?"selected":""}>Diciembre</option>\n                    </select>          \n                </td>\n                <td class="mb-0 pb-0 text-right">\n                    <label class="retorno badge bg-success badge-pill text-white font-weight-normal d-block text-right" style="font-size: 16px;">${retorno.toFixed(2)}€</label>\n                </td>\n            </tr>\n            `;$("body .form-servicioscontratados table tbody").append(html)}else{var iconoEstadoServicio=0==servicioData.contratado||void 0===servicioData.contratado?'<i class="bi bi-x-circle text-danger" style="font-size:21px;"></i>':'<i class="bi bi-check-circle text-success" style="font-size:21px;"></i>',html=`\n            <tr>\n                <td class="mb-0 pb-0">\n                        <label class="form-check-label">${servicioData.nombre}</label>\n                </td>\n                <td class="mb-0 pb-0 text-center">${iconoEstadoServicio}</td>\n            </tr>\n        `;$("body .form-servicioscontratados-info table tbody").append(html)}},renderServicios:async function(){var rol,endpointServicios="";switch($("body").attr("hs-role")){case"SUDO":if($(".form-servicioscontratados").length){switch(core.actionModel){case"add":endpointServicios="servicios/list",nombreEntidad="Tiposservicios",_isAdding=!0;break;case"get":endpointServicios=`comunidad/${core.modelId}/servicioscontratados`,nombreEntidad="comunidadservicioscontratados",_isAdding=!1}await apiFincatech.get(endpointServicios).then(data=>{for(result=JSON.parse(data),responseStatus=result.status,_isAdding?responseData=result.data:responseData=result.data.Comunidad[0],$("body .form-servicioscontratados table tbody").html(""),x=0;x<responseData[nombreEntidad].length;x++){var idServicioComunidad="";void 0!==responseData[nombreEntidad][x].idserviciocomunidad&&(idServicioComunidad=responseData[nombreEntidad][x].idserviciocomunidad),serviciosCore.addServiceToTable(responseData[nombreEntidad][x],idServicioComunidad,!0)}$(".servicio-mesfacturacion").each((function(){let valor=$(this).children("option:selected").val();console.log($(this).attr("id")," - ",valor),$(this).select2({theme:"bootstrap4"}),$(this).val(valor).trigger("change")}))})}break;default:if(void 0===core.modelId||""===core.modelId)return;endpointServicios=`comunidad/${core.modelId}/servicioscontratados`,nombreEntidad="comunidadservicioscontratados",await apiFincatech.get(endpointServicios).then(async data=>{if(result=JSON.parse(data),responseStatus=result.status,responseData=result.data.Comunidad[0],caeContratado=!1,rgpdContratado=!1,certificadoDigitalContratado=!1,"ADMINFINCAS"==core.Security.getRole()&&(void 0!==responseData.comunidadservicioscontratados[0].contratado&&(caeContratado="0"!=responseData.comunidadservicioscontratados[0].contratado),void 0!==responseData.comunidadservicioscontratados[1].contratado&&(certificadoDigitalContratado="0"!=responseData.comunidadservicioscontratados[1].contratado),void 0!==responseData.comunidadservicioscontratados[4].contratado&&(rgpdContratado="0"!=responseData.comunidadservicioscontratados[4].contratado)),"CONTRATISTA"==core.Security.getRole()||"TECNICOCAE"==core.Security.getRole())return $(".enlaceRGPD").remove(),$(".enlaceCertificadoDigital").remove(),$(".btnAsociarEmpresaCAE").remove(),$(".empresasComunidadHeader").remove(),$(".wrapperEmpresasComunidad").remove(),void $(".wrapperEmpleadosEmpresaComunidad").remove();for($(".enlaceCae").removeClass("text-success"),$(".enlaceCae").removeClass("text-danger"),!1===caeContratado?($(".enlaceCae").attr("href","#"),$(".enlaceCae").removeClass("enlaceCae").addClass("enlaceKOCae"),$(".enlaceKOCae").addClass("text-danger")):$(".enlaceCae").addClass("text-success"),$(".enlaceRGPD").removeClass("text-success"),$(".enlaceRGPD").removeClass("text-danger"),!1===rgpdContratado?($(".enlaceRGPD").attr("href","#"),$(".enlaceRGPD").removeClass("enlaceRGPD").addClass("enlaceKORGPD"),$(".enlaceKORGPD").addClass("text-danger")):$(".enlaceRGPD").addClass("text-success"),!1===certificadoDigitalContratado?($(".enlaceCertificadoDigital").attr("href","#"),$(".enlaceCertificadoDigital").removeClass("enlaceCertificadoDigital").addClass("enlaceKOCertificadoDigital"),$(".enlaceKOCertificadoDigital").addClass("text-danger")):$(".enlaceCertificadoDigital").addClass("text-success"),$("body .form-servicioscontratados-info table tbody").html(""),x=0;x<responseData[nombreEntidad].length;x++){var idServicioComunidad="";serviciosCore.addServiceToTable(responseData[nombreEntidad][x],null,!1)}$(".servicio-mesfacturacion").each((function(){let valor=$(this).children("option:selected").val();console.log($(this).attr("id")," - ",valor),$(this).select2({theme:"bootstrap4"}),$(this).val(valor).trigger("change")}))})}},getSpa:async function(id){await apiFincatech.get("spa/"+id).then(data=>(result=JSON.parse(data),responseStatus=result.status,responseData=result.data,serviciosCore.spa=responseData.Spa[0],serviciosCore.spa))},getAll:async function(){await apiFincatech.get("servicios/list").then(async data=>{result=JSON.parse(data),responseStatus=result.status,responseData=result.data,serviciosCore.servicios=responseData.Tiposservicios,serviciosCore.servicios.total=serviciosCore.Tiposservicios.length})},Render:{Meses:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],ServiceInfo:function(serviceName,serviceId,serviceStatus,comunidadId,tipoServicioId,mesFacturacion,precio,precioComunidad){let htmlTR;return htmlTR=`\n                <td class="bg-white text-center">\n                    ${serviciosCore.Render.StatusCheckbox(serviceName,serviceId,comunidadId,tipoServicioId,serviceStatus)}\n                </td>\n                <td class="bg-white text-center pl-2 pr-2">\n                    ${serviciosCore.Render.MonthSelect(serviceName,comunidadId,tipoServicioId,serviceId,mesFacturacion)}\n                </td>\n                <td class="bg-white text-right pl-3 pr-3">\n                    ${serviciosCore.Render.InputPrecioPVP(serviceName,serviceId,comunidadId,tipoServicioId,precio)}\n                </td>\n                <td class="bg-white text-right pl-3 pr-3">\n                    ${serviciosCore.Render.InputPrecioComunidad(serviceName,serviceId,comunidadId,tipoServicioId,precioComunidad)}\n                </td>\n            `,htmlTR},StatusCheckbox:function(serviceName,serviceId,comunidadId,tipoServicioId,serviceStatus){let htmlCB;return`\n                <input data-id="${serviceId}" data-idcomunidad="${comunidadId}" data-idtiposervicio="${tipoServicioId}" data-tipo="${serviceName}" class="servicio_contratado servicio-contratado-${serviceId}" type="checkbox" ${serviceStatus}>\n            `},MonthSelect:function(serviceName,comunidadId,tipoServicioId,serviceId,value){let htmlOptions,htmlSelect=`<select data-idcomunidad="${comunidadId}" data-id="${serviceId}" data-idtiposervicio="${tipoServicioId}" class=" servicio-mesfacturacion mes-facturacion-${serviceId} mes-facturacion-${serviceName} custom-select select-picker form-control w-100" style="width: 150px;">`;for(let iMonth=1;iMonth<13;iMonth++)htmlOptions=`${htmlOptions}\n                    <option value="${iMonth}" ${value==iMonth?"selected":""}>${serviciosCore.Render.Meses[iMonth-1]}</option>\n                `;return htmlSelect=`${htmlSelect}${htmlOptions}</select>`,htmlSelect},InputPrecioPVP:function(serviceName,serviceId,comunidadId,tipoServicioId,precio){let htmlPrecioPVP;return htmlPrecioPVP=`\n            <input data-id="${serviceId}" data-idcomunidad="${comunidadId}" data-idtiposervicio="${tipoServicioId}" type="number" class="servicio_precio precio-${serviceId} precio-${serviceName} text-right" style="max-width:70px;" data-precio="precio" data-servicio="instalaciones" value="${precio}">\n            `,htmlPrecioPVP},InputPrecioComunidad:function(serviceName,serviceId,comunidadId,tipoServicioId,precio){let htmlPrecioComunidad;return htmlPrecioComunidad=`\n            <input data-id="${serviceId}" data-idcomunidad="${comunidadId}" data-idtiposervicio="${tipoServicioId}" type="number" class="servicio_precio precio-comunidad-${serviceId} precio-comunidad-${serviceName} text-right" style="max-width:70px;" data-precio="comunidad" data-servicio="rgpd" value="${precio}">            \n            `,htmlPrecioComunidad}}};$(()=>{serviciosCore.init()});