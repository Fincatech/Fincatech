let tecnicoRevision={Init:function(){tecnicoRevision.Events(),$("body #listadoDocumentosPendientesVerificacion").length>0&&tecnicoRevision.GUI.RenderTablaDocumentosPendientesVerificacion()},Events:function(){$("body").on(core.helper.clickEventType,".btnCambiarEstadoRequerimiento",(function(ev){tecnicoRevision.Model.entidad=$(this).attr("entidad"),tecnicoRevision.Model.id=$(this).attr("entidad"),tecnicoRevision.Model.caduca=$(this).attr("caduca"),tecnicoRevision.GUI.ModalRevisionRequerimiento($(this).attr("data-rowid"),$(this).attr("data-nombrefichero"))})),$("body").on(core.helper.clickEventType,".btnGuardarCambioEstadoDocumento",(function(ev){var resultado=tecnicoRevision.Model.ValidarEstadoRequerimiento();if($("body .mensajeError").html(""),""==resultado){var _idEstado=$("body input[name=rbEstado]:checked").val(),_Observaciones=$("body .observacionesRechazo").val(),_fechaCaducidad=$("body .fechaCaducidad").val();documentalCore.Crud.cambiarEstadoRequerimiento(tecnicoRevision.Model.documentoSeleccionado,_idEstado,_Observaciones,_fechaCaducidad)}else $("body .mensajeError").html("Errores detectados:<br><br>"+resultado)}))},Model:{entidad:null,id:null,caduca:null,comunidad:null,documentoSeleccionado:Object(),CambiarEstadoRequerimiento:function(_entidad,_idrequerimiento){},ValidarEstadoRequerimiento:function(){var resultado="";if(1==tecnicoRevision.Model.documentoSeleccionado.caduca){var fechaCaducidad=$("body .fechaCaducidad").val(),fechaActual=(new moment).format("YYYY-MM-DD");if(""==fechaCaducidad)resultado+="La Fecha de caducidad no puede estar vacía<br>";else{var given=moment($("body .fechaCaducidad").val(),"YYYY-MM-DD"),current=moment().startOf("day"),duration=moment.duration(given.diff(current)).asDays();duration<0&&(resultado+="La fecha de caducidad no puede ser inferior a la actual<br>"),duration>=0&&duration<10&&(resultado+="La fecha de caducidad no puede ser inferior a 10 días vista<br>")}}return"7"==$("body input[name=rbEstado]:checked").val()&&""==$("body .observacionesRechazo").val()&&(resultado+="Observaciones del motivo de rechazo"),resultado}},GUI:{RenderTablaDocumentosPendientesVerificacion:async function(){$("#listadoDocumentosPendientesVerificacion").length&&(CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoDocumentosPendientesVerificacion",(function(row,type,val,meta){return moment(row.created).locale("es").format("L")}),"Fecha de subida",null,"text-center"),CoreUI.tableData.addColumn("listadoDocumentosPendientesVerificacion",(function(row,type,val,meta){var fechaCaducidad;return row.fechacaducidad?moment(row.fechacaducidad).locale("es").format("L"):"N/D"}),"Fecha de caducidad",null,"text-center"),CoreUI.tableData.addColumn("listadoDocumentosPendientesVerificacion","nombrerequerimiento","Nombre Requerimiento",null,"text-justify"),CoreUI.tableData.addColumn("listadoDocumentosPendientesVerificacion","nombreempresa","Empresa",null,"text-justify"),CoreUI.tableData.addColumn("listadoDocumentosPendientesVerificacion","nombreempleado","Empleado",null,"text-justify"),CoreUI.tableData.addColumn("listadoDocumentosPendientesVerificacion","comunidad","Comunidad",null,"text-justify"),CoreUI.tableData.addColumn("listadoDocumentosPendientesVerificacion","cif","NIF/CIF",null,"text-justify"),CoreUI.tableData.addColumn("listadoDocumentosPendientesVerificacion",(function(row,type,val,meta){var enlaceSalida,ruta="";return row.nombrestorage.indexOf(".doc")>0&&(ruta="https://view.officeapps.live.com/op/embed.aspx?src="),enlaceSalida=`<p class="text-center mb-0"><a href="javascript:void(0);" data-rowid="${meta.row}" data-idrelacionrequerimiento="${row.idrelacionrequerimiento}" data-caduca="${row.caduca}" data-entidad="${row.entidad}" data-nombrefichero="${ruta}${config.baseURL+"public/storage/"+row.nombrestorage}" data-nombrestorage="${row.nombrefichero}" class="text-center small btnCambiarEstadoRequerimiento"><i class="bi bi-file-earmark-diff text-success" style="font-size:26px;"></i></a></p>`}),"Acción",null,"text-center"),$("#listadoDocumentosPendientesVerificacion").addClass("no-clicable"),await CoreUI.tableData.render("listadoDocumentosPendientesVerificacion","Requerimiento","revision/pendientes",null,!1,!1))},ModalRevisionRequerimiento:function(_rowId,rutaFichero){apiFincatech.getView("modals","modal_revision_requerimiento").then(result=>{CoreUI.Modal.CustomHTML(result,null,null,"90%");var datos=window.tablelistadoDocumentosPendientesVerificacion.row(_rowId).data();tecnicoRevision.Model.documentoSeleccionado=datos,$("body .visorDocumento").attr("src",rutaFichero),""!=datos.comunidad&&datos.comunidad?$("body .datosValidacion .nombreComunidad").text(datos.comunidad):(console.log("no tiene comunidad"),$("body .wrapperComunidad").hide()),""!=datos.nombreempresa?$("body .datosValidacion .nombreEmpresa").text(datos.nombreempresa):$("body .wrapperEmpresa").hide(),""!=datos.nombreempleado?$("body .datosValidacion .nombreEmpleado").text(datos.nombreempleado):$("body .wrapperEmpleado").hide(),$("body .datosValidacion .nombreDocumento").text(datos.nombrerequerimiento),0==datos.caduca?$("body .wrapperFechaCaducidad").hide():$("body .datosValidacion .fechaCaducidad").text(datos.fechacaducidad),$("body .datosValidacion .cif").text(datos.cif)})}}};$(()=>{tecnicoRevision.Init()});