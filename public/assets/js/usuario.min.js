let usuarioCore={usuarios:Object(),usuario:Object(),init:async function(){usuarioCore.events(),"list"==core.actionModel&&"usuario"==core.model.toLowerCase()&&await usuarioCore.listadoDashboard(),!$(".titulo-modulo").length||"Usuario"!=core.model&&"Autorizado"!=core.model||CoreUI.setTitulo("nombre"),usuarioCore.Autorizado.init()},events:function(){$("body").on(core.helper.clickEventType,".btnVerUsuario",(a=>{a.stopImmediatePropagation(),usuarioCore.verModalAdministrador($(a.currentTarget).attr("data-id"),$(a.currentTarget).attr("data-nombre"))})),$("body").on(core.helper.clickEventType,".btnEliminarUsuario",(a=>{a.stopImmediatePropagation(),usuarioCore.eliminar($(a.currentTarget).attr("data-id"),$(a.currentTarget).attr("data-nombre"))}))},eliminar:function(a,o){core.Modelo.Delete("usuario",a,o,"listadoUsuario")},verModalAdministrador:async function(a){usuarioCore.getAdministrador(a).then((a=>{a,apiFincatech.getView("modals","administradores/modal_info").then((o=>{a=CoreUI.Utils.parse(o,usuarioCore.comunidad),CoreUI.Modal.GetHTML("modalInfoComunidad",a,usuarioCore.comunidad.nombre)}))}))},renderTabla:async function(){if($("#listadoUsuario").length){CoreUI.tableData.init(),CoreUI.tableData.addColumn("listadoUsuario","nombre","NOMBRE");var a="data:rol.nombre$";CoreUI.tableData.addColumn("listadoUsuario",null,"ROL",a),CoreUI.tableData.addColumn("listadoUsuario","cif","CIF");a='<a href="mailto:data:email$" class="pl-1 pr-1">data:email$</a>';CoreUI.tableData.addColumn("listadoUsuario",null,"EMAIL",a),CoreUI.tableData.addColumn("listadoUsuario","telefono","TELEFONO"),CoreUI.tableData.addColumn("listadoUsuario",(function(a,o,e,t){var r,i;return a.lastlogin?(r=moment(a.lastlogin,"YYYY-MM-DD hh:mm").unix(),i=moment(a.lastlogin).locale("es").format("L")):(r="",i='<span class="badge badge-pill bg-danger text-white">Nunca</span>'),`<span style="display:none;">${r}</span>${i}`}),"Último acceso",null,"text-center");a="data:estado$";CoreUI.tableData.addColumn("listadoUsuario",null,"Estado",a,"text-center");a="data:created$";CoreUI.tableData.addColumn("listadoUsuario",null,"Fecha de alta",a,"text-center");a='<ul class="nav justify-content-center">';a+=`<li class="nav-item"><a href="${baseURL}usuario/data:id$" class="btnEditarUsuario d-inline-block mr-2" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="edit" class="text-success img-fluid" style="height:26px; width:26px;"></i></a></li>`,a+='<li class="nav-item"><a href="javascript:void(0);" class="btnEliminarUsuario d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="trash-2" class="text-danger img-fluid" style="height:26px; width:26px;"></i></li></ul>',CoreUI.tableData.addColumn("listadoUsuario",null,"",a),$("#listadoUsuario").addClass("no-clicable"),CoreUI.tableData.render("listadoUsuario","Usuario","usuario/list")}},listadoDashboard:async function(){await usuarioCore.getAll().then((async a=>{this.renderTabla()}))},getAdministrador:async function(a){await apiFincatech.get("usuario/"+a).then((a=>(result=JSON.parse(a),responseStatus=result.status,responseData=result.data,usuarioCore.comunidad=responseData.Comunidad[0],usuarioCore.comunidad)))},getAll:async function(){await apiFincatech.get("usuario/list").then((async a=>{result=JSON.parse(a),responseStatus=result.status,responseData=result.data,usuarioCore.usuarios=responseData.Usuario}))},Autorizado:{init:function(){usuarioCore.Autorizado.events(),"list"==core.actionModel&&"autorizado"==core.model.toLowerCase()&&usuarioCore.Autorizado.listadoAutorizados(),"add"!=core.actionModel&&"get"!==core.actionModel||"autorizado"!=core.model.toLowerCase()||usuarioCore.Autorizado.comunidadesAsignadas()},events:function(){switch($("body .form-autorizado #nombre").on("keyup",(function(a){CoreUI.Utils.setTituloPantalla(null,null,`${$(this).val()}`)})),$("body .form-autorizado .btnSaveData").off(core.helper.clickEventType).on(core.helper.clickEventType,(function(a){a.stopImmediatePropagation(),a.preventDefault(),usuarioCore.Autorizado.Model.Save()})),$("body").on(core.helper.clickEventType,".btnEliminarUsuarioAutorizado",(function(a){a.stopImmediatePropagation(),usuarioCore.Autorizado.Model.delete($(a.currentTarget).attr("data-id"),$(a.currentTarget).attr("data-nombre"))})),core.actionModel){case"add":case"get":$("body").on("change",".form-autorizado .chkComunidadAutorizada",(function(a){window.tablelistadoComunidadesAutorizado.row($(this).attr("data-row")).data().asignada=$(this).is(":checked")}));break}"add"===core.actionModel&&$(".form-autorizado #password").addClass("form-required")},listadoAutorizados:function(){if($("#listadoUsuariosAutorizados").length){var a="listadoUsuariosAutorizados";CoreUI.tableData.init(),CoreUI.tableData.addColumn(a,"nombre","NOMBRE"),CoreUI.tableData.addColumn(a,"cif","CIF");var o='<a href="mailto:data:email$" class="pl-1 pr-1">data:email$</a>';CoreUI.tableData.addColumn(a,null,"EMAIL",o),CoreUI.tableData.addColumn(a,"telefono","TELEFONO"),CoreUI.tableData.addColumn(a,(function(a,o,e,t){var r,i;return a.lastlogin?(r=moment(a.lastlogin,"YYYY-MM-DD hh:mm").unix(),i=moment(a.lastlogin).locale("es").format("L")):(r="",i='<span class="badge badge-pill bg-danger text-white">Nunca</span>'),`<span style="display:none;">${r}</span>${i}`}),"Último acceso",null,"text-center");o="data:created$";CoreUI.tableData.addColumn(a,null,"Fecha de alta",o,"text-center");o='<ul class="nav justify-content-center">';o+=`<li class="nav-item"><a href="${baseURL}autorizado/data:id$" class="btnEditarUsuario d-inline-block mr-2" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="edit" class="text-success img-fluid" style="height:26px; width:26px;"></i></a></li>`,o+='<li class="nav-item"><a href="javascript:void(0);" class="btnEliminarUsuarioAutorizado d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="trash-2" class="text-danger img-fluid" style="height:26px; width:26px;"></i></li></ul>',CoreUI.tableData.addColumn(a,null,"",o),$("#listadoUsuario").addClass("no-clicable"),CoreUI.tableData.render(a,"Usuario","autorizado/list")}},comunidadesAsignadas:function(){if($("#listadoComunidadesAutorizado").length){var a="listadoComunidadesAutorizado";CoreUI.tableData.init(),CoreUI.tableData.addColumn(a,(function(a,o,e,t){var r="",i=t.row;return!0===a.asignada&&(r="checked"),`\n                            <input id="asignada_${a.id}" name="asignada_${a.id}" type="checkbox" class="form-check-label chkComunidadAutorizada" ${r} data-row=${i}>\n                            <label class="form-check-label ml-2" for="asignada_${a.id}">\n                        `}),"",null,"text-center"),CoreUI.tableData.addColumn(a,"codigo","CÓDIGO"),CoreUI.tableData.addColumn(a,"nombre","NOMBRE");CoreUI.tableData.addColumn(a,null,"Fecha de alta","data:created$","text-center"),$(`#${a}`).addClass("no-clicable");var o="get"===core.actionModel?`autorizado/${core.modelId}/comunidad/list`:"autorizado/comunidad/list";CoreUI.tableData.render(a,"Comunidad",o,null,!1)}},Model:{GetComunidadesAsignadas:function(){let a=Array();$seleccionComunidades=window.tablelistadoComunidadesAutorizado.rows().data();for(let o=0;o<$seleccionComunidades.length;o++){let e=Object();e.idcomunidad=window.tablelistadoComunidadesAutorizado.row(o).data().id,e.asignada=window.tablelistadoComunidadesAutorizado.row(o).data().asignada,a.push(e)}return a},Validate:function(){let a=!1;return core.Forms.Validate(),""!==$(".form-autorizado #email").val()&&(core.Validator.Email($(".form-autorizado #email").val())||core.Forms.SetError("El formato del e-mail no es correcto")),""!==$(".form-autorizado #password").val()&&$(".form-autorizado #password").val()!==$(".form-autorizado #passwordConfirme").val()&&core.Forms.SetError("Las contraseñas no coinciden"),""===core.Forms.GetErrorMessage()&&(a=!0),a},Save:function(){usuarioCore.Autorizado.Model.Validate()?(core.Forms.prepareFormDataBeforeSend("form-autorizado"),core.Forms.data.comunidadesasignadas=usuarioCore.Autorizado.Model.GetComunidadesAsignadas(),core.Forms.Save(!0)):core.Forms.ShowErrorMessage()},add:function(){},update:function(){},delete:function(a,o){core.Modelo.Delete("autorizado",a,o,"listadoUsuariosAutorizados")}}}};$((()=>{usuarioCore.init()}));