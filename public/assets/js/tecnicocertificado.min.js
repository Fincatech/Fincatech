let TecnicoCertificado={Init:function(){TecnicoCertificado.GUI.MostrarListadoDocumentacion(!1),TecnicoCertificado.Events(),TecnicoCertificado.Render.ComunidadesCertificadoSolicitado()},Events:function(){$("body").on(core.helper.clickEventType,"#listadoComunidadesPendientesCertificado tr",(function(e){if(e.stopImmediatePropagation(),TecnicoCertificado.GUI.MostrarListadoDocumentacion(!1),void 0!==$(this).attr("id")){var o=window.tablelistadoComunidadesPendientesCertificado.row($(this).attr("id")).data().id,i=window.tablelistadoComunidadesPendientesCertificado.row($(this).attr("id")).data().nombre;$(".nombreComunidad").text(`[ ${i} ]`),TecnicoCertificado.Render.ComunidadesDocumentacionAportada(o),TecnicoCertificado.Model.comunidad=i,TecnicoCertificado.Model.comunidadId=o}})),$("body").on(core.helper.clickEventType,".btnCambiarEstadoRequerimiento",(function(e){TecnicoCertificado.Model.entidad=$(this).attr("entidad"),TecnicoCertificado.Model.id=$(this).attr("entidad"),TecnicoCertificado.Model.caduca=$(this).attr("caduca"),TecnicoCertificado.GUI.ModalRevisionRequerimiento($(this).attr("data-rowid"),$(this).attr("data-nombrefichero"))})),$("body").on(core.helper.clickEventType,".btnGuardarCambioEstadoDocumento",(function(e){var o=TecnicoCertificado.Validation.EstadoRequerimiento();if($("body .mensajeError").html(""),""==o){var i=$("body input[name=rbEstado]:checked").val(),a=$("body .observacionesRechazo").val(),t=$("body .fechaCaducidad").val();documentalCore.Crud.cambiarEstadoRequerimiento(TecnicoCertificado.Model.documentoSeleccionado,i,a,t),Swal.close(),CoreUI.Modal.Success("El estado del requerimiento se ha modificado correctamente","Revisión documental",(()=>TecnicoCertificado.Validation.DocumentacionObligatoriaAportada(TecnicoCertificado.Model.comunidadId)))}else $("body .mensajeError").html("Errores detectados:<br><br>"+o)})),$("body").on(core.helper.clickEventType,".enlaceComunidades",(function(e){TecnicoCertificado.Render.ComunidadesCertificadoSolicitado()})),$("body").on(core.helper.clickEventType,".enlaceCertificadosPendientes",(function(e){TecnicoCertificado.Render.CertificadosPendientes()})),$("body").on(core.helper.clickEventType,".enlaceCertificadosSolicitados",(function(e){TecnicoCertificado.Render.CertificadosEmitidos()}))},GUI:{ModalRevisionRequerimiento:function(e,o){apiFincatech.getView("modals","modal_revision_certificado").then((i=>{CoreUI.Modal.CustomHTML(i,null,null,"90%");var a=window.tablelistadoComunidadesDocumentosCertificado.row(e).data();TecnicoCertificado.Model.documentoSeleccionado=a,TecnicoCertificado.Model.documentoSeleccionado.entidad="certificadorequerimiento",TecnicoCertificado.Model.documentoSeleccionado.idrelacionrequerimiento=a.idrelacion,$("body .visorDocumento").attr("src",o),""!=TecnicoCertificado.Model.comunidad&&TecnicoCertificado.Model.comunidad?$("body .datosValidacion .nombreComunidad").text(TecnicoCertificado.Model.comunidad):$("body .wrapperComunidad").hide(),$("body .datosValidacion .nombreDocumento").text(a.nombre),0==a.caduca?$("body .wrapperFechaCaducidad").hide():$("body .datosValidacion #fechaCaducidad").val(a.fechacaducidad)}))},MostrarListadoDocumentacion:function(e){$(".infoComunidad").removeClass("d-none"),$("#listadoComunidadesDocumentosCertificado").removeClass("d-none"),e?$(".infoComunidad").addClass("d-none"):($("#listadoComunidadesDocumentosCertificado").addClass("d-none"),$(".nombreComunidad").text(""))}},Model:{entidad:null,id:null,caduca:null,comunidad:null,comunidadId:null,documentoSeleccionado:Object()},Render:{CertificadosPendientes:function(){$("#listadoCertificadosPendientesSolicitud").length&&(CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoCertificadosPendientesSolicitud",(function(e,o,i,a){return e.nombre}),"Comunidad",null,"text-left"),CoreUI.tableData.addColumn("listadoCertificadosPendientesSolicitud",(function(e,o,i,a){return e.administrador}),"Administrador",null,"text-left"),CoreUI.tableData.addColumn("listadoCertificadosPendientesSolicitud",(function(e,o,i,a){return e.tecnicoaprobacion}),"Técnico Operador de Registro",null,"text-left"),CoreUI.tableData.addColumn("listadoCertificadosPendientesSolicitud",(function(e,o,i,a){return moment(e.fechaaprobacion).locale("es").format("L")}),"Fecha de aprobación",null,"text-center"),$("#listadoCertificadosPendientesSolicitud").addClass("no-clicable"),CoreUI.tableData.render("listadoCertificadosPendientesSolicitud","comunidad","certificadodigital/comunidad/pendientessolicitud/list",null,!1,!1))},CertificadosEmitidos:function(){$("#listadoCertificadosEmitidos").length&&(CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoCertificadosEmitidos",(function(e,o,i,a){return e.nombre}),"Comunidad",null,"text-left"),CoreUI.tableData.addColumn("listadoCertificadosEmitidos",(function(e,o,i,a){return e.administrador}),"Representante legal",null,"text-left"),CoreUI.tableData.addColumn("listadoCertificadosEmitidos",(function(e,o,i,a){return e.tecnicoaprobacion}),"Técnico Operador de Registro",null,"text-left"),CoreUI.tableData.addColumn("listadoCertificadosEmitidos",(function(e,o,i,a){return moment(e.fechaaprobacion).locale("es").format("L")}),"Fecha de aprobación",null,"text-center"),CoreUI.tableData.addColumn("listadoCertificadosEmitidos",(function(e,o,i,a){return e.uanatacaid}),"ID Solicitud",null,"text-center"),$("#listadoCertificadosEmitidos").addClass("no-clicable"),CoreUI.tableData.render("listadoCertificadosEmitidos","comunidad","certificadodigital/comunidad/emitidos/list",null,!1,!1))},ComunidadesDocumentacionAportada:async function(e){if($("#listadoComunidadesDocumentosCertificado").length){CoreUI.tableData.init(),CoreUI.tableData.columns=[];CoreUI.tableData.addColumn("listadoComunidadesDocumentosCertificado","requerimiento","Requerimiento",null,"text-justify","30%"),CoreUI.tableData.addColumn("listadoComunidadesDocumentosCertificado",(function(e,o,i,a){var t=e.fechacaducidad;return t?moment(t).locale("es").format("L"):"No caduca"}),"Fecha de caducidad",null,"text-center","30%"),CoreUI.tableData.addColumn("listadoComunidadesDocumentosCertificado",(function(e,o,i,a){return null==e.idficherorequerimiento?'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>':(estadoDocumento=documentalCore.Render.RenderEstadoRequerimiento(e.idestado),estadoDocumento)}),"Estado",null,"text-center","10%"),CoreUI.tableData.addColumn("listadoComunidadesDocumentosCertificado",(function(e,o,i,a){var t="";return e.nombreficherorequerimiento?e.nombreficherorequerimiento.indexOf(".doc")>0&&(t="https://view.officeapps.live.com/op/embed.aspx?src="):t="",`<p class="text-center mb-0"><a href="javascript:void(0);" data-rowid="${a.row}" data-idrelacionrequerimiento="${e.idrelacion}" data-caduca="${e.caduca}" data-entidad="certificadorequerimiento" data-nombrefichero="${t}${config.baseURL+"public/storage/"+e.storageficherorequerimiento}" data-nombrestorage="${e.nombreficherorequerimiento}" class="text-center small btnCambiarEstadoRequerimiento"><i class="bi bi-file-earmark-diff text-success" style="font-size:26px;"></i></a></p>`}),"Acción",null,"text-center"),$("#listadoComunidadesDocumentosCertificado").addClass("no-clicable"),CoreUI.tableData.render("listadoComunidadesDocumentosCertificado","documentacioncertificado",`comunidad/${e}/documentacioncertificado`,!1,!1,!1),TecnicoCertificado.GUI.MostrarListadoDocumentacion(!0)}},ComunidadesCertificadoSolicitado:async function(){$("#listadoComunidadesPendientesCertificado").length&&(CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoComunidadesPendientesCertificado",(function(e,o,i,a){return e.codigo}),"Cód.",null,"text-left"),CoreUI.tableData.addColumn("listadoComunidadesPendientesCertificado",(function(e,o,i,a){return e.nombre}),"Comunidad",null,"text-left"),CoreUI.tableData.addColumn("listadoComunidadesPendientesCertificado",(function(e,o,i,a){return e.administrador}),"Representante legal",null,"text-left"),CoreUI.tableData.addColumn("listadoComunidadesPendientesCertificado",(function(e,o,i,a){return e.documento}),"CIF/NIF",null,"text-left"),CoreUI.tableData.addColumn("listadoComunidadesPendientesCertificado",(function(e,o,i,a){return e.telefono}),"Teléfono",null,"text-left"),CoreUI.tableData.addColumn("listadoComunidadesPendientesCertificado",(function(e,o,i,a){return moment(e.fechasolicitud).locale("es").format("L")}),"Fecha de solicitud",null,"text-center"),$("#listadoComunidadesPendientesCertificado").addClass("no-clicable"),await CoreUI.tableData.render("listadoComunidadesPendientesCertificado","comunidad","certificadodigital/comunidad/pendientesvalidacion/list",null,!1,!1))}},Validation:{EstadoRequerimiento:function(){var e="";if(1==TecnicoCertificado.Model.documentoSeleccionado.caduca){var o=$("body .fechaCaducidad").val();(new moment).format("YYYY-MM-DD");if(""==o)e+="La Fecha de caducidad no puede estar vacía<br>";else{var i=moment($("body .fechaCaducidad").val(),"YYYY-MM-DD"),a=moment().startOf("day"),t=moment.duration(i.diff(a)).asDays();t<0&&(e+="La fecha de caducidad no puede ser inferior a la actual<br>"),t>=0&&t<10&&(e+="La fecha de caducidad no puede ser inferior a 10 días vista<br>")}}return"7"==$("body input[name=rbEstado]:checked").val()&&""==$("body .observacionesRechazo").val()&&(e+="Observaciones del motivo de rechazo"),e},DocumentacionObligatoriaAportada:function(e){apiFincatech.get(`certificadodigital/comunidad/${e}/validate/documentacion`).then((e=>{"ok"===JSON.parse(e).data&&CoreUI.Modal.Success("La comunidad ya tiene aprobada toda la documentación necesaria para la solicitud del certificado digital.<br><br>En consecuencia el certificado digital ha sido solicitado a UANATACA.","Certificado digital",(()=>{TecnicoCertificado.Render.ComunidadesCertificadoSolicitado(),TecnicoCertificado.GUI.MostrarListadoDocumentacion(!1)}))}))}}};$((()=>{TecnicoCertificado.Init()}));