let CoreUI={init:function(){},Utils:{parse:function(valor,data){let inicioPatron="data[",finalPatron="]";var posInicial=0;for(posInicial=valor.indexOf("data[");posInicial>=0;){if(posInicial>=0&&(posFinal=valor.indexOf("]",posInicial+1),posFinal>0)){campo=valor.substring(posInicial+"data[".length,posFinal);var find="data["+campo+"]",re=new RegExp(find,"g");valor=valor.replace(find,data[`${campo}`])}posInicial=valor.indexOf("data[",posInicial+1)}return valor},setTituloPantalla:function(entidad,campo){void 0!==core.Modelo.entity[entidad]&&$(".titulo-modulo").text(core.Modelo.entity[entidad][0][campo])}},tableData:{_this:null,columns:[],init:function(){jQuery.extend(!0,jQuery.fn.dataTable.defaults,{language:{decimal:",",thousands:".",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoPostFix:"",infoFiltered:"(filtrado de un total de _MAX_ registros)",loadingRecords:"Cargando...",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},processing:"Procesando...",search:"Buscar:",searching:!0,searchPlaceholder:"Término de búsqueda",zeroRecords:"No se encontraron resultados",emptyTable:"Ningún dato disponible en esta tabla",aria:{sortAscending:": Activar para ordenar la columna de manera ascendente",sortDescending:": Activar para ordenar la columna de manera descendente"},buttons:{create:"Nuevo",edit:"Cambiar",remove:"Borrar",copy:"Copiar",csv:"fichero CSV",excel:"tabla Excel",pdf:"documento PDF",print:"Imprimir",colvis:"Visibilidad columnas",collection:"Colección",upload:"Seleccione fichero...."},select:{rows:{_:"%d filas seleccionadas",0:"clic fila para seleccionar",1:"una fila seleccionada"}}}})},extractFields:function(valor,datos){let inicioPatron="data:",finalPatron="$";var posInicial=0;for(posInicial=valor.indexOf("data:");posInicial>=0;){if(valorCampo="N/D",posInicial>=0&&(posFinal=valor.indexOf("$",posInicial+"data:".length+1),posFinal>0)){if(campo=valor.substring(posInicial+"data:".length,posFinal),campo.indexOf(".")>0)definicion=campo.split("."),void 0!==datos[definicion[0]][0]&&(valorCampo=datos[definicion[0]][0],valorCampo=valorCampo[definicion[1]]);else if(void 0!==datos[campo])switch(valorCampo=datos[campo],campo){case"created":valorCampo=moment(valorCampo).locale("es").format("L");break;case"estado":switch(valorCampo){case"H":valorCampo='<span class="badge rounded-pill bg-secondary d-block pt-2 pb-2">Histórico</span>';break;case"A":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Alta</span>';break;case"B":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">Baja</span>';break;case"P":valorCampo='<span class="badge rounded-pill bg-warning d-block pt-2 pb-2">Pendiente</span>'}break;case"solucionado":switch(valorCampo){case"0":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">Pendiente</span>';break;case"1":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Solucionada</span>'}break;case"activado":switch(valorCampo){case"0":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">No activo</span>';break;case"1":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Activado</span>'}}var find="data:"+campo+"$";valor=valor.replace(find,valorCampo)}posInicial=valor.indexOf("data:",posInicial+"data:".length+1)}return""==valor?"N/D":valor},addColumn:function(nombre,titulo,renderHTML,clase,widthColumn){var columna={};columna=null!=renderHTML?{title:titulo,data:null,width:widthColumn,className:clase,render:function(data,type,row,meta){return html=renderHTML,field="codigo",html=CoreUI.tableData.extractFields(html,data),feather.replace(),html}}:{data:nombre,width:widthColumn,render:null,title:titulo},this.columns.push(columna)},render:function(id,entity,endpoint,allColumns,_paging=!0,_search=!0){CoreUI.tableData.init(),window["table"+id]=$(`#${id}`).DataTable({serverSide:!0,autoWidth:!0,select:!0,retrieve:!0,paging:_paging,searching:_search,ajax:{url:config.baseURLEndpoint+endpoint,dataSrc:"data."+entity},columns:this.columns,columnDefs:[{targets:this.columns.length-1,className:"p-0 text-center"}],drawCallback:function(settings){feather.replace()}}),$(`#${id}`).hasClass("no-clicable")||$(`#${id}`).on("click","tr > td",(function(e){if(console.log($(this)),$(this).html().indexOf("accionesTabla")>0)console.log("Ha clicado en acciones");else{var data=window["table"+id].row(this).data();window.location.href=baseURL+endpoint.toLowerCase().replace("list",data.id)}}))}},Modal:{GetHTML:function(id,html,titulo,texto,callback){$("body ."+id).length&&$("body ."+id).remove(),$("body").append(html),feather.replace(),$("body ."+id).modal("show")},CustomHTML:async function(texto,titulo,callback,modalWidth){await Swal.fire({html:`${texto}`,title:titulo,showCancelButton:!1,showConfirmButton:!1,width:""==modalWidth?"32rem":modalWidth})},Success:function(texto,titulo,callback){Swal.fire({text:`${texto}`,title:titulo,icon:"success",showCancelButton:!1}).then(result=>{result.isConfirmed&&void 0!==callback&&callback()})},Error:function(texto,titulo,callback){Swal.fire({text:`${texto}`,title:"",icon:"error",showCancelButton:!1}).then(result=>{result.isConfirmed&&void 0!==callback&&callback()})}}};$(()=>{CoreUI.init});