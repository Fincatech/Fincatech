let CoreUI={tituloModulo:null,init:function(){},setTitulo:function(e){CoreUI.tituloModulo=e},Controller:{InitializeSelectData:async function(){var e,a=$("body .form-data .select-data").length,t=0;(e=new Promise((async function(e,o){$("body .form-data .select-data").length?$("body .form-data .select-data").each((function(){var o=!1,n=$(this).attr("hs-list-entity"),r=$(this).attr("hs-list-field"),d=$(this).attr("hs-list-value"),i=$(this).prop("id");$(this).attr("hs-field"),$(this).attr("hs-value");void 0!==$(this).attr("hs-seleccionar")&&(o="false"!=$(this).attr("hs-seleccionar"));new Promise((async function(s,l){CoreUI.Controller.GetSelectData(n,r,d,null,null,i,o).then((o=>{++t>=a&&e(!0)}))}))})):e(!0)}))).then((function(){return core.Forms.getModelo(),e}))},GetSelectData:async function(e,a,t,o,n,r,d){return $("body #"+r).html(""),new Promise((function(o,n){apiFincatech.get(`${e}/list?target=cbo`).then((n=>{var i="",s=JSON.parse(n);if(responseData=s.data,responseData[e]){d&&(i='<option value="-1" disabled selected="selected">Seleccione una opción</option>',$("body #"+r).append(i));var l,c,u=a.split(",");t=t.split(".");for(var p=0;p<responseData[e].length;p++){c=Array(),l=responseData[e][p][t[1]];for(var b=0;b<u.length;b++)fieldValue=u[b].split("."),c.push(responseData[e][p][fieldValue[1]]);i=`<option value="${l}">${c=c.join(" - ")}</option>`,$("body #"+r).append(i)}$("body #"+r).select2({theme:"bootstrap4",placeholder:"Seleccione una opción"}),o(!0)}else alert("Error. La entidad no es correcta para el select")}))})).then((function(){return!0}))}},Forms:{Errors:{hasErrors:!1,SetMessage:function(e,a){$(`#${e}-msg-error`).html(a),CoreUI.Forms.Errors.hasErrors=!0,CoreUI.Forms.Errors.ShowErrors()},ShowErrors:function(){$(".msg-form-error").removeClass("d-none").addClass("d-none"),$(".msg-form-error").each((function(e){let a=$(this).attr("data-input-field-id");""!==$(this).html()?($(this).removeClass("d-none"),$(`#${a}`).removeClass("form-error").addClass("form-error")):$(`#${a}`).removeClass("form-error")}))}}},Utils:{formatNumberToCurrency:function(e){let a=parseFloat(e);return a=a.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&.").replace(",","."),a},parse:function(e,a){let t="data[";var o=0;for(o=e.indexOf(t);o>=0;){if(o>=0&&(posFinal=e.indexOf("]",o+1),posFinal>0)){campo=e.substring(o+t.length,posFinal);var n=t+campo+"]";new RegExp(n,"g");e=e.replace(n,a[`${campo}`])}o=e.indexOf(t,o+1)}return e},setTituloPantalla:function(e,a,t=null){null===t?void 0!==core.Modelo.entity[e]&&null!==core.Modelo.entity[e]&&$(".titulo-modulo").text(core.Modelo.entity[e][0][a]):$(".titulo-modulo").text(t)},redirectTo(e){window.location=e},renderLabelByEstado:function(e){if(""!=e&&void 0!==e&&e){var a;switch(e.toLowerCase()){case"no adjuntado":a='<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>';break;case"adjuntado":a='<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Adjuntado</span>';break;case"no descargado":a='<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No descargado</span>';break;case"no verificado":a='<span class="badge rounded-pill bg-warning pl-3 pr-3 pt-2 pb-2 d-block">Pendiente revisión</span>';break;case"descargado":a='<span class="badge rounded-pill bg-primary pl-3 pr-3 pt-2 pb-2 d-block">Descargado</span>';break;case"verificado":a='<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Verificado</span>';break;case"rechazado":a='<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">Rechazado</span>';break;case"pendiente verificación":a='<span class="badge rounded-pill bg-warning pl-3 pr-3 pt-2 pb-2 d-block">Pendiente revisión</span>';break}return a}},getSelectedFileInBase64Format:async function(e){var a=document.getElementById(e);if(0===a.files.length)return!1;var t=a.files[0];return new Promise(((e,a)=>{const o=new FileReader;o.onload=a=>{e(a.target.result)},o.onerror=e=>{a(e)},o.readAsDataURL(t)}))}},tableData:{_this:null,columns:[],selectedRowIndex:null,selectedRowTableId:null,init:function(){jQuery.extend(!0,jQuery.fn.dataTable.defaults,{language:{decimal:",",thousands:".",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoPostFix:"",infoFiltered:"(filtrado de un total de _MAX_ registros)",loadingRecords:"Cargando...",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},processing:"Procesando...",search:'<i class="bi bi-search"></i>',searching:!0,searchPlaceholder:"Buscar",zeroRecords:"No se encontraron resultados",emptyTable:"Ningún dato disponible en esta tabla",aria:{sortAscending:": Activar para ordenar la columna de manera ascendente",sortDescending:": Activar para ordenar la columna de manera descendente"},buttons:{create:"Nuevo",edit:"Cambiar",remove:"Borrar",copy:"Copiar",csv:"fichero CSV",excel:"tabla Excel",pdf:"documento PDF",print:'<i class="bi bi-printer"></i> Imprimir listado',colvis:"Visibilidad columnas",collection:"Colección",upload:"Seleccione fichero...."},select:{rows:{_:"%d filas seleccionadas",0:"clic fila para seleccionar",1:"una fila seleccionada"}}}})},extractFields:function(e,a){let t="data:";var o=0;for(o=e.indexOf(t);o>=0;){if(valorCampo="N/D",o>=0&&(posFinal=e.indexOf("$",o+t.length+1),posFinal>0)){if(campo=e.substring(o+t.length,posFinal),campo.indexOf(".")>0)definicion=campo.split("."),void 0!==a[definicion[0]][0]&&(valorCampo=a[definicion[0]][0],valorCampo=valorCampo[definicion[1]]);else if(void 0!==a[campo])switch(valorCampo=a[campo],campo){case"created":valorCampo=moment(valorCampo).locale("es").format("L");break;case"estado":switch(valorCampo){case"H":valorCampo='<span class="badge rounded-pill bg-secondary d-block pt-2 pb-2">Histórico</span>';break;case"A":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Alta</span>';break;case"B":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">Baja</span>';break;case"P":valorCampo='<span class="badge rounded-pill bg-warning d-block pt-2 pb-2">Pendiente</span>'}break;case"solucionado":switch(valorCampo){case"0":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">Pendiente</span>';break;case"1":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Solucionada</span>';break}break;case"activado":switch(valorCampo){case"0":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">No activo</span>';break;case"1":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Activado</span>';break}break}var n=t+campo+"$";e=e.replace(n,valorCampo)}o=e.indexOf(t,o+t.length+1)}return""==e?"N/D":e},addColumnRow:function(e,a){var t;void 0===CoreUI.tableData.columns[e]&&(CoreUI.tableData.columns[e]=[]),t={className:"details-control",orderable:!1,data:a,defaultContent:"",render:function(){return'<i class="fa fa-plus-square text-success abrir" aria-hidden="true"></i><i class="fa fa-minus-square text-danger cerrar" aria-hidden="true"></i>'},width:"15px"},CoreUI.tableData.columns[e].push(t)},addColumn:function(e,a,t,o,n,r,d=null,i=null){void 0===CoreUI.tableData.columns[e]&&(CoreUI.tableData.columns[e]=[]);var s={};s=null!=o?{title:t,data:null,width:r,className:n,name:a||null,render:function(e,a,t,n){return html=o,field="codigo",html=CoreUI.tableData.extractFields(html,e),feather.replace(),html}}:"function"!=typeof a&&"object"!=typeof a?{data:a,name:a,className:n,width:r,render:d,title:t}:{data:a,className:n,width:r,render:d,title:t},CoreUI.tableData.columns[e].push(s)},formatComunidad:function(e){var a=!1;"ADMINFINCAS"!=core.Security.getRole()&&"SUDO"!=core.Security.getRole()||(a=!0);var t='\n                <div class="table-responsive">\n                    <table border="0" class="table table-bordered table-light">\n                        <thead class="">\n                            <tr>\n                                <th style="background: #dee2e6 !important;">Requerimiento</th>\n                                <th class="text-center" style="background: #dee2e6 !important;width:150px;">Estado</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Documento</th>\n                            </tr>\n                        </thead>';for(x=0;x<e.documentacioncomunidad.length;x++)t+=`<tr>\n                                    <td>${e.documentacioncomunidad[x].requerimiento}</td>`,t+='<td class="text-center" >'+(e.documentacioncomunidad[x].idficherorequerimiento?'<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Verificado</span>':'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>')+"</td>",ficheroAdjuntado=!!e.documentacioncomunidad[x].idficherorequerimiento,ficheroAdjuntado&&(t+=` <td class="text-center">\n                                            <a href="${baseURL}public/storage/${e.documentacioncomunidad[x].storageficherorequerimiento}" target="_blank" data-bs-toggle="tooltip" data-placement="bottom" title="Ver documento">\n                                                <i class="bi bi-cloud-arrow-down text-success" style="font-size: 30px;"></i>\n                                            </a>                                            \n                                        </td>`),a&&(dataset=` data-idcomunidad="${e.documentacioncomunidad[x].idcomunidad}" data-idempresa="" data-idempleado="" data-idrequerimiento="${e.documentacioncomunidad[x].idrequerimiento}" data-idrelacionrequerimiento="${e.documentacioncomunidad[x].idrelacion}" data-entidad="comunidad" `,t+=`<td class="text-center" ><a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" ${dataset} data-placement="bottom" title="" id="home" data-original-title="Adjuntar documento"><i class="bi bi-cloud-arrow-up text-danger" style="font-size: 30px;"></i></a></td>`),ficheroAdjuntado||a||(t+="<td>&nbsp;</td>"),t+="</tr>";return t+="</table></div>"},formatEmpleado:function(e){var a=!1,t=!1;$(`body #${CoreUI.tableData.selectedRowTableId} tr#${CoreUI.tableData.selectedRowIndex} td:nth-child(2)`).html().indexOf("Comunidad")>=0&&(t=!0),"CONTRATISTA"!=core.Security.getRole()||t||(a=!0);var o='\n                <div class="table-responsive">\n                    <table border="0" class="table table-bordered table-light">\n                        <thead class="">\n                            <tr>\n                                <th style="background: #dee2e6 !important;">Requerimiento</th>\n                                <th class="text-center" style="background: #dee2e6 !important;width:150px;">Estado</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Documento</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Fecha de caducidad</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Observaciones</th>\n                            </tr>\n                        </thead>';for(x=0;x<e.documentacionprl.length;x++){o+=`<tr>\n                                    <td>${e.documentacionprl[x].requerimiento}</td>`;var n,r="";switch(t&&"ADMINFINCAS"==core.Security.getRole()&&(a=!0),e.documentacionprl[x].estado){case"":case"N":r="No adjuntado",n="danger";break;case"R":r="Rechazado",n="danger";break;case"V":r="Validado",n="success";break;case"C":r="Caducado",n="warning";break;case"P":r="Pendiente de validación",n="info";break;default:r="No adjuntado",n="danger";break}o+=`<td class="text-center" ><span class="badge rounded-pill bg-${n} pl-3 pr-3 pt-2 pb-2 d-block">${r}</span></td>`,ficheroAdjuntado=!!e.documentacionprl[x].idficherorequerimiento,o+=' <td class="text-center">',ficheroAdjuntado&&(o+=` \n                                            <a href="${baseURL}public/storage/${e.documentacionprl[x].storageficherorequerimiento}" target="_blank" data-bs-toggle="tooltip" data-placement="bottom" title="Ver documento">\n                                                <i class="bi bi-cloud-arrow-down text-success" style="font-size: 30px;"></i>\n                                            </a>`),a&&(dataset=` data-idcomunidad="" data-idempresa="" data-idempleado="${e.idempleado}" data-idrequerimiento="${e.documentacionprl[x].idrequerimiento}" data-idrelacionrequerimiento="${e.documentacionprl[x].idrelacion}" data-entidad="empleado" `,o+=`<a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" ${dataset} data-placement="bottom" title="" id="home" data-original-title="Adjuntar documento"><i class="bi bi-cloud-arrow-up text-danger" style="font-size: 30px;"></i></a>`),o+="</td>",ficheroAdjuntado||a||(o+="<td>&nbsp;</td>"),o+=`<td class="text-center">${null==e.documentacionprl[x].fechacaducidad||""==e.documentacionprl[x].fechacaducidad?"-":moment(e.documentacionprl[x].fechacaducidad).locale("es").format("L")}</td>`,o+=`<td class="text-justify">${null==e.documentacionprl[x].observaciones?"":e.documentacionprl[x].observaciones}</td>`,o+="</tr>"}return o+="</table></div>"},formatEmpresa:function(e){core.Security.getRole();var a='\n                <div class="table-responsive">\n                    <table border="0" class="table table-bordered table-light">\n                        <thead class="">\n                            <tr>\n                                <th style="background: #dee2e6 !important;">Administrador</th>\n                                <th class="text-left" style="background: #dee2e6 !important;width:150px;">Comunidad</th>';for(a+="        \n                            </tr>\n                        </thead>",x=0;x<e.comunidades.length;x++)a+=`\n                        <tr>\n                            <td width="50%" style="font-size:14px;">${e.comunidades[x].administrador}</td>\n                            <td width="50%" class="text-left" style="font-size:14px;">${e.comunidades[x].nombre}</td>\n                        </tr>`;return a+="</table></div>"},format:function(e,a){var t;switch(a){case"listadoEmpresa":case"listadoEmpresa":case"listadoEmpresaComunidad":t=CoreUI.tableData.formatEmpresa(e);break;case"listadoComunidad":t=CoreUI.tableData.formatComunidad(e);break;case"listadoEmpleadosComunidad":t=CoreUI.tableData.formatEmpleado(e);break}return t},tableEventsClick:function(e,a,t=null){void 0!==window["table"+e]&&window["table"+e].on("draw",(function(){$.each(a,(function(e,a){$("body #"+a+" td.details-control").off(),$("body #"+a+" td.details-control").trigger("click")}))})),$("body #"+e+" tr td.details-control").off(),$("body #"+e).on(core.helper.clickEventType,"tr td.details-control",(function(e){CoreUI.tableData.selectedRowIndex=$(this).parent().attr("id"),idTabla=$(this).parent().parent().parent().attr("id"),CoreUI.tableData.selectedRowTableId=idTabla;var t=$(this).closest("tr"),o=window["table"+idTabla].row(t);$.inArray(t.attr("id"),a);o.child.isShown()?(t.removeClass("shown"),o.child.hide(),t.removeClass("shown")):(t.addClass("shown"),o.child(CoreUI.tableData.format(o.data(),idTabla)).show()),documentalCore.Events()})),$(`body #${e}`).hasClass("no-clicable")||($(`body #${e} tr > td`).off(),$(`body #${e}`).on("click","tr > td",(function(a){if($(this).html().indexOf("accionesTabla")>0);else{var o=window["table"+e].row(this).data();void 0!==o&&(window.location.href=baseURL+t.toLowerCase().replace("list",o.id))}})))},render:async function(e,a,t,o,n=!0,r=!0,d=null,i=null,s=!1,l=null,c=!1,u="GET",p=!0,b=!1){new Promise(((o,m)=>{CoreUI.tableData.init();var f={serverSide:c,autoWidth:!1,select:!0,retrieve:!0,paging:n,searching:r,responsive:p,ajax:{url:config.baseURLEndpoint+t,dataSrc:`data.${a}`,type:u},deferRender:!0,columns:CoreUI.tableData.columns[e],columnDefs:[{targets:CoreUI.tableData.columns[e].length-1,className:CoreUI.tableData.columns[e].className}],drawCallback:function(e){feather.replace()},fnCreatedRow:function(e,a,t){$(e).attr("id",t)}};!0===i&&(f.dom="Bfrtip",f.buttons=["print"]),!0===s&&(f.rowGroup={dataSrc:l}),b&&(f.buttons=[{extend:"excel",className:"btn-success",text:"Exportar a fichero Excel"}],i&&f.buttons.push({extend:"print",text:"Imprimir"})),null!=d&&(f.render=d),$.fn.DataTable.isDataTable(`#${e}`)&&window["table"+e].destroy(),window["table"+e]=$(`#${e}`).DataTable(f),CoreUI.tableData.tableEventsClick(e,[],t),o(!0)}))}},Modal:{GetHTML:function(e,a,t,o,n){$("body ."+e).length&&$("body ."+e).remove(),$("body").append(a),feather.replace(),$("body ."+e).modal("show")},CustomHTML:async function(e,a,t=null,o=null,n=null,r=null){await Swal.fire({html:`${e}`,title:a,showCancelButton:!1,showConfirmButton:!1,grow:""==n?"fullscreen":n,width:""==o?"32rem":o,didOpen:function(){null!==t&&t()},didClose:function(){null!==r&&r()}})},Success:function(e,a,t){Swal.fire({html:`${e}`,title:a,icon:"success",showCancelButton:!1}).then((e=>{e.isConfirmed&&void 0!==t&&t()}))},Info:function(e,a,t){Swal.fire({html:`${e}`,title:"",icon:"info",showCancelButton:!1}).then((e=>{e.isConfirmed&&void 0!==t&&t()}))},Error:function(e,a,t){Swal.fire({html:`${e}`,title:"",icon:"error",showCancelButton:!1}).then((e=>{e.isConfirmed&&void 0!==t&&t()}))},Question:function(e,a,t,o){Swal.fire({title:a,html:e,grow:"true",width:"60rem",showCancelButton:!0,showConfirmButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:'<i class="bi bi-check-circle mr-2"></i> '+t,cancelButtonText:'<i class="bi bi-x-circle mr-2"></i> Cancelar',reverseButtons:!0,buttonsStyling:!1,customClass:{actions:"text-center p-3 shadow-inset rounded-pill border-light border-2 bg-white",confirmButton:"btn btnConfirmModalAction btn-success rounded-pill shadow d-block pb-2 pt-2 confirmButtonModal",cancelButton:" btn btn-danger btnCancelSave rounded-pill shadow d-block pb-2 pt-2 mr-3 cancelButtonModal",popup:"bdg-transparent"}}).then((e=>{e.isConfirmed&&o()}))}},Progress:{Total:100,Actual:0,SetProgress:function(e){CoreUI.Progress.Actual=e,$(".fincatech--progreso .progress-bar").css("width",`${CoreUI.Progress.Actual}%`),$(".fincatech--progreso .progress-bar").html(`${CoreUI.Progress.Actual}%`)},Init:function(){CoreUI.Progress.SetMessage("Iniciando proceso"),$(".fincatech--progreso .progress-bar").html("0%"),$(".fincatech--progreso .progress-bar").css("width","0")},Show:function(){CoreUI.Progress.Init(),$("body").addClass("progress"),$(".fincatech--progreso").removeClass("d-none")},Hide:function(){$("body").removeClass("progress"),$(".fincatech--progreso .btnProcesoTerminado").hide(),$(".fincatech--progreso").removeClass("d-none").addClass("d-none")},SetMessage:function(e){$("body .fincatech--progreso .mensaje").html(e)},Completed:function(){$("body .fincatech--progreso .btnProcesoTerminado").show()}},Sidebar:{Comunidades:{cargarMenuComunidades:function(){var e="";core.Security.getUserInfo().then((a=>{switch(core.Security.getRole()){case"CONTRATISTA":e=`empresa/${core.Security.user}/comunidades`;break;case"ADMINFINCAS":break;default:return}apiFincatech.get(e).then((e=>{var a=JSON.parse(e).data.Comunidades.Comunidad,t="";if($(".sidebar-nav").prepend('\n                        <div class="row pl-3 pr-3 sticky-top" style="background: #222e3c;">\n                            <div class="col-12 pb-2 pt-2 mb-3 mt-2">\n                                <p class="text-white text-uppercase mt-0 mb-0"><small>Buscar comunidad</small></p>\n                                <div class="row">\n                                    <div class="col-10">\n                                        <input type="text" class="form-control busquedaComunidad" placeholder="Escriba cód o nombre">\n                                    </div>\n                                    <div class="col-2 align-self-center">\n                                        <a href="javascript:void(0);" class="btnLimpiarBusqueda"><i class="bi bi-x-circle text-white"></i></a>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>'),a.length>0)for(x=0;x<a.length;x++)t=`<li class="sidebar-item pl-3 pr-3 pb-2 pt-2" data-codigo="${a[x].codigo}" data-nombre="${a[x].nombre}">\n                                                <div class="row">\n                                                    <div class="col-1 text-left pl-0 pr-0 align-self-center">\n                                                        <img src="${config.baseURL}public/assets/img/icon_edificio.png" class="img-responsive feather">\n                                                    </div>   \n                                                    \n                                                    <div class="col-11 pr-0">\n                                                        <a href="${config.baseURL}comunidad/${a[x].id}" class="text-white d-block">   \n                                                            <span class="align-middle comunidad-${a[x].id} d-block" style="font-size: 13px;">${a[x].codigo} ${a[x].nombre}</span>\n                                                        </a>\n                                                    </div>  \n\x3c!--\n                                                    <div class="col-2 pr-0 text-center pl-0 align-self-center">\n                                                        <a href="javascript:void(0);" class="btnEliminarComunidad" data-id="${a[x].codigo}" data-nombre="${a[x].nombre}">\n                                                            <i data-feather="trash-2" class="text-danger"></i>\n                                                        </a>\n                                                    </div>\n--\x3e\n                                                </div>\n                                            </li>`,$(".navComunidades").append(t);else $(".navComunidades").append('<p class="text-center text-white">No tiene comunidades asignadas</p>');$("body").on(core.helper.clickEventType,".btnLimpiarBusqueda",(function(e){$(".busquedaComunidad").val(""),CoreUI.Sidebar.Comunidades.buscarComunidad()})),$("body").on("keyup",".busquedaComunidad",(function(e){CoreUI.Sidebar.Comunidades.buscarComunidad()})),feather.replace()}))}))},buscarComunidad:function(){var e=$(".busquedaComunidad").val().toLowerCase();""!=e?$(".navComunidades .sidebar-item").each((function(a){$(this).attr("data-nombre").toLowerCase().indexOf(e)>=0||$(this).attr("data-codigo").toLowerCase().indexOf(e)>=0?$(this).removeClass("d-none"):$(this).addClass("d-none")})):$(".navComunidades .sidebar-item").removeClass("d-none")}}}};$((()=>{CoreUI.init}));