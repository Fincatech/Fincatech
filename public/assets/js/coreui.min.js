let CoreUI={tituloModulo:null,init:function(){},setTitulo:function(value){CoreUI.tituloModulo=value},Utils:{parse:function(valor,data){let inicioPatron="data[",finalPatron="]";var posInicial=0;for(posInicial=valor.indexOf("data[");posInicial>=0;){if(posInicial>=0&&(posFinal=valor.indexOf("]",posInicial+1),posFinal>0)){campo=valor.substring(posInicial+"data[".length,posFinal);var find="data["+campo+"]",re=new RegExp(find,"g");valor=valor.replace(find,data[`${campo}`])}posInicial=valor.indexOf("data[",posInicial+1)}return valor},setTituloPantalla:function(entidad,campo,nombre=null){null===nombre?void 0!==core.Modelo.entity[entidad]&&null!==core.Modelo.entity[entidad]&&$(".titulo-modulo").text(core.Modelo.entity[entidad][0][campo]):$(".titulo-modulo").text(nombre)},redirectTo(_url){window.location=_url},renderLabelByEstado:function(value){if(""!=value&&void 0!==value&&value){var out;switch(value.toLowerCase()){case"no adjuntado":out='<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>';break;case"adjuntado":out='<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Adjuntado</span>';break;case"no descargado":out='<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No descargado</span>';break;case"no verificado":out='<span class="badge rounded-pill bg-warning pl-3 pr-3 pt-2 pb-2 d-block">Pendiente revisión</span>';break;case"descargado":out='<span class="badge rounded-pill bg-primary pl-3 pr-3 pt-2 pb-2 d-block">Descargado</span>';break;case"verificado":out='<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Verificado</span>';break;case"rechazado":out='<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">Rechazado</span>';break;case"pendiente verificación":out='<span class="badge rounded-pill bg-warning pl-3 pr-3 pt-2 pb-2 d-block">Pendiente revisión</span>'}return out}}},tableData:{_this:null,columns:[],selectedRowIndex:null,selectedRowTableId:null,init:function(){jQuery.extend(!0,jQuery.fn.dataTable.defaults,{language:{decimal:",",thousands:".",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoPostFix:"",infoFiltered:"(filtrado de un total de _MAX_ registros)",loadingRecords:"Cargando...",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},processing:"Procesando...",search:"Buscar:",searching:!0,searchPlaceholder:"",zeroRecords:"No se encontraron resultados",emptyTable:"Ningún dato disponible en esta tabla",aria:{sortAscending:": Activar para ordenar la columna de manera ascendente",sortDescending:": Activar para ordenar la columna de manera descendente"},buttons:{create:"Nuevo",edit:"Cambiar",remove:"Borrar",copy:"Copiar",csv:"fichero CSV",excel:"tabla Excel",pdf:"documento PDF",print:'<i class="bi bi-printer"></i> Imprimir listado',colvis:"Visibilidad columnas",collection:"Colección",upload:"Seleccione fichero...."},select:{rows:{_:"%d filas seleccionadas",0:"clic fila para seleccionar",1:"una fila seleccionada"}}}})},extractFields:function(valor,datos){let inicioPatron="data:",finalPatron="$";var posInicial=0;for(posInicial=valor.indexOf("data:");posInicial>=0;){if(valorCampo="N/D",posInicial>=0&&(posFinal=valor.indexOf("$",posInicial+"data:".length+1),posFinal>0)){if(campo=valor.substring(posInicial+"data:".length,posFinal),campo.indexOf(".")>0)definicion=campo.split("."),void 0!==datos[definicion[0]][0]&&(valorCampo=datos[definicion[0]][0],valorCampo=valorCampo[definicion[1]]);else if(void 0!==datos[campo])switch(valorCampo=datos[campo],campo){case"created":valorCampo=moment(valorCampo).locale("es").format("L");break;case"estado":switch(valorCampo){case"H":valorCampo='<span class="badge rounded-pill bg-secondary d-block pt-2 pb-2">Histórico</span>';break;case"A":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Alta</span>';break;case"B":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">Baja</span>';break;case"P":valorCampo='<span class="badge rounded-pill bg-warning d-block pt-2 pb-2">Pendiente</span>'}break;case"solucionado":switch(valorCampo){case"0":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">Pendiente</span>';break;case"1":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Solucionada</span>'}break;case"activado":switch(valorCampo){case"0":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">No activo</span>';break;case"1":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Activado</span>'}}var find="data:"+campo+"$";valor=valor.replace(find,valorCampo)}posInicial=valor.indexOf("data:",posInicial+"data:".length+1)}return""==valor?"N/D":valor},addColumnRow:function(id,data){var columna={};void 0===CoreUI.tableData.columns[id]&&(CoreUI.tableData.columns[id]=[]),columna={className:"details-control",orderable:!1,data:data,defaultContent:"",render:function(){return'<i class="fa fa-plus-square text-success abrir" aria-hidden="true"></i><i class="fa fa-minus-square text-danger cerrar" aria-hidden="true"></i>'},width:"15px"},CoreUI.tableData.columns[id].push(columna)},addColumn:function(id,nombre,titulo,renderHTML,clase,widthColumn,_render=null){void 0===CoreUI.tableData.columns[id]&&(CoreUI.tableData.columns[id]=[]);var columna={};columna=null!=renderHTML?{title:titulo,data:null,width:widthColumn,className:clase,name:nombre||null,render:function(data,type,row,meta){return html=renderHTML,field="codigo",html=CoreUI.tableData.extractFields(html,data),feather.replace(),html}}:"function"!=typeof nombre&&"object"!=typeof nombre?{data:nombre,name:nombre,className:clase,width:widthColumn,render:_render,title:titulo}:{data:nombre,className:clase,width:widthColumn,render:_render,title:titulo},CoreUI.tableData.columns[id].push(columna)},formatComunidad:function(d){var canUploadFile=!1,needFileUpload=!1,fileLink="";"ADMINFINCAS"!=core.Security.getRole()&&"SUDO"!=core.Security.getRole()||(canUploadFile=!0);var salida='\n                <div class="table-responsive">\n                    <table border="0" class="table table-bordered table-light">\n                        <thead class="">\n                            <tr>\n                                <th style="background: #dee2e6 !important;">Requerimiento</th>\n                                <th class="text-center" style="background: #dee2e6 !important;width:150px;">Estado</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Documento</th>\n                            </tr>\n                        </thead>';for(x=0;x<d.documentacioncomunidad.length;x++)salida+=`<tr>\n                                    <td>${d.documentacioncomunidad[x].requerimiento}</td>`,salida+='<td class="text-center" >'+(d.documentacioncomunidad[x].idficherorequerimiento?'<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Verificado</span>':'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>')+"</td>",ficheroAdjuntado=!!d.documentacioncomunidad[x].idficherorequerimiento,ficheroAdjuntado&&(salida+=` <td class="text-center">\n                                            <a href="${baseURL}public/storage/${d.documentacioncomunidad[x].storageficherorequerimiento}" target="_blank" data-bs-toggle="tooltip" data-placement="bottom" title="Ver documento">\n                                                <i class="bi bi-cloud-arrow-down text-success" style="font-size: 30px;"></i>\n                                            </a>                                            \n                                        </td>`),canUploadFile&&(dataset=` data-idcomunidad="${d.documentacioncomunidad[x].idcomunidad}" data-idempresa="" data-idempleado="" data-idrequerimiento="${d.documentacioncomunidad[x].idrequerimiento}" data-idrelacionrequerimiento="${d.documentacioncomunidad[x].idrelacion}" data-entidad="comunidad" `,salida+=`<td class="text-center" ><a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" ${dataset} data-placement="bottom" title="" id="home" data-original-title="Adjuntar documento"><i class="bi bi-cloud-arrow-up text-danger" style="font-size: 30px;"></i></a></td>`),ficheroAdjuntado||canUploadFile||(salida+="<td>&nbsp;</td>"),salida+="</tr>";return salida+="</table></div>"},formatEmpleado:function(d){var canUploadFile=!1,needFileUpload=!1,fileLink="",value,empleadoComunidad=!1;$(`body #${CoreUI.tableData.selectedRowTableId} tr#${CoreUI.tableData.selectedRowIndex} td:nth-child(2)`).html().indexOf("Comunidad")>=0&&(empleadoComunidad=!0),"CONTRATISTA"!=core.Security.getRole()||empleadoComunidad||(canUploadFile=!0);var salida='\n                <div class="table-responsive">\n                    <table border="0" class="table table-bordered table-light">\n                        <thead class="">\n                            <tr>\n                                <th style="background: #dee2e6 !important;">Requerimiento</th>\n                                <th class="text-center" style="background: #dee2e6 !important;width:150px;">Estado</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Documento</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Fecha de caducidad</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Observaciones</th>\n                            </tr>\n                        </thead>';for(x=0;x<d.documentacionprl.length;x++){salida+=`<tr>\n                                    <td>${d.documentacionprl[x].requerimiento}</td>`;var estadoRequerimiento="",classRequerimiento,fechaCaducidad,observaciones;switch(empleadoComunidad&&"ADMINFINCAS"==core.Security.getRole()&&(canUploadFile=!0),d.documentacionprl[x].estado){case"":case"N":estadoRequerimiento="No adjuntado",classRequerimiento="danger";break;case"R":estadoRequerimiento="Rechazado",classRequerimiento="danger";break;case"V":estadoRequerimiento="Validado",classRequerimiento="success";break;case"C":estadoRequerimiento="Caducado",classRequerimiento="warning";break;case"P":estadoRequerimiento="Pendiente de validación",classRequerimiento="info";break;default:estadoRequerimiento="No adjuntado",classRequerimiento="danger"}salida+=`<td class="text-center" ><span class="badge rounded-pill bg-${classRequerimiento} pl-3 pr-3 pt-2 pb-2 d-block">${estadoRequerimiento}</span></td>`,ficheroAdjuntado=!!d.documentacionprl[x].idficherorequerimiento,salida+=' <td class="text-center">',ficheroAdjuntado&&(salida+=` \n                                            <a href="${baseURL}public/storage/${d.documentacionprl[x].storageficherorequerimiento}" target="_blank" data-bs-toggle="tooltip" data-placement="bottom" title="Ver documento">\n                                                <i class="bi bi-cloud-arrow-down text-success" style="font-size: 30px;"></i>\n                                            </a>`),canUploadFile&&(dataset=` data-idcomunidad="" data-idempresa="" data-idempleado="${d.idempleado}" data-idrequerimiento="${d.documentacionprl[x].idrequerimiento}" data-idrelacionrequerimiento="${d.documentacionprl[x].idrelacion}" data-entidad="empleado" `,salida+=`<a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" ${dataset} data-placement="bottom" title="" id="home" data-original-title="Adjuntar documento"><i class="bi bi-cloud-arrow-up text-danger" style="font-size: 30px;"></i></a>`),salida+="</td>",ficheroAdjuntado||canUploadFile||(salida+="<td>&nbsp;</td>"),salida+=`<td class="text-center">${null==d.documentacionprl[x].fechacaducidad||""==d.documentacionprl[x].fechacaducidad?"-":moment(d.documentacionprl[x].fechacaducidad).locale("es").format("L")}</td>`,salida+=`<td class="text-justify">${null==d.documentacionprl[x].observaciones?"":d.documentacionprl[x].observaciones}</td>`,salida+="</tr>"}return salida+="</table></div>"},formatEmpresa:function(d){var canUploadFile=!1,needFileUpload=!1,fileLink="";"CONTRATISTA"==core.Security.getRole()&&(canUploadFile=!0);var salida='\n                <div class="table-responsive">\n                    <table border="0" class="table table-bordered table-light">\n                        <thead class="">\n                            <tr>\n                                <th style="background: #dee2e6 !important;">Administrador</th>\n                                <th class="text-left" style="background: #dee2e6 !important;width:150px;">Comunidad</th>';for(salida+="        \n                            </tr>\n                        </thead>",x=0;x<d.comunidades.length;x++)salida+=`\n                        <tr>\n                            <td width="50%" style="font-size:14px;">${d.comunidades[x].administrador}</td>\n                            <td width="50%" class="text-left" style="font-size:14px;">${d.comunidades[x].nombre}</td>\n                        </tr>`;return salida+="</table></div>"},format:function(d,id){var salida;switch(id){case"listadoEmpresa":case"listadoEmpresa":case"listadoEmpresaComunidad":salida=CoreUI.tableData.formatEmpresa(d),console.log("click empresas");break;case"listadoComunidad":console.log("click comundiad"),salida=CoreUI.tableData.formatComunidad(d);break;case"listadoEmpleadosComunidad":console.log("click empleados"),salida=CoreUI.tableData.formatEmpleado(d)}return salida},tableEventsClick:function(id,detailRows,endpoint=null){void 0!==window["table"+id]&&window["table"+id].on("draw",(function(){$.each(detailRows,(function(i,id){$("body #"+id+" td.details-control").off(),$("body #"+id+" td.details-control").trigger("click")}))})),$("body #"+id+" tr td.details-control").off(),$("body #"+id).on(core.helper.clickEventType,"tr td.details-control",(function(e){CoreUI.tableData.selectedRowIndex=$(this).parent().attr("id"),idTabla=$(this).parent().parent().parent().attr("id"),CoreUI.tableData.selectedRowTableId=idTabla;var tr=$(this).closest("tr"),row=window["table"+idTabla].row(tr),idx=$.inArray(tr.attr("id"),detailRows);row.child.isShown()?(tr.removeClass("shown"),row.child.hide(),tr.removeClass("shown")):(tr.addClass("shown"),row.child(CoreUI.tableData.format(row.data(),idTabla)).show()),documentalCore.Events()})),$(`body #${id}`).hasClass("no-clicable")||($(`body #${id} tr > td`).off(),$(`body #${id}`).on("click","tr > td",(function(e){if($(this).html().indexOf("accionesTabla")>0)console.log("Ha clicado en acciones");else{var data=window["table"+id].row(this).data();void 0!==data&&(window.location.href=baseURL+endpoint.toLowerCase().replace("list",data.id))}})))},render:async function(id,entity,endpoint,allColumns,usePagination=!0,_search=!0,customRender=null,showPrint=null,groupResults=!1,groupCols=null,_serverSide=!1,_ajaxType="GET",_responsive=!0){let promesaTabla=new Promise((resolve,reject)=>{CoreUI.tableData.init();var detailRows=[],opciones={serverSide:_serverSide,autoWidth:!1,select:!0,retrieve:!0,paging:usePagination,searching:_search,responsive:_responsive,ajax:{url:config.baseURLEndpoint+endpoint,dataSrc:`data.${entity}`,type:_ajaxType},deferRender:!0,columns:CoreUI.tableData.columns[id],columnDefs:[{targets:CoreUI.tableData.columns[id].length-1,className:CoreUI.tableData.columns[id].className}],drawCallback:function(settings){feather.replace()},fnCreatedRow:function(nRow,aData,iDataIndex){$(nRow).attr("id",iDataIndex)}};!0===showPrint&&(opciones.dom="Bfrtip",opciones.buttons=["print"]),!0===groupResults&&(opciones.rowGroup={dataSrc:groupCols}),null!=customRender&&(opciones.render=customRender),$.fn.DataTable.isDataTable(`#${id}`)&&window["table"+id].destroy(),window["table"+id]=$(`#${id}`).DataTable(opciones),CoreUI.tableData.tableEventsClick(id,detailRows,endpoint),resolve(!0)})}},Modal:{GetHTML:function(id,html,titulo,texto,callback){$("body ."+id).length&&$("body ."+id).remove(),$("body").append(html),feather.replace(),$("body ."+id).modal("show")},CustomHTML:async function(texto,titulo,callback=null,modalWidth=null,growType=null,callbackOnClose=null){await Swal.fire({html:`${texto}`,title:titulo,showCancelButton:!1,showConfirmButton:!1,grow:""==growType?"fullscreen":growType,width:""==modalWidth?"32rem":modalWidth,didOpen:function(){null!==callback&&(console.log("callback didopen"),callback())},didClose:function(){null!==callbackOnClose&&(console.log("callback close"),callbackOnClose())}})},Success:function(texto,titulo,callback){Swal.fire({html:`${texto}`,title:titulo,icon:"success",showCancelButton:!1}).then(result=>{result.isConfirmed&&void 0!==callback&&callback()})},Info:function(texto,titulo,callback){Swal.fire({html:`${texto}`,title:"",icon:"info",showCancelButton:!1}).then(result=>{result.isConfirmed&&void 0!==callback&&callback()})},Error:function(texto,titulo,callback){Swal.fire({html:`${texto}`,title:"",icon:"error",showCancelButton:!1}).then(result=>{result.isConfirmed&&void 0!==callback&&callback()})}},Sidebar:{Comunidades:{cargarMenuComunidades:function(){var endpointComunidades="";core.Security.getUserInfo().then(result=>{switch(core.Security.getRole()){case"CONTRATISTA":endpointComunidades=`empresa/${core.Security.user}/comunidades`;break;case"ADMINFINCAS":break;default:return}apiFincatech.get(endpointComunidades).then(result=>{var datos,comunidades=JSON.parse(result).data.Comunidades.Comunidad,outHTML="";if($(".sidebar-nav").prepend('\n                        <div class="row pl-3 pr-3 sticky-top" style="background: #222e3c;">\n                            <div class="col-12 pb-2 pt-2 mb-3 mt-2">\n                                <p class="text-white text-uppercase mt-0 mb-0"><small>Buscar comunidad</small></p>\n                                <div class="row">\n                                    <div class="col-10">\n                                        <input type="text" class="form-control busquedaComunidad" placeholder="Escriba cód o nombre">\n                                    </div>\n                                    <div class="col-2 align-self-center">\n                                        <a href="javascript:void(0);" class="btnLimpiarBusqueda"><i class="bi bi-x-circle text-white"></i></a>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>'),comunidades.length>0)for(x=0;x<comunidades.length;x++)outHTML=`<li class="sidebar-item pl-3 pr-3 pb-2 pt-2" data-codigo="${comunidades[x].codigo}" data-nombre="${comunidades[x].nombre}">\n                                                <div class="row">\n                                                    <div class="col-1 text-left pl-0 pr-0 align-self-center">\n                                                        <img src="${config.baseURL}public/assets/img/icon_edificio.png" class="img-responsive feather">\n                                                    </div>   \n                                                    \n                                                    <div class="col-11 pr-0">\n                                                        <a href="${config.baseURL}comunidad/${comunidades[x].id}" class="text-white d-block">   \n                                                            <span class="align-middle comunidad-${comunidades[x].id} d-block" style="font-size: 13px;">${comunidades[x].codigo} ${comunidades[x].nombre}</span>\n                                                        </a>\n                                                    </div>  \n\x3c!--\n                                                    <div class="col-2 pr-0 text-center pl-0 align-self-center">\n                                                        <a href="javascript:void(0);" class="btnEliminarComunidad" data-id="${comunidades[x].codigo}" data-nombre="${comunidades[x].nombre}">\n                                                            <i data-feather="trash-2" class="text-danger"></i>\n                                                        </a>\n                                                    </div>\n--\x3e\n                                                </div>\n                                            </li>`,$(".navComunidades").append(outHTML);else $(".navComunidades").append('<p class="text-center text-white">No tiene comunidades asignadas</p>');$("body").on(core.helper.clickEventType,".btnLimpiarBusqueda",(function(evt){$(".busquedaComunidad").val(""),CoreUI.Sidebar.Comunidades.buscarComunidad()})),$("body").on("keyup",".busquedaComunidad",(function(evt){CoreUI.Sidebar.Comunidades.buscarComunidad()})),feather.replace()})})},buscarComunidad:function(){var textoBusqueda=$(".busquedaComunidad").val().toLowerCase();""!=textoBusqueda?$(".navComunidades .sidebar-item").each((function(e){$(this).attr("data-nombre").toLowerCase().indexOf(textoBusqueda)>=0||$(this).attr("data-codigo").toLowerCase().indexOf(textoBusqueda)>=0?$(this).removeClass("d-none"):$(this).addClass("d-none")})):$(".navComunidades .sidebar-item").removeClass("d-none")}}}};$(()=>{CoreUI.init});