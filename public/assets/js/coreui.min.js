let CoreUI={tituloModulo:null,init:function(){},setTitulo:function(value){CoreUI.tituloModulo=value},Utils:{parse:function(valor,data){let inicioPatron="data[",finalPatron="]";var posInicial=0;for(posInicial=valor.indexOf("data[");posInicial>=0;){if(posInicial>=0&&(posFinal=valor.indexOf("]",posInicial+1),posFinal>0)){campo=valor.substring(posInicial+"data[".length,posFinal);var find="data["+campo+"]",re=new RegExp(find,"g");valor=valor.replace(find,data[`${campo}`])}posInicial=valor.indexOf("data[",posInicial+1)}return valor},setTituloPantalla:function(entidad,campo,nombre=null){null===nombre?void 0!==core.Modelo.entity[entidad]&&null!==core.Modelo.entity[entidad]&&$(".titulo-modulo").text(core.Modelo.entity[entidad][0][campo]):$(".titulo-modulo").text(nombre)}},tableData:{_this:null,columns:[],init:function(){jQuery.extend(!0,jQuery.fn.dataTable.defaults,{language:{decimal:",",thousands:".",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoPostFix:"",infoFiltered:"(filtrado de un total de _MAX_ registros)",loadingRecords:"Cargando...",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},processing:"Procesando...",search:"Buscar:",searching:!0,searchPlaceholder:"",zeroRecords:"No se encontraron resultados",emptyTable:"Ningún dato disponible en esta tabla",aria:{sortAscending:": Activar para ordenar la columna de manera ascendente",sortDescending:": Activar para ordenar la columna de manera descendente"},buttons:{create:"Nuevo",edit:"Cambiar",remove:"Borrar",copy:"Copiar",csv:"fichero CSV",excel:"tabla Excel",pdf:"documento PDF",print:"Imprimir",colvis:"Visibilidad columnas",collection:"Colección",upload:"Seleccione fichero...."},select:{rows:{_:"%d filas seleccionadas",0:"clic fila para seleccionar",1:"una fila seleccionada"}}}})},extractFields:function(valor,datos){let inicioPatron="data:",finalPatron="$";var posInicial=0;for(posInicial=valor.indexOf("data:");posInicial>=0;){if(valorCampo="N/D",posInicial>=0&&(posFinal=valor.indexOf("$",posInicial+"data:".length+1),posFinal>0)){if(campo=valor.substring(posInicial+"data:".length,posFinal),campo.indexOf(".")>0)definicion=campo.split("."),void 0!==datos[definicion[0]][0]&&(valorCampo=datos[definicion[0]][0],valorCampo=valorCampo[definicion[1]]);else if(void 0!==datos[campo])switch(valorCampo=datos[campo],campo){case"created":valorCampo=moment(valorCampo).locale("es").format("L");break;case"estado":switch(valorCampo){case"H":valorCampo='<span class="badge rounded-pill bg-secondary d-block pt-2 pb-2">Histórico</span>';break;case"A":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Alta</span>';break;case"B":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">Baja</span>';break;case"P":valorCampo='<span class="badge rounded-pill bg-warning d-block pt-2 pb-2">Pendiente</span>'}break;case"solucionado":switch(valorCampo){case"0":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">Pendiente</span>';break;case"1":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Solucionada</span>'}break;case"activado":switch(valorCampo){case"0":valorCampo='<span class="badge rounded-pill bg-danger d-block pt-2 pb-2">No activo</span>';break;case"1":valorCampo='<span class="badge rounded-pill bg-success d-block pt-2 pb-2">Activado</span>'}}var find="data:"+campo+"$";valor=valor.replace(find,valorCampo)}posInicial=valor.indexOf("data:",posInicial+"data:".length+1)}return""==valor?"N/D":valor},addColumnRow:function(id,data){var columna={};void 0===CoreUI.tableData.columns[id]&&(CoreUI.tableData.columns[id]=[]),columna={className:"details-control",orderable:!1,data:data,defaultContent:"",render:function(){return'<i class="fa fa-plus-square" aria-hidden="true"></i>'},width:"15px"},CoreUI.tableData.columns[id].push(columna)},addColumn:function(id,nombre,titulo,renderHTML,clase,widthColumn){void 0===CoreUI.tableData.columns[id]&&(CoreUI.tableData.columns[id]=[]);var columna={};columna=null!=renderHTML?{title:titulo,data:null,width:widthColumn,className:clase,render:function(data,type,row,meta){return html=renderHTML,field="codigo",html=CoreUI.tableData.extractFields(html,data),feather.replace(),html}}:{data:nombre,width:widthColumn,render:null,title:titulo},CoreUI.tableData.columns[id].push(columna)},formatEmpresa:function(d){var canUploadFile=!1,needFileUpload=!1,fileLink="";"CONTRATISTA"==core.Security.getRole()&&(canUploadFile=!0);var salida='\n                <div class="table-responsive">\n                    <table border="0" class="table table-bordered table-light">\n                        <thead class="">\n                            <tr>\n                                <th style="background: #dee2e6 !important;">Requerimiento</th>\n                                <th class="text-center" style="background: #dee2e6 !important;width:150px;">Fecha última actuación</th>\n                                <th class="text-center" style="background: #dee2e6 !important;">Estado</th>\n                                <th style="background: #dee2e6 !important;">&nbsp;</th>';for(salida+="        \n                            </tr>\n                        </thead>",x=0;x<d.documentacioncae.length;x++)salida+=`\n                        <tr>\n                            <td>\n                            ${d.documentacioncae[x].requerimiento}\n                            </td>\n                            <td class="text-center" >`,""!=d.documentacioncae[x].fechaultimaactuacion&&null!=d.documentacioncae[x].fechaultimaactuacion?salida+=moment(d.documentacioncae[x].fechaultimaactuacion).locale("es").format("L"):salida+="No se ha realizado ninguna actuación",salida+="</td>",salida+='<td class="text-center" >'+(d.documentacioncae[x].idficherorequerimiento?'<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2">Disponible para descargar</span>':'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2">No adjuntado</span>')+"</td>",ficheroAdjuntado=!!d.documentacioncae[x].idficherorequerimiento,ficheroAdjuntado&&(salida+=' <td class="text-center">\n                                        <a href="javascript:void(0)" data-toggle="tooltip" data-placement="bottom" title="Ver documento" id="home" data-original-title="Ver documento">\n                                            <i class="bi bi-cloud-arrow-down text-success" style="font-size: 30px;"></i>\n                                        </a>\n                                    </td>'),!ficheroAdjuntado&&canUploadFile&&(dataset=` data-idcomunidad="${d.documentacioncae[x].idcomunidad}" data-idempresa="${d.id}" data-idempleado="" data-idrequerimiento="${d.documentacioncae[x].idrequerimiento}" data-idrelacionrequerimiento="${d.documentacioncae[x].idrelacion}" data-entidad="empresa" `,salida+=`<td class="text-center" ><a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" ${dataset} data-placement="bottom" title="" id="home" data-original-title="Adjuntar documento"><i class="bi bi-cloud-arrow-up text-success" style="font-size: 30px;"></i></a></td>`),ficheroAdjuntado||canUploadFile||(salida+="<td>&nbsp;</td>"),salida+="</tr>";return salida+="</table></div>"},format:function(d,id){var salida;switch(id){case"listadoEmpresa":case"listadoEmpresa":case"listadoEmpresaComunidad":salida=CoreUI.tableData.formatEmpresa(d)}return salida},render:function(id,entity,endpoint,allColumns,usePagination=!0,_search=!0,customRender=null){CoreUI.tableData.init();var detailRows=[],opciones={serverSide:!1,autoWidth:!0,select:!0,retrieve:!0,paging:usePagination,searching:_search,ajax:{url:config.baseURLEndpoint+endpoint,dataSrc:"data."+entity},columns:CoreUI.tableData.columns[id],columnDefs:[{targets:CoreUI.tableData.columns[id].length-1,className:"p-0 text-center"}],drawCallback:function(settings){feather.replace()}};null!=customRender&&(opciones.render=customRender),window["table"+id]=$(`#${id}`).DataTable(opciones),window["table"+id].on("draw",(function(){$.each(detailRows,(function(i,id){$("#"+id+" td.details-control").trigger("click")}))})),$("#"+id).on("click","tr td.details-control",(function(e){idTabla=$(this).parent().parent().parent().attr("id");var tr=$(this).closest("tr"),row=window["table"+idTabla].row(tr),idx=$.inArray(tr.attr("id"),detailRows);row.child.isShown()?(tr.removeClass("details"),row.child.hide(),detailRows.splice(idx,1)):(tr.addClass("details"),row.child(CoreUI.tableData.format(row.data(),idTabla)).show(),-1===idx&&detailRows.push(tr.attr("id"))),documentalCore.Events()})),$(`#${id}`).hasClass("no-clicable")||$(`#${id}`).on("click","tr > td",(function(e){if(console.log($(this)),$(this).html().indexOf("accionesTabla")>0)console.log("Ha clicado en acciones");else{var data=window["table"+id].row(this).data();window.location.href=baseURL+endpoint.toLowerCase().replace("list",data.id)}}))}},Modal:{GetHTML:function(id,html,titulo,texto,callback){$("body ."+id).length&&$("body ."+id).remove(),$("body").append(html),feather.replace(),$("body ."+id).modal("show")},CustomHTML:async function(texto,titulo,callback,modalWidth){await Swal.fire({html:`${texto}`,title:titulo,showCancelButton:!1,showConfirmButton:!1,width:""==modalWidth?"32rem":modalWidth})},Success:function(texto,titulo,callback){Swal.fire({text:`${texto}`,title:titulo,icon:"success",showCancelButton:!1}).then(result=>{result.isConfirmed&&void 0!==callback&&callback()})},Error:function(texto,titulo,callback){Swal.fire({text:`${texto}`,title:"",icon:"error",showCancelButton:!1}).then(result=>{result.isConfirmed&&void 0!==callback&&callback()})}}};$(()=>{CoreUI.init});