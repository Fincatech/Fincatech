let clickEventType=null!==document.ontouchstart?"click":"touchstart",baseURL="d"==environment?"/fincatech/":"/";var role=null,showingLoadComunidades=!1;const eventCoreInitialized=new CustomEvent("coreInitialized"),eventModelLoaded=new CustomEvent("modelLoaded");let Constantes={CargaComunidades:`\n   <div class="row">\n        <div class="col-12 text-center text-uppercase align-self-center">\n          <p class="m-0" style="display: block; font-size: 18px;">Importación de Comunidades</p>\n        </div>\n    </div>\n    <div class="row mb-2 wrapperInformacion">\n      <div class="col-12">\n          <p class="mt-3 text-justify" style="font-size: 14px;">1. Seleccione el administrador de fincas al que asignar las comunidades</p>\n          <p class="mt-3 text-justify" style="font-size: 14px;">2. Seleccione el fichero excel desde el que desea realizar la carga de comunidades de forma automática</p>\n          <p class="m-0 text-center" style="font-size: 14px;">\n            <a href="${baseURL}public/storage/plantilla_comunidades_fincatech.xlsx" target="_blank"><i class="bi bi-file-earmark-arrow-down"></i> Descargue la plantilla desde este enlace</a>\n          </p>\n          <p class="mt-3 text-left text-justify" style="font-size: 14px;">3. Una vez seleccionado, clique sobre el botón PROCESAR</p>\n      </div>\n    </div>\n    \x3c!-- Selector de administrador --\x3e\n    <div class="row mb-4 wrapperSelectorAdministrador">\n      <div class="col-12 text-left"><form>\n      <label for="administradorCargaId" class="mb-2">Seleccione el Administrador</label>\n      <select id="administradorCargaId" name="administradorCargaId" class="custom-select data form-control selectpicker mt-2" data-live-search="true" hs-entity="Administrador" hs-field="usuarioId" hs-list-entity="Administrador" hs-list-field="Usuario.nombre" hs-list-value="Usuario.id"></select></form>\n      </div>  \n    </div>\n\n    <div class="form-group row mb-2 justify-content-center wrapperSelectorFichero">\n      <div class="col-12">  \n          <div class="wrapperFichero row border rounded-lg ml-0 mr-0 mb-0 shadow-inset border-1 pt-3 pb-2">\n              <div class="col-2 align-self-center h-100 text-center">\n                  <i class="bi bi-cloud-arrow-up text-info" style="font-size: 30px;"></i>\n              </div>\n              <div class="col-10 pl-0 align-self-center">\n                  <input accept=".xls, .xlsx" class="form-control form-control-sm ficheroAdjuntarExcel border-0" hs-fichero-entity="Notasinformativas" id="ficheroAdjuntarExcel" type="file">\n              </div>       \n          </div>\n          <span class="pb-3 d-block text-center pt-2" style="font-size: 13px;">Sólo se permiten ficheros con extensión xls o xlsx</span>    \n          \n          \x3c!-- Mensaje de error --\x3e \n          <div class="wrapperMensajeErrorCarga row text-light p-3" style="display: none; font-size: 14px;">\n              <div class="col-12 bg-danger p-3 rounded shadow-neumorphic">\n                <p class="mensaje"></p>\n              </div>\n          </div>          \n\n          \x3c!-- Botón de iniciar proceso --\x3e\n          <div class="row mt-3">\n            <div class="col-12">\n              <a href="javascript:void(0);" class="btn d-block btn-success bntProcesarImportacion pt-3 pb-3">PROCESAR</a>\n            </div>\n          </div>\n      </div>\n    </div>\n\n    <div class="wrapperProgresoCarga row" style="display: none;">\n      <div class="col-12">\n          <label class="text-center mb-2 mt-3">Procesando</label>\n          <div class="progress mb-3" style="height: 30px;">\n            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">Animated</div>\n          </div>\n          <label class="d-block text-left mb-3"><strong>Administrador</strong>: <span class="importacionAdministrador"></span></label>\n          <label class="d-block text-left mb-3"><strong>Comunidad</strong>: <span class="importacionComunidad"></span></label>\n          <label class="progresoCarga d-block">(0 de 0 procesados)</label>\n          <div class="row mt-3 btnCerrarProceso" style="display: none;">\n            <div class="col-12">\n              <a href="javascript:swal.close();" class="btn btn-success">OK</a>\n            </div>\n          </div>\n      </div>\n    </div>\n    `,CargaDocumento:'\n   <div class="row">\n        <div class="col-12 text-center text-uppercase align-self-center">\n          <p class="m-0" style="display: block; font-size: 18px;"> Carga de documento</p>\n        </div>\n    </div>\n    <div class="row mb-2 wrapperInformacion">\n      <div class="col-12">\n          <p class="mt-3 text-justify" style="font-size: 14px;">1. Seleccione el fichero que desea adjuntar al requerimiento</p>\n          <p class="mt-3 text-justify" style="font-size: 14px;">2. Presione el botón <strong>Adjuntar documento</strong></p>\n      </div>\n    </div>\n    <div class="form-group row mb-2 justify-content-center wrapperSelectorFichero">\n      <div class="col-12">  \n          <div class="wrapperFichero row border rounded-lg ml-0 mr-0 mb-0 shadow-inset border-1 pt-3 pb-2">\n              <div class="col-2 align-self-center h-100 text-center">\n                  <i class="bi bi-cloud-arrow-up text-info" style="font-size: 30px;"></i>\n              </div>\n              <div class="col-10 pl-0 align-self-center">\n                  <input accept=".pdf, .doc, .docx" class="form-control form-control-sm ficheroAdjuntar border-0" hs-fichero-entity="Documental" id="ficheroadjuntar" name="ficheroadjuntar" type="file">\n              </div>       \n          </div>\n          <span class="pb-3 d-block text-center pt-2" style="font-size: 13px;">Sólo se permiten ficheros con extensión pdf, doc o docx</span>    \n          \n          \x3c!-- Mensaje de error --\x3e \n          <div class="wrapperMensajeErrorCarga row text-light p-3" style="display: none; font-size: 14px;">\n              <div class="col-12 bg-danger p-3 rounded shadow-neumorphic">\n                <p class="mensaje"></p>\n              </div>\n          </div>          \n\n          \x3c!-- Botón de iniciar proceso --\x3e\n          <div class="row mt-3">\n            <div class="col-12">\n              <a href="javascript:void(0);" class="btn d-block btn-success bntUploadDocumento pt-3 pb-3">Adjuntar documento</a>\n            </div>\n          </div>\n      </div>\n    </div>\n    ',AsignacionEmpresa:'\n    <div class="row">\n        <div class="col-12 text-center text-uppercase align-self-center">\n          <p class="m-0" style="display: block; font-size: 18px;"> Asociar empresa externa a comunidad</p>\n        </div>\n    </div>\n    <div class="row mb-2 wrapperInformacion">\n      <div class="col-12">\n          <p class="mt-3 text-center" style="font-size: 14px;">Para asignar una empresa, puede buscar e-mail.</p>\n          <p class="mt-3 text-center" style="font-size: 14px;">Si no encuentra la empresa que desea asociar, puede crear una nueva clicando sobre el botón <strong>CREAR NUEVA EMPRESA</strong>. Una vez creada la empresa, ésta será asignada automáticamente a la comunidad actual.</p>\n      </div>\n    </div>\n\n    \x3c!-- input de empresa --\x3e\n    <div class="row mb-4 wrapperBusquedaEmpresa">\n      <div class="col-12 col-sm-10">\n        <div class="form-group">\n          <input type="text" class="form-control" id="searchEmpresa" name="searchEmpresa" placeholder="Escriba el e-mail de la empresa que desea buscar">\n        </div>\n      </div>\n      <div class="col-12 col-sm-2">\n        <a href="javascript:void(0);" class="btn btn-primary btnBuscarEmpresaCAE pt-1 pb-1 d-block"><i class="bi bi-search"></i> BUSCAR EMPRESA</a>\n      </div>\n      <div class="col-12">\n        <p class="m-0 mensaje">&nbsp;</p>\n      </div>\n    </div>\n\n    \x3c!-- Información de la empresa --\x3e\n    <div class="row mb-4 wrapperInfoEmpresa" style="display: none;">\n        <div class="col-12">\n          <div class="card">\n            <div class="card-body shadow-inset">\n                <p class="font-weight-bold"><span class="nombreEmpresa"></p>\n                <p><span class="cifEmpresa"></p>\n                <p><span class="emailEmpresa"></p>\n                <div class="clearfix mt-3">&nbsp;</div>\n                <p>Si los datos son correctos, clique sobre el botón <strong>ASIGNAR</strong> para asociarla a la comunidad</p>\n                <a href="javascript:void(0);" class="btnConfirmarEmpresaCAE d-inline-block btn btn-sm btn-success" data-id="" data-nombre="">ASIGNAR</a>\n            </div>\n          </div>\n        </div>\n    </div>\n\n    \x3c!-- Listado simple de empresas del sistema--\x3e\n\n    <div class="row mb-4 wrapperSelectorEmpresa d-none">\n\n      <div class="col-12 text-left">\n\n          <div class="card-body shadow-inset rounded-lg border mb-1 border-white space-between">\n\n          \x3c!-- Empresas --\x3e\n\n              <div class="row flex-grow-1">\n                  <div class="col-12">\n\n                      <div class="card">\n\n                          <div class="card-header pl-0 pt-0">\x3c!--headerListado--\x3e\n\n                              <div class="row">\n\n                                  <div class="col-12 col-md-9">\n                                      <h5 class="card-title mb-0 text-uppercase font-weight-normal pl-3 pt-1"><i class="bi bi-shop pr-2"></i> Empresas disponibles</h5>\n                                  </div>\n                      \n                              </div>\n\n                          </div>\n\n                          <div class="card-body">\n\n                              <table class="table table-hover my-0 hs-tabla w-100" name="listadoSimpleEmpresas" id="listadoSimpleEmpresas" data-model="Empresa">\n                                  <thead></thead>\n                                  <tbody></tbody>\n                              </table>\n\n                          </div>\n\n                      </div>\n\n                  </div>\n              </div>\n\n          </div>\n\n      </div>  \n\n    </div>\n\n    <div class="form-group row mb-2 justify-content-center wrapperCrearNuevaEmpresa">\n      <div class="col-12">           \n          \x3c!-- Botón de crear empresa y asignar a comunidad --\x3e\n          <div class="row mt-3">\n            <div class="col-12 text-center">\n              <a href="javascript:void(0);" class="btn btn-success bntCrearNuevaEmpresaCAE pt-1 pb-1" style="display: none;">CREAR NUEVA EMPRESA</a>\n            </div>\n          </div>\n      </div>\n    </div>\n    ',CargaDocumentoRGPD:'\n    <div class="row">\n         <div class="col-12 text-center text-uppercase align-self-center">\n           <p class="m-0" style="display: block; font-size: 18px;"> Carga de documento</p>\n         </div>\n     </div>\n     <div class="row mb-2 wrapperInformacion">\n       <div class="col-12">\n           <p class="mt-3 text-justify" style="font-size: 14px;">1. Seleccione el fichero que desea adjuntar</p>\n           <p class="mt-3 text-justify" style="font-size: 14px;">2. Presione el botón <strong>Adjuntar documento</strong></p>\n       </div>\n     </div>\n     <div class="form-group row mb-2 justify-content-center wrapperSelectorFichero">\n       <div class="col-12">  \n           <div class="wrapperFichero row border rounded-lg ml-0 mr-0 mb-0 shadow-inset border-1 pt-3 pb-2">\n               <div class="col-2 align-self-center h-100 text-center">\n                   <i class="bi bi-cloud-arrow-up text-info" style="font-size: 30px;"></i>\n               </div>\n               <div class="col-10 pl-0 align-self-center">\n                   <input accept=".pdf, .doc, .docx" class="form-control form-control-sm ficheroAdjuntar border-0" hs-fichero-entity="Documental" id="ficheroadjuntar" name="ficheroadjuntar" type="file">\n               </div>       \n           </div>\n           <span class="pb-3 d-block text-center pt-2" style="font-size: 13px;">Sólo se permiten ficheros con extensión pdf, doc o docx</span>    \n           \n          <div class="row form-group wrapperTituloDocumento text-left">\n            <div class="col-12">\n              <label>Título</label>\n              <input type="text" class="form-control w-100 tituloDocumentoRGPD mt-2" id="tituloDocumentoRGPD" maxlength="40" name="tituloDocumentoRGPD">\n            </div>\n          </div>\n          <div class="row form-group wrapperObservaciones text-left mt-2">\n            <div class="col-12">\n              <label>Descripción</label>\n              <textarea class="form-control w-100 observacionesDocumentoRGPD shadow-inset border-0 mt-2" id="observacionesDocumentoRGPD" rows="3" name="observacionesDocumentoRGPD"></textarea>\n            </div>\n          </div>          \n           \x3c!-- Mensaje de error --\x3e \n           <div class="wrapperMensajeErrorCarga row text-light p-3" style="display: none; font-size: 14px;">\n               <div class="col-12 bg-danger p-3 rounded shadow-neumorphic">\n                 <p class="mensaje"></p>\n               </div>\n           </div>          \n \n           \x3c!-- Botón de adjuntar documento --\x3e\n           <div class="row mt-3">\n             <div class="col-12">\n               <a href="javascript:void(0);" class="btn d-block btn-success bntUploadDocumentoRGPD pt-3 pb-3">Adjuntar documento</a>\n             </div>\n           </div>\n       </div>\n     </div>\n     '},core={model:null,actionModel:null,modelId:null,init:async function(){if(core.model=$("body").attr("hs-model"),core.actionModel=$("body").attr("hs-action"),core.modelId=$("body").attr("hs-model-id"),"Login"===core.model||"Register"===core.model)core.Security.init();else switch(core.actionModel){case"get":case"add":await core.Forms.init();break;case"list":core.model;break}new Promise((async(e,a)=>{await core.Security.getUserInfo().then((()=>{e(!0)}))})).then((e=>{core.Events(),document.dispatchEvent(eventCoreInitialized)}))},Events:function(){$("body").on(core.helper.clickEventType,".btnLogout",(function(){core.Security.logout()})),$("body").on(core.helper.clickEventType,".btnSaveData",(function(){core.Forms.Save(!1)})),$("body").on(core.helper.clickEventType,".btnCargarComunidadesExcel",(async function(){const{value:e}=await Swal.fire({title:"",html:Constantes.CargaComunidades,showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,didOpen:function(){showingLoadComunidades=!0,core.Files.init(),core.Forms.getSelectData("Administrador","Usuario.nombre","Usuario.id","usuarioId",$("#administradorCargaId").attr("hs-value"),$("#administradorCargaId").prop("id"),!1).then((()=>{$("#administradorCargaId").select2({dropdownParent:$(".swal2-container")})})),$("body").on(core.helper.clickEventType,".bntProcesarImportacion",(function(){comunidadesCore.Import.importarComunidades()}))}})})),$("body").on(core.helper.clickEventType,".btnChangePassword",(function(e){core.Security.changePassword()})),$("body").on(core.helper.clickEventType,".btnResetpassword",(function(e){core.Security.resetPassword()}))},helper:{clickEventType:null!==document.ontouchstart?"click":"touchstart",sortList:function(e){$(e).find("option").sort((function(e,a){return Number(e.innerHTML)-Number(a.innerHTML)})).each((function(e,a){$(a).parent().append(a)}))},validarEmail:e=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.toLowerCase()),getCookie:function(e){let a=e+"=",t=decodeURIComponent(document.cookie).split(";");for(let e=0;e<t.length;e++){let o=t[e];for(;" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(a))return o.substring(a.length,o.length)}return""},parseJwt:function(e){var a=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),t=decodeURIComponent(window.atob(a).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(t)}},Files:{Fichero:Object(),file:null,init:async function(){core.Files.Fichero.entidad=null,core.Files.Fichero.entidadId=null,core.Files.Fichero.nombre=null,core.Files.Fichero.base64=null,core.Files.events()},events:function(){if(!$("#ficheroadjuntar").length)return;document.getElementById("ficheroadjuntar").addEventListener("change",(e=>{const a=e.target.files[0];if(void 0!==a){const e=new FileReader;e.onloadend=()=>{const a=e.result;core.Files.Fichero.base64=a,core.Files.Fichero.entidad=core.model;var t=document.getElementById("ficheroadjuntar").value;if(t){var o=t.indexOf("\\")>=0?t.lastIndexOf("\\"):t.lastIndexOf("/"),r=t.substring(o);0!==r.indexOf("\\")&&0!==r.indexOf("/")||(r=r.substring(1)),core.Files.Fichero.nombre=r}},e.readAsDataURL(a)}else core.Files.Fichero.base64="",core.Files.Fichero.nombre=""}))},isExcelFile:function(e){var a=$(`#${e}`).val().toLowerCase();return extension=a.substring(a.lastIndexOf(".")+1),"xls"===extension||"xlsx"===extension},isPDFFile:function(e){var a=$(`#${e}`).val().toLowerCase();return extension=a.substring(a.lastIndexOf(".")+1),"pdf"===extension}},Forms:{data:null,promiseInitialization:null,errorMessage:"",triggerEventLoaded:function(e){var a="body .form-data";e&&(a=e),$("body").trigger("hsFormDataLoaded",$(a).attr("id")),document.dispatchEvent(eventModelLoaded)},init:function(){new Promise((async function(e,a){await core.Forms.initializeSelectData(),e(!0)})).then((function(){return!0}))},getModelo:function(){""!=core.modelId&&apiFincatech.get(core.model+"/"+core.modelId).then((e=>{var a=JSON.parse(e).status;if("error"===a.response)return void("403"===a.error&&apiFincatech.getView("comunes","403","",".content .container-fluid"));let t=JSON.parse(e),o=Object.getOwnPropertyNames(t.data.schema);if(core.model=o[0],core.Modelo.entity[core.model]=t.data[core.model],core.Forms.mapData(),$("#password").length&&$("#password").val(""),null!==CoreUI.tituloModulo){var r="";if(Array.isArray(CoreUI.tituloModulo))for(var n=0;n<CoreUI.tituloModulo.length;n++)r+=core.Modelo.entity[core.model][0][CoreUI.tituloModulo[n]]+" ";else r=core.Modelo.entity[core.model][0][CoreUI.tituloModulo];CoreUI.Utils.setTituloPantalla(null,null,r)}core.Forms.triggerEventLoaded(null)}))},getSchema:async function(){return apiFincatech.get(core.model.toLowerCase()+"/schema").then((e=>{core.Modelo.schema=e}))},initializeSelectData:async function(){let e;$("body .form-data .select-data").length;e=new Promise((async function(e,a){$("body .form-data .select-data").length?$("body .form-data .select-data").each((function(){var a=!1,t=$(this).attr("hs-list-entity"),o=$(this).attr("hs-list-field"),r=$(this).attr("hs-list-value"),n=$(this).prop("id");$(this).attr("hs-field"),$(this).attr("hs-value");void 0!==$(this).attr("hs-seleccionar")&&(a="false"!=$(this).attr("hs-seleccionar"));let s=new Promise((async function(e,s){await core.Forms.getSelectData(t,o,r,null,null,n,a).then((()=>{e(!0)}))}));s.then((a=>{e(!0)}))})):e(!0)})),e.then((function(){return core.Forms.getModelo(),e}))},getSelectData:async function(e,a,t,o,r,n,s){return $("body #"+n).html(""),new Promise((function(o,r){apiFincatech.get(`${e}/list?target=cbo`).then((r=>{var i="",c=JSON.parse(r);if(responseData=c.data,a.indexOf(".")>=0){var d=a.split(".");e=d[0],a=d[1]}if(t.indexOf(".")>=0){d=t.split(".");e=d[0],t=d[1]}for(s&&(i='<option value="-1" disabled selected="selected">Seleccione una opción</option>',$("body #"+n).append(i)),x=0;x<responseData[e].length;x++){i=`<option value="${responseData[e][x][t]}">${responseData[e][x][a]}</option>`,$("body #"+n).append(i)}$("body #"+n).select2({theme:"bootstrap4",placeholder:"Seleccione una opción"}),o(!0)}))})).then((function(){return!0}))},mapDataFromModel:function(e,a){$(`#${e}`).length&&$(`#${e} .data`).each((function(){var e=$(this).attr("hs-entity"),t=$(this).attr("hs-field"),o="";if(o=void 0===a[e]?a[t]:a[e][t],"password"!=t)if($(this).hasClass("select-data")){var r=$(this).attr("id");void 0!==a[r]&&-1!==a[r]&&""!==o&&($(`#${r}`).val(o),$(`#${r}`).trigger("change"))}else $(this).hasClass("form-check-input")?1==o?$(this).attr("checked",!0):$(this).attr("checked",!1):$(this).val(o);else $(this).val("")}))},mapData:async function(e=null){try{var a,t,o,r="body .form-data",n="";null!==e&&(r=`body .${e}`),$(r).length&&($(`${r} .data`).each((function(){if(a=$(this).attr("hs-entity"),t=$(this).attr("hs-field"),void 0===(o=$(this).attr("hs-entity-related"))?void 0!==core.Modelo.entity[a][0][t]&&(n=core.Modelo.entity[a][0][t]):void 0!==core.Modelo.entity[a][0][o][0][t]&&(n=core.Modelo.entity[a][0][o][0][t]),"password"!=t)if($(this).hasClass("select-data")){var e=$(this).attr("id");void 0!==e&&-1!==e&&""!==n&&null!==n&&($(`body #${e} option[value=${n}]`).attr("selected","selected"),$(`body #${e}`).val(n),$(`body #${e}`).trigger("change"))}else $(this).hasClass("form-check-input")?1==n?$(this).attr("checked",!0):$(this).attr("checked",!1):($(this).is('[type="date"]')&&(n=moment(n).format("YYYY-MM-DD")),$(this).val(n),$(this).is("a")&&$(this).attr("href",n),($(this).is("label")||$(this).is("span")||$(this).is("div"))&&$(this).html(n));else $(this).val("")})),$(".selectpicker").each((function(){})),$('body input[type="number"]').each((function(e){void 0!==$(this).attr("value")&&$(this).val($(this).attr("value"))})))}catch(e){}},getValueByTipoCampo:function(e){return e.is("select")?null==e.val()||""==e.val()?-1:e.val():e.is("checkbox")||"checkbox"==e.attr("type")?e.is(":checked")?1:0:e.val()},prepareFormDataBeforeSend:function(e){core.Forms.data=Object();var a=$(`body #${e}`).attr("data-model");$(`body .${e} .data`).each((function(){var e=$(this).attr("hs-field"),t=$(this).attr("hs-entity"),o=null;void 0!==$(this).attr("hs-entity-related")&&null!==$(this).attr("hs-entity-related")&&(o=$(this).attr("hs-entity-related")),t==a&&null==o?("id"!=e&&(core.Forms.data[e]=$(this).val()),core.Forms.data[e]=core.Forms.getValueByTipoCampo($(this))):"id"!=e&&(void 0===core.Forms.data[o]&&(core.Forms.data[o]={}),core.Forms.data[o][e]=core.Forms.getValueByTipoCampo($(this)))}))},mapFormDataToSave:function(e,a=null){core.Forms.data={},null==e&&(e="form-data");$(`body .${e}`).attr("hs-model");$(`body .${e} .data`).each((function(){var e=$(this).attr("hs-field");$(this).attr("hs-entity");core.Forms.data[e]=core.Forms.getValueByTipoCampo($(this))}))},mapDataToSave:function(e=null){core.Forms.data={},null==e&&(e="form-data"),$(`body .${e} .data`).each((function(){var e=$(this).attr("hs-field"),a=$(this).attr("hs-entity"),t=null;void 0!==$(this).attr("hs-entity-related")&&null!==$(this).attr("hs-entity-related")&&(t=$(this).attr("hs-entity-related")),a==core.model&&null==t?("id"!=e&&(core.Forms.data[e]=$(this).val()),core.Forms.data[e]=core.Forms.getValueByTipoCampo($(this))):"id"!=e&&(void 0===core.Forms.data[t]&&(core.Forms.data[t]={}),core.Forms.data[t][e]=core.Forms.getValueByTipoCampo($(this)))})),"get"==core.actionModel&&""!=core.Forms.data.id&&(core.Forms.data.id=core.modelId)},Save:async function(e=!0){$("body").attr("hs-model");var a=$("body").attr("hs-model-id"),t=$("body").attr("hs-action");switch(0==e&&(core.Forms.data={},core.Forms.mapDataToSave()),t){case"get":core.Modelo.Update(core.model.toLowerCase(),a,core.Forms.data);break;case"add":core.Modelo.Insert(core.model.toLowerCase(),core.Forms.data,!0);break}},GetErrorMessage:function(){return core.Forms.errorMessage},SetError:function(e){core.Forms.errorMessage=`${core.Forms.errorMessage}<br/><i class="bi bi-x-circle mr-3 text-danger"></i>${e} `},ShowErrorMessage:function(){let e=core.Forms.GetErrorMessage();""!==e&&CoreUI.Modal.Error(`Se han detectado los siguientes errores, por favor, corríjalos para continuar:<br><br><p class="text-left">${e}</p>`,"Error")},Validate:function(e=null){let a=!0;return core.Forms.errorMessage="",$(".form-error").removeClass("form-error"),null==e&&(e="form-data"),0==$(`body .${e} .form-required`).length||($(`body .${e} .form-required`).each((function(){""==$(this).val()&&($(this).hasClass("form-error")||(void 0!==$(this).attr("form-error-message")&&core.Forms.SetError($(this).attr("form-error-message")),$(this).addClass("form-error")),a=!1)})),a)}},Modelo:{entity:Object(),schema:Object(),insertedId:null,getAll:async function(e){var a={};null!=e&&(a=e),await apiFincatech.post(`${core.modeltoLowerCase()}/list`,a).then((async e=>{result=JSON.parse(e),responseStatus=result.status,responseData=result.data})).catch((function(e){}))},Insert:async function(e,a,t=!0,o="",r=!0,n=!0){await apiFincatech.post(`${e}/create`,a,n).then((async a=>{var n=JSON.parse(a);if("ok"==n.status.response){if(core.Modelo.insertedId=n.data.id,t){var s=n.data.id;$("body").attr("hs-action","get"),$("body").attr("hs-model-id",s),core.actionModel="get",core.modelId=s}""!==o&&!1!==o?CoreUI.Modal.Success(o):r&&CoreUI.Modal.Success("Los datos se han guardado satisfactoriamente"),"comunidad"==e.toLowerCase()&&"ADMINFINCAS"==core.Security.getRole()&&comunidadesCore.renderMenuLateral()}else CoreUI.Modal.Error("No se ha podido guardar por el siguiente motivo:<br><br>"+n.status.error)}))},Delete:async function(e,a,t,o,r=null,n=null){Swal.fire({title:null==r?"¿Desea eliminar el registro y toda la información relacionada?":r,text:null==n?`${t}`:n,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&apiFincatech.delete(e,a).then((a=>{Swal.fire("Registro eliminado correctamente","","success"),void 0!==window[`table${o}`]&&window[`table${o}`].ajax.reload(),"ADMINFINCAS"==core.Security.getRole()&&"comunidad"==e.toLowerCase()&&comunidadesCore.renderMenuLateral()}))}))},Update:async function(e,a,t){await apiFincatech.put(`${e}/${a}`,t).then((async e=>{var a=JSON.parse(e);"ok"==a.status.response?CoreUI.Modal.Success("Los datos se han actualizado satisfactoriamente"):Modal.Error("No se ha podido guardar por el siguiente motivo:<br><br>"+a.status.response)}))}},Security:{user:null,userData:null,init:function(){this.events(),core.model="Login",$("#email").length&&$("#email").focus(),$("#email").val(""),$("#password").val(""),$("form").attr("autocomplete","off"),$("input").attr("autocomplete","off")},events:function(){$("body").on(core.helper.clickEventType,".btnAuthenticate",(function(e){core.Forms.Validate()?(core.Forms.mapDataToSave(),core.Security.checkLogin(core.Forms.data)):CoreUI.Modal.Error("Debe proporcionar todos los datos obligatorios")})),$("input").keyup((function(e){(13===e.key||13===e.keyIdentifier||13===e.keyCode)&&$(".btnAuthenticate").trigger("click")}))},getUserInfo:async function(){await apiFincatech.get("userinfo").then((e=>{respuesta=JSON.parse(e),core.Security.user=respuesta.data.id,core.Security.rgpd=respuesta.data.rgpd,core.Security.userData=respuesta.data,null!=respuesta.user.nombre&&""!=respuesta.user.nombre?$(".usuarioFincatech").text(respuesta.user.nombre):$(".usuarioFincatech").text("Fincatech")}))},logout:async function(){await apiFincatech.get("logout").then((e=>{respuesta=JSON.parse(e),"ok"==respuesta.data.logout&&(window.location.href=baseURL+"login")}))},checkLogin:async function(e){await apiFincatech.post("checklogin",e).then((e=>{respuesta=JSON.parse(e),!1===respuesta.data.check?CoreUI.Modal.Error("El e-mail y/o contraseña proporcionada es incorrecto"):window.location.href="dashboard"}))},changePassword:async function(){const{value:e}=await Swal.fire({title:'<i class="bi bi-lock"></i> Cambiar contraseña',html:'\n            <div class="row pl-3 pr-3 pt-3">\n              <div class="col-12">\n                <div class="row">\n                  <div class="col-12 text-left">\n                      <label for="nuevopassword">Contraseña</label>\n                      <input id="nuevopassword" type="text" placeholder="Contraseña" class="form-control">\n                  </div>\n                </div>\n                <div class="row mt-3">\n                  <div class="col-12 text-left">\n                    <label for="confirmpassword">Confirmar contraseña</label>\n                    <input id="confirmpassword" type="text" placeholder="Confirmación contraseña" class="form-control">\n                  </div>\n                </div>\n                <div class="row">\n                  <div class="col-12">\n                    <p class="errorValidation text-danger" style="display: none;">&nbsp;</p>\n                  </div>\n                </div>\n              </div>\n            </div>',focusConfirm:!1,preConfirm:()=>{var e="";if($("#nuevopassword").val()!=$("#confirmpassword").val()&&(e="Las contraseñas no coinciden<br>"),""!=$("#nuevopassword").val()&&""!=$("#confirmpassword").val()||(e+="Debe escribir la nueva contraseña y su confirmación<br>"),($("#nuevopassword").val().length<5||$("#confirmpassword").val().length<5)&&(e+="La longitud de la contraseña es inferior a 5 caracteres<br>"),""!==e)return $(".errorValidation").html(e),$(".errorValidation").show(),!1;var a={password:core.Security.MD5($("#nuevopassword").val())};return apiFincatech.post("changepassword",a).then((e=>{"ok"==JSON.parse(e).data.changepassword?CoreUI.Modal.Success("La contraseña se ha cambiado correctamente. Por su seguridad se va a cerrar sesión para que entre con la nueva contraseña.","Cambiar contraseña",(function(){core.Security.logout()})):CoreUI.Modal.Error("La contraseña no ha podido cambiarse","Cambiar contraseña")})),!0}})},resetPassword:async function(){if(""!=$("#email").val()){var e={email:$("#email").val()};apiFincatech.post("resetpassword",e).then((e=>{var a=JSON.parse(e);"error"==a.status.response?(CoreUI.Modal.Error(a.status.error,"E-mail no encontrado"),$("#email").val("")):"ok"==a.data.resetpassword?(CoreUI.Modal.Success("Le hemos enviado un e-mail con la nueva contraseña. Podrá cambiar la misma, en su perfil. Por favor, compruebe su bandeja de entrada o la carpeta de correo no deseado.","Contraseña reestablecida"),$("#email").val("")):CoreUI.Modal.Error("La contraseña no ha podido reestablecerse","Reestablecer contraseña")}))}else CoreUI.Modal.Error("Escriba el correo electrónico con el que accede a la plataforma","Reestablecer contraseña")},_changePassword:async function(){const{value:e}=await Swal.fire({title:"Cambiar contraseña",input:"text",inputLabel:"Nueva contraseña",inputPlaceholder:"Escriba la nueva contraseña",inputAttributes:{maxlength:15,autocapitalize:"off",autocorrect:"off"}});if(e){var a={password:core.Security.MD5(e)};apiFincatech.post("changepassword",a).then((e=>{"ok"==JSON.parse(e).data.changepassword?CoreUI.Modal.Success("La contraseña se ha cambiado correctamente. Por su seguridad se va a cerrar sesión para que entre con la nueva contraseña.","Cambiar contraseña",(function(){core.Security.logout()})):CoreUI.Modal.Error("La contraseña no ha podido cambiarse","Cambiar contraseña")}))}else CoreUI.Modal.Info("La contraseña no ha sido cambiada","Cambiar contraseña")},getRole:function(){return $("body").attr("hs-role")},MD5:function(e){return md5(e).toLowerCase()}},Validator:{Email:function(e){if(""===e||void 0===e)return!1;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.toLowerCase())},checkIBAN:function(e){if(""==e)return!1;if(24==e.length&&core.Validator.getCodigoControl_IBAN(e.substr(0,2).toUpperCase(),e.substr(4))==e.substr(2,2))return!0;return!1},getCodigoControl_IBAN:function(e,a){valoresPaises={A:"10",B:"11",C:"12",D:"13",E:"14",F:"15",G:"16",H:"17",I:"18",J:"19",K:"20",L:"21",M:"22",N:"23",O:"24",P:"25",Q:"26",R:"27",S:"28",T:"29",U:"30",V:"31",W:"32",X:"33",Y:"34",Z:"35"};var t=a+valoresPaises[e.substr(0,1)]+valoresPaises[e.substr(1,1)]+"00",o=98-core.Validator.modulo(t,97);return 1==o.length&&(o="0"+o),o},modulo:function(e,a){for(var t=0,o=0;o<e.length;o+=10)t=(t+""+e.substr(o,10))%a;return t}}};function md5(e){return rstr2hex(binl2rstr(binl_md5(rstr2binl(e),8*e.length)))}function rstr2hex(e){for(var a,t="0123456789ABCDEF",o="",r=0;r<e.length;r++)a=e.charCodeAt(r),o+=t.charAt(a>>>4&15)+t.charAt(15&a);return o}function rstr2binl(e){for(var a=Array(e.length>>2),t=0;t<a.length;t++)a[t]=0;for(t=0;t<8*e.length;t+=8)a[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return a}function binl2rstr(e){for(var a="",t=0;t<32*e.length;t+=8)a+=String.fromCharCode(e[t>>5]>>>t%32&255);return a}function binl_md5(e,a){e[a>>5]|=128<<a%32,e[14+(a+64>>>9<<4)]=a;for(var t=1732584193,o=-271733879,r=-1732584194,n=271733878,s=0;s<e.length;s+=16){var i=t,c=o,d=r,l=n;o=md5_ii(o=md5_ii(o=md5_ii(o=md5_ii(o=md5_hh(o=md5_hh(o=md5_hh(o=md5_hh(o=md5_gg(o=md5_gg(o=md5_gg(o=md5_gg(o=md5_ff(o=md5_ff(o=md5_ff(o=md5_ff(o,r=md5_ff(r,n=md5_ff(n,t=md5_ff(t,o,r,n,e[s+0],7,-680876936),o,r,e[s+1],12,-389564586),t,o,e[s+2],17,606105819),n,t,e[s+3],22,-1044525330),r=md5_ff(r,n=md5_ff(n,t=md5_ff(t,o,r,n,e[s+4],7,-176418897),o,r,e[s+5],12,1200080426),t,o,e[s+6],17,-1473231341),n,t,e[s+7],22,-45705983),r=md5_ff(r,n=md5_ff(n,t=md5_ff(t,o,r,n,e[s+8],7,1770035416),o,r,e[s+9],12,-1958414417),t,o,e[s+10],17,-42063),n,t,e[s+11],22,-1990404162),r=md5_ff(r,n=md5_ff(n,t=md5_ff(t,o,r,n,e[s+12],7,1804603682),o,r,e[s+13],12,-40341101),t,o,e[s+14],17,-1502002290),n,t,e[s+15],22,1236535329),r=md5_gg(r,n=md5_gg(n,t=md5_gg(t,o,r,n,e[s+1],5,-165796510),o,r,e[s+6],9,-1069501632),t,o,e[s+11],14,643717713),n,t,e[s+0],20,-373897302),r=md5_gg(r,n=md5_gg(n,t=md5_gg(t,o,r,n,e[s+5],5,-701558691),o,r,e[s+10],9,38016083),t,o,e[s+15],14,-660478335),n,t,e[s+4],20,-405537848),r=md5_gg(r,n=md5_gg(n,t=md5_gg(t,o,r,n,e[s+9],5,568446438),o,r,e[s+14],9,-1019803690),t,o,e[s+3],14,-187363961),n,t,e[s+8],20,1163531501),r=md5_gg(r,n=md5_gg(n,t=md5_gg(t,o,r,n,e[s+13],5,-1444681467),o,r,e[s+2],9,-51403784),t,o,e[s+7],14,1735328473),n,t,e[s+12],20,-1926607734),r=md5_hh(r,n=md5_hh(n,t=md5_hh(t,o,r,n,e[s+5],4,-378558),o,r,e[s+8],11,-2022574463),t,o,e[s+11],16,1839030562),n,t,e[s+14],23,-35309556),r=md5_hh(r,n=md5_hh(n,t=md5_hh(t,o,r,n,e[s+1],4,-1530992060),o,r,e[s+4],11,1272893353),t,o,e[s+7],16,-155497632),n,t,e[s+10],23,-1094730640),r=md5_hh(r,n=md5_hh(n,t=md5_hh(t,o,r,n,e[s+13],4,681279174),o,r,e[s+0],11,-358537222),t,o,e[s+3],16,-722521979),n,t,e[s+6],23,76029189),r=md5_hh(r,n=md5_hh(n,t=md5_hh(t,o,r,n,e[s+9],4,-640364487),o,r,e[s+12],11,-421815835),t,o,e[s+15],16,530742520),n,t,e[s+2],23,-995338651),r=md5_ii(r,n=md5_ii(n,t=md5_ii(t,o,r,n,e[s+0],6,-198630844),o,r,e[s+7],10,1126891415),t,o,e[s+14],15,-1416354905),n,t,e[s+5],21,-57434055),r=md5_ii(r,n=md5_ii(n,t=md5_ii(t,o,r,n,e[s+12],6,1700485571),o,r,e[s+3],10,-1894986606),t,o,e[s+10],15,-1051523),n,t,e[s+1],21,-2054922799),r=md5_ii(r,n=md5_ii(n,t=md5_ii(t,o,r,n,e[s+8],6,1873313359),o,r,e[s+15],10,-30611744),t,o,e[s+6],15,-1560198380),n,t,e[s+13],21,1309151649),r=md5_ii(r,n=md5_ii(n,t=md5_ii(t,o,r,n,e[s+4],6,-145523070),o,r,e[s+11],10,-1120210379),t,o,e[s+2],15,718787259),n,t,e[s+9],21,-343485551),t=safe_add(t,i),o=safe_add(o,c),r=safe_add(r,d),n=safe_add(n,l)}return Array(t,o,r,n)}function md5_cmn(e,a,t,o,r,n){return safe_add(bit_rol(safe_add(safe_add(a,e),safe_add(o,n)),r),t)}function md5_ff(e,a,t,o,r,n,s){return md5_cmn(a&t|~a&o,e,a,r,n,s)}function md5_gg(e,a,t,o,r,n,s){return md5_cmn(a&o|t&~o,e,a,r,n,s)}function md5_hh(e,a,t,o,r,n,s){return md5_cmn(a^t^o,e,a,r,n,s)}function md5_ii(e,a,t,o,r,n,s){return md5_cmn(t^(a|~o),e,a,r,n,s)}function safe_add(e,a){var t=(65535&e)+(65535&a);return(e>>16)+(a>>16)+(t>>16)<<16|65535&t}function bit_rol(e,a){return e<<a|e>>>32-a}$((function(){apiFincatech.init(),core.init(),$(".loading").hide()}));