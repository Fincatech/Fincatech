let clickEventType=null!==document.ontouchstart?"click":"touchstart",environment="d",baseURL="/fincatech/",core={model:null,actionModel:null,modelId:null,init:async function(){switch(core.model=$("body").attr("hs-model"),core.actionModel=$("body").attr("hs-action"),core.modelId=$("body").attr("hs-model-id"),core.actionModel){case"get":case"add":await core.Forms.init();break;case"list":await core.Modelo.getAll()}core.Events()},Events:function(){$("body").on(core.helper.clickEventType,".btnSaveData",(function(){core.Forms.Save()}))},helper:{clickEventType:null!==document.ontouchstart?"click":"touchstart",sortList:function(selector){$(selector).find("option").sort((function(a,b){return Number(a.innerHTML)-Number(b.innerHTML)})).each((function(index,el){$(el).parent().append(el)}))}},Forms:{data:null,init:async function(){await core.Forms.getSchema().then(result=>{core.Modelo.schema=result,$("body .form-data .select-data").length&&$("body .form-data .select-data").each((function(){var entidadCombo=$(this).attr("hs-list-entity"),keyField=$(this).attr("hs-list-field"),keyValue=$(this).attr("hs-list-value"),elDOM=$(this).prop("id"),keyOriginField=$(this).attr("hs-field"),keyOriginValue=$(this).attr("hs-value");core.Forms.getSelectData(entidadCombo,keyField,keyValue,keyOriginField,keyOriginValue,elDOM)})),""!=core.modelId&&apiFincatech.get(core.model.toLowerCase()+"/"+core.modelId).then(result=>{core.Modelo.entity[core.model]=JSON.parse(result).data[core.model],core.Forms.mapData()})})},getSchema:async function(){return apiFincatech.get(core.model.toLowerCase()+"/schema").then(result=>{core.Modelo.schema=result})},mapData:async function(){$("body .form-data").length&&$("body .data").each((function(){var entidad=$(this).attr("hs-entity"),campo=$(this).attr("hs-field"),valor=core.Modelo.entity[entidad][0][campo];if($(this).hasClass("select-data")){var id=$(this).attr("id");$(`#${id} option[value=${valor}]`).attr("selected","selected")}else $(this).val(valor)}))},mapDataToSave:function(){core.Forms.data={};var modeloPrincipal=$("body").attr("hs-model");$("body .form-data .data").each((function(){var fieldName=$(this).attr("hs-field"),entity;$(this).attr("hs-entity")==modeloPrincipal&&(console.log("Map Data"),console.log("Acción del modelo: "+core.actionModel+" - "+core.modelId),"id"!=fieldName&&(core.Forms.data[fieldName]=$(this).val()))})),"get"==core.actionModel&&""!=core.Forms.data.id&&(console.log("ID: "+core.modelId),core.Forms.data.id=core.modelId)},getSelectData:async function(entidad,keyField,keyValue,keyOriginField,keyOriginValue,elementoDOM){$("body #"+elementoDOM).html(""),await apiFincatech.get(`${entidad}/list`).then(async data=>{var htmlOutput="",result=JSON.parse(data);for(responseData=result.data,x=0;x<responseData[entidad].length;x++){var valueId,value;htmlOutput=`<option value="${responseData[entidad][x][keyValue]}">${responseData[entidad][x][keyField]}</option>`,$("body #"+elementoDOM).append(htmlOutput)}})},Save:async function(){var entidadSave=$("body").attr("hs-model"),idSave=$("body").attr("hs-model-id"),actionSave=$("body").attr("hs-action");switch(core.Forms.data={},core.Forms.mapDataToSave(),actionSave){case"get":core.Modelo.Update(core.model,idSave,core.Forms.data);break;case"add":core.Modelo.Insert(core.model,core.Forms.data)}},Validate:function(){}},Modelo:{entity:Object(),schema:Object(),getAll:async function(){await apiFincatech.get(`${core.model.toLowerCase()}/list`).then(async data=>{result=JSON.parse(data),responseStatus=result.status,responseData=result.data})},Insert:async function(entidadSave,postData){await apiFincatech.post(`${entidadSave}/create`,JSON.stringify(postData)).then(async response=>{var responseData=JSON.parse(response);if("ok"==responseData.status.response){var idInsercion=responseData.id;$("body").attr("hs-action","get"),$("body").attr("hs-model-id",idInsercion),core.actionModel="get",core.modelId=idInsercion,CoreUI.Modal.Success("El registro se ha creado correctamente")}else Modal.Error("No se ha podido guardar por el siguiente motivo:<br><br>"+responseData.status.response)})},Delete:async function(endpoint,id,nombre,nombreListadoDOM,titulo=null,mensaje=null){Swal.fire({title:"¿Desea eliminar el registro y toda la información relacionada?",text:`${nombre}`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(result=>{result.isConfirmed&&apiFincatech.delete(endpoint,id).then(result=>{Swal.fire("Registro eliminado correctamente","","success"),$(`#${nombreListadoDOM}`).DataTable().ajax.reload()})})},Update:async function(endpoint,id,jsonPostData){await apiFincatech.put(`${endpoint}/${id}`,JSON.stringify(jsonPostData)).then(async response=>{var responseData=JSON.parse(response);"ok"==responseData.status.response?CoreUI.Modal.Success("El registro se ha actualizado correctamente"):Modal.Error("No se ha podido guardar por el siguiente motivo:<br><br>"+responseData.status.response)})}}};$((function(){apiFincatech.init(),core.init()}));