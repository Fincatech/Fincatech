let sudo={init:function(){sudo.Mensajes.Init(),$("body #listadoMensajes").length&&sudo.Mensajes.CRUD.GetAll(),$("body .stats-sistema").length&&(sudo.Stats(),comunidadesCore.Render.tablaListadoComunidadesPendientes()),sudo.Events()},Events:function(){$("body").on(core.helper.clickEventType,".btnActualizacionServicios",(function(e){sudo.Controller.MostrarExportacionComunidades()})),$("body").on(core.helper.clickEventType,".bntActualizarProcesos",(function(e){sudo.Controller.ValidarFicheroActualizacionServicios()})),$("#ibanliquidaciones").length&&($("#ibanliquidaciones").mask("SS00 0000 0000 00 0000000000"),$("#ibanliquidaciones").on("blur",(function(e){$("#ibanliquidaciones").val().length>0&&(core.Validator.checkIBAN($("#ibanliquidaciones").val())||(e.stopImmediatePropagation(),CoreUI.Modal.Error("El código IBAN no es correcto. Por favor, revíselo."),$("#ibanliquidaciones").val("")))})))},Controller:{ValidarColumnasFicheroServicios:function(){return!1},ValidarFicheroActualizacionServicios:function(){if(!core.Files.isExcelFile("ficheroAdjuntarExcel"))return $(".wrapperMensajeErrorCarga .mensaje").html("El fichero no es válido. Seleccione un fichero de formato Excel (xls o xlsx)"),void $(".wrapperMensajeErrorCarga").show();if($(".wrapperMensajeErrorCarga").hide(),"-1"==$("#administradorCargaId option:selected").val())return $(".wrapperMensajeErrorCarga .mensaje").html("Debe seleccionar el administrador al que asignar las comunidades a importar"),void $(".wrapperMensajeErrorCarga").show();var e=!1;$("#ficheroAdjuntarExcel").val().toLowerCase().indexOf(".xlsx")>0&&(e=!0),$(".wrapperInformacion").hide(),$(".wrapperSelectorAdministrador").hide(),$(".wrapperSelectorFichero").hide(),$(".wrapperMensajeErrorCarga").hide(),serviciosCore.Controller.ProcesarUpdateFicheroServicios(e)},MostrarExportacionComunidades:function(){apiFincatech.getView("sudo","servicios").then((e=>{CoreUI.Modal.CustomHTML(e,"Actualización masiva de servicios de comunidades",(function(){}))}))}},Mensajes:{Init:function(){sudo.Mensajes.Events()},Events:function(){$("body").on(core.helper.clickEventType,".btnReenviarMensaje",(function(e){var a=$(this).attr("data-id");apiFincatech.get(`mensaje/${a}/resend`).then((e=>{CoreUI.Modal.Success("El mensaje se ha reenviado correctamente","Reenviar mensaje")}))})),$("body").on(core.helper.clickEventType,".btnVerMensajeEnviado",(function(e){var a=$(this).attr("data-id");apiFincatech.get(`mensaje/${a}`).then((e=>{let a=JSON.parse(e).data.Mensaje[0].body;a=sudo.Mensajes.Helper.htmlEntities(a),a=a.replaceAll("https:/app.fincatech.es/","https://app.fincatech.es/"),CoreUI.Modal.CustomHTML(a,"Mensaje Enviado",null,"90%")}))}))},CRUD:{GetAll:function(){$("#listadoMensajes").length&&(void 0!==window.tablelistadoMensajes&&(CoreUI.tableData.columns.listadoMensajes=[]),CoreUI.tableData.init(),CoreUI.tableData.addColumn("listadoMensajes","subject","Asunto",null,"text-left"),CoreUI.tableData.addColumn("listadoMensajes","email","EMAIL",null,"text-left"),CoreUI.tableData.addColumn("listadoMensajes",(function(e,a,t,n){return`<span style="display:none;">${moment(e.created,"YYYY-MM-DD hh:mm").unix()}</span>${moment(e.created).locale("es").format("L")}`}),"Fecha envío",null,"text-center"),CoreUI.tableData.addColumn("listadoMensajes",(function(e,a,t,n){return`<ul class="nav justify-content-center accionesTabla">\n                                            <li class="nav-item mr-2">\n                                                <a href="javascript:void(0);" class="btnVerMensajeEnviado d-inline-block btn btn-success" data-id="${e.id}"><i data-feather="eye" class="text-white img-fluid"></i> Ver mensaje</a>\n                                            </li>                            \n                                            <li class="nav-item">\n                                                <a href="javascript:void(0);" class="btnReenviarMensaje d-inline-block btn btn-primary" data-id="${e.id}"><i data-feather="send" class="text-white img-fluid"></i> Reenviar mensaje</a>\n                                            </li>\n                                        </ul>`}),"&nbsp;",null,"text-center"),$("#listadoMensajes").addClass("no-clicable"),CoreUI.tableData.render("listadoMensajes","Mensaje","mensaje/list",null,!0,!0,null,null,!1,null,!0))}},Helper:{htmlEntities:function(e){var a=document.createElement("textarea");return a.innerHTML=e,a.value}}},Stats:function(){apiFincatech.get("stats/list").then((e=>{let a=JSON.parse(e);$(".stat-empresas").text(a.data.empresas),$(".stat-comunidades").text(a.data.comunidades),$(".stat-administradores").text(a.data.administradores),$(".stat-emails").text(a.data.emailscertificados),$(".stat-emails-enviados").text(a.data.emailsenviados),$(".stat-totalcae").text(a.data.servicioscomunidades.totalcae),$(".stat-totaldpd").text(a.data.servicioscomunidades.totaldpd),$(".stat-totaldoccae").text(a.data.servicioscomunidades.totaldoccae),$(".stat-totalcertificados").text(a.data.servicioscomunidades.totalcertificadosdigitales)}))}};$((()=>{sudo.init()}));