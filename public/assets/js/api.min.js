let apiFincatech={baseUrlEndpoint:"",response:null,emailSoporte:"soporte@fincatech.es",emailTextoSoporte:"",init:function(){apiFincatech.baseUrlEndpoint=config.baseURLEndpoint,apiFincatech.emailTextoSoporte=`<p class="mt-2" style="font-size: 12px;"><br>Si el problema persiste, por favor, contacte con <a href="mailto:${apiFincatech.emailSoporte}" target="_blank" title="E-mail Soporte">${apiFincatech.emailSoporte}</a>`,apiFincatech.emailTextoSoporte=`${apiFincatech.emailTextoSoporte}<p style="font-size: 12px;">En el e-mail especifique el error mostrado y los pasos realizados para poder comprobar la incidencia. El plazo máximo de resolución es de 48h tras recibir el e-mail.</p>`,apiFincatech.emailTextoSoporte=`${apiFincatech.emailTextoSoporte}<p class="mb-0" style="font-size: 12px;">Gracias por su colaboración</p>`},parseMultipleJSONObjects:function(e){const r=[];let a="",o=0;for(let t=0;t<e.length;t++){const i=e[t];"{"===i&&(0===o&&(a=""),o++),o>0&&(a+=i),"}"===i&&(o--,0===o&&r.push(JSON.parse(a)))}if(msg='<p class="text-danger"><span class="font-weight-bold">Error Interno</span>:<br><br>',r.length>0){for(let e=0;e<r.length;e++)msg=`${msg}<p>${r[e].error.description}</p>`;msg=`${msg}</p>`}return msg},procesarError:function(e,r=""){$(".loading").hide();let a=e;if(""!==r){let e=r.responseText?r.responseText:r;a=`${a}${apiFincatech.parseMultipleJSONObjects(e)}`}a=`${a}${apiFincatech.emailTextoSoporte}`,CoreUI.Modal.Error(a)},procesarRespuesta:function(e,r=""){if($(".loading").hide(),"ok"==e.status)return e;let a=e.mensaje;""!==r&&(a='<p class="text-danger"><span class="font-weight-bold">Error Interno</span>:<br><br>'+r.responseJSON.error.description+"</p>"),a=`${a}${apiFincatech.emailTextoSoporte}`,CoreUI.Modal.error(a)},getView:async function(e,r,a,o,t=!1,i=0){return datosVista={viewfolder:e,view:r,entidad:a,paginacion:t,numeropagina:i},$(".loading").show(),await $.ajax({url:apiFincatech.baseUrlEndpoint+"getview",method:"POST",data:datosVista,success:function(e){$(".loading").hide(),$(`${o}`).html(e)},error:function(){$(".loading").hide(),apiFincatech.procesarError(`Error de endpoint: ${respuesta.status.error}`)}})},get:async function(e){return $(".loading").show(),await $.ajax({url:apiFincatech.baseUrlEndpoint+e,async:!0,success:function(e){return apiFincatech.response=e.data,$(".loading").hide(),"error"==e.status?"error":JSON.stringify(e)},error:function(){$(".loading").hide(),apiFincatech.procesarError(`Error de endpoint: ${respuesta.status.error}`)}})},delete:async function(e,r){return $(".loading").show(),await $.ajax({url:apiFincatech.baseUrlEndpoint+e+"/"+r,type:"delete",success:function(e){return apiFincatech.response=e.data,$(".loading").hide(),"error"==e.status?"error":JSON.stringify(e)},error:function(e){$(".loading").hide(),apiFincatech.procesarError(`Error de endpoint: ${respuesta.status.error}`,e)}})},postWithProgress:async function(e,r,a=!0){a&&$(".loading").show(),""!=core.Files.Fichero.base64&&null!=core.Files.Fichero.base64&&(r.fichero=core.Files.Fichero),r=JSON.stringify(r);let o="";await new Promise((async(a,t)=>{const i=new XMLHttpRequest;i.open("POST",apiFincatech.baseUrlEndpoint+e,!0),i.setRequestHeader("Content-Type","application/json; charset=utf-8");let n=0,s="";i.onprogress=function(e){let r=e.currentTarget.responseText,a=r.substring(n);n=r.length;let t=a.split("\n\n");t.forEach((e=>{if(""!==e.trim()){s=e.replace("data: ","");try{let e=JSON.parse(s);switch(apiFincatech.isValidJson(e.data)&&(e=JSON.parse(e.data)),e.data){case"progress":CoreUI.Progress.SetProgress(e.progress),CoreUI.Progress.SetMessage(e.message);break;case"completed":CoreUI.Progress.SetProgress(e.progress),CoreUI.Progress.SetMessage(e.message);break;case"error":s=e;break}}catch(e){o=s}}}))},i.onload=function(){if($(".loading").hide(),200===i.status)try{o=s,"error"==o.data?t(s):a(s)}catch(e){t("Error procesando respuesta final: "+e)}else t("Error de endpoint")},i.onerror=function(){$(".loading").hide(),apiFincatech.procesarError("Error de endpoint"),t("Error de endpoint")},i.send(r)}));return o},post:async function(e,r,a=!0){return a&&$(".loading").show(),""!=core.Files.Fichero.base64&&null!=core.Files.Fichero.base64&&(r.fichero=core.Files.Fichero),r=JSON.stringify(r),await $.ajax({url:apiFincatech.baseUrlEndpoint+e,method:"POST",contentType:"application/json; charset=utf-8",data:r,success:function(e){return $(".loading").hide(),apiFincatech.isValidJson(e)?(apiFincatech.response=e.data,"error"==e.status?"error":JSON.stringify(e)):(apiFincatech.procesarError("",e),e)},error:function(e,r){$(".loading").hide(),apiFincatech.isValidJson(e)?(e=JSON.parse(e),apiFincatech.procesarError(`Error de endpoint: ${e.status.error}`,r)):apiFincatech.procesarError("",e)}})},put:async function(e,r){return $(".loading").show(),""!=core.Files.Fichero.base64&&(r.fichero=core.Files.Fichero),r=JSON.stringify(r),await $.ajax({url:apiFincatech.baseUrlEndpoint+e,method:"PUT",contentType:"application/json; charset=utf-8",data:r,success:function(e){return $(".loading").hide(),e},error:function(){$(".loading").hide(),apiFincatech.procesarError("Error de endpoint")}})},isValidJson:function(e){try{return JSON.parse(e),!0}catch(e){return!1}}};