let contratista={idContratista:null,idEmpleadoSeleccionado:null,Constantes:{AsignarEmpleado:'\n            <div class="row">\n\n                <div class="col-12 text-center text-uppercase align-self-center">\n                    <p class="m-0" style="display: block; font-size: 18px;"> Asignar empleado a la comunidad</p>\n                </div>\n\n            </div>\n\n            <div class="form-group row mb-2 justify-content-center wrapperSeleccionarEmpleado">\n\n                <div class="col-12">  \n\n                    <div class="row mt-5">\n                        <div class="col-12">\n                            <p class="text-left">Empleados disponibles:</p>\n                        </div>\n                    </div>\n\n                    <div class="row">\n                        <div class="col-12">\n                            <select class="form-select listEmpleados" aria-label="Default select">\n                            </select>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- boton asignar --\x3e\n                    <div class="row mt-3">\n                        <div class="col-12">\n                            <a href="javascript:void(0);" class="btn d-block btn-success btnAsignarEmpleado pt-3 pb-3" data-idempleado="" data-idempresa="">Asignar empleado a comunidad</a>\n                        </div>\n                    </div>\n\n                </div>\n\n            </div>'},Init:function(){CoreUI.Sidebar.Comunidades.cargarMenuComunidades(),contratista.Events(),core.Files.init(),contratista.checkRGPD()},Events:async function(){comunidadesCore.events(),$("body .form-empleado .btnSaveData").off(core.helper.clickEventType).on(core.helper.clickEventType,(function(evt){evt.stopImmediatePropagation(),core.Forms.Validate("form-empleado")?(core.Forms.prepareFormDataBeforeSend("form-empleado"),empleadoCore.Model.save()):CoreUI.Modal.Error("Debe rellenar la informaci贸n de todos los campos marcados como obligatorios","Error Alta Empleado")})),$("body #wrapperListadoDocumentacionCAEEmpresa").length&&await core.Security.getUserInfo().then((function(){contratista.Model.ListarDocumentosEmpresa()})),$("body #listadoEmpleadosContratista").length&&await core.Security.getUserInfo().then((function(){empresaCore.renderTablaEmpleadosContratista(core.Security.user,"listadoEmpleadosContratista")})),$("body #form-empleado").length&&core.Security.getUserInfo().then(async result=>{$("body #idempresa").val(core.Security.user);var actionForm=$("body #form-empleado").attr("data-action");$("body").attr("hs-action",actionForm),$("body").attr("hs-model","empleado"),core.model="empleado",core.Forms.initializeSelectData(),"get"==actionForm?($("body").attr("hs-model-id",$("body #form-empleado").attr("data-id")),empleadoCore.Model.get($("body #form-empleado").attr("data-id"),(function(){core.Forms.data=empleadoCore.Model.Empleado,core.modelId=empleadoCore.Model.id,$("body").attr("hs-model-id",empleadoCore.Model.id),core.Forms.mapDataFromModel("form-empleado",empleadoCore.Model.Empleado)}))):$("#fechaalta").val(moment().format("YYYY-MM-DD"))}),$("body").on(core.helper.clickEventType,".enlaceEmpleadosComunidadContratista",(function(ev){var idComunidad=$("body").attr("hs-model-id"),idEmpresa=core.Security.user;empleadoCore.renderTablaEmpleadosEmpresaComunidad(idEmpresa,idComunidad)})),$("body").on(core.helper.clickEventType,".btnModalAsignarEmpleado",(function(ev){contratista.mostrarModalAsignarEmpleadoComunidad()})),$("body").on(core.helper.clickEventType,".btnAsignarEmpleado",(function(ev){var idEmpleado=$("body .listEmpleados option:selected").val(),idComunidad=$("body").attr("hs-model-id");empleadoCore.asignarEmpleadoComunidad(idComunidad,idEmpleado)})),$("body").on(core.helper.clickEventType,".btnAceptarRGPD",(function(ev){contratista.aceptacionRGPD($(this).attr("data-id"),"1")})),$("body").on(core.helper.clickEventType,".btnRechazarRGPD",(function(ev){contratista.aceptacionRGPD($(this).attr("data-id"),"0")})),$("body").on(core.helper.clickEventType,".btnAdjuntarOperatoria",(async function(){documentalCore.idcomunidad=$(this).attr("data-idcomunidad"),documentalCore.idempresa=$(this).attr("data-idempresa"),documentalCore.idempleado=$(this).attr("data-idempleado"),documentalCore.idrequerimiento=$(this).attr("data-idrequerimiento"),documentalCore.idrelacionrequerimiento=$(this).attr("data-idrelacionrequerimiento"),documentalCore.entidad=$(this).attr("data-entidad");const{value:file}=await Swal.fire({title:"",html:Constantes.CargaDocumento,showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,didOpen:function(){core.Files.init()}})}))},checkRGPD:function(){$(".mensajeRGPD").length>0&&core.Security.getUserInfo().then(result=>{apiFincatech.get(`user/${core.Security.user}/rgpd`).then(result=>{"1"==JSON.parse(result).data.rgpd?$(".mensajeRGPD").hide():$(".mensajeRGPD").show()})})},aceptacionRGPD:function(idUsuario,valor){var data=Object();data.rgpd=valor,apiFincatech.put(`usuario/${idUsuario}`,data).then(result=>{"0"==valor?CoreUI.Modal.Error("Ha rechazado el consentimiento de la aceptaci贸n de la RGPD","Aceptaci贸n RGPD"):CoreUI.Modal.Success("Ha aceptado el consentimiento relativo a la RGPD","Aceptaci贸n RGPD"),contratista.checkRGPD()})},mostrarModalAsignarEmpleadoComunidad:function(){const{value:file}=Swal.fire({title:"",html:contratista.Constantes.AsignarEmpleado,showCancelButton:!1,showConfirmButton:!1,width:800,grow:"row",showCloseButton:!0,didOpen:function(e){contratista.listarEmpleadosEmpresa()}})},listarEmpleadosEmpresa:function(){apiFincatech.get("empresa/"+core.Security.user+"/empleados").then(result=>{for(var datos,empleados=JSON.parse(result).data.Empleados,x=0;x<empleados.length;x++)$("body .listEmpleados").append(`<option value="${empleados[x].idempleado}">${empleados[x].nombre}</option>`)})},Model:{ListarDocumentosEmpresa:function(){documentalCore.Listado.Cargar("wrapperListadoDocumentacionCAEEmpresa",documentalCore.ENTIDAD_EMPRESA,documentalCore.CAE_EMPRESA,null,core.Security.user,null),empresaCore.renderTablaRequerimientosEmpresa(core.Security.user)}}};$(()=>{contratista.Init()});