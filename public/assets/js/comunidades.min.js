let comunidadesCore={comunidades:Object(),comunidad:Object(),init:async function(){this.events(),"list"==core.actionModel&&"comunidad"==core.model.toLowerCase()&&(await comunidadesCore.listadoDashboard(),await comunidadesCore.renderMenuLateral())},events:function(){"comunidad"==core.model.toLowerCase()&&$("body").on(core.helper.clickEventType,".btnSaveData",evt=>{evt.stopImmediatePropagation(),comunidadesCore.guardarComunidad()}),$("body").on(core.helper.clickEventType,".btnVerComunidad",evt=>{evt.stopImmediatePropagation(),comunidadesCore.verModalComunidad($(evt.currentTarget).attr("data-id"),$(evt.currentTarget).attr("data-nombre"))}),$("body").on(core.helper.clickEventType,".btnEliminarComunidad",evt=>{evt.stopImmediatePropagation(),comunidadesCore.eliminar($(evt.currentTarget).attr("data-id"),$(evt.currentTarget).attr("data-nombre"))})},guardarComunidad:function(){core.Forms.mapDataToSave(),serviciosCore.mapServiciosContratados(),core.Forms.Save(!0)},eliminar:function(id,nombre){core.Modelo.Delete("comunidad",id,nombre,"listadoComunidades")},verModalComunidad:async function(idComunidad){var infoComunidad;comunidadesCore.getComunidad(idComunidad).then(result=>{infoComunidad=result,apiFincatech.getView("modals","comunidades/modal_info").then(resultHTML=>{result=CoreUI.Utils.parse(resultHTML,comunidadesCore.comunidad),console.log(result),CoreUI.Modal.GetHTML("modalInfoComunidad",result,comunidadesCore.comunidad.nombre)})})},renderMenuLateral:async function(){$(".navComunidades").append('<li class="sidebar-header">Comunidades</li>'),comunidadesCore.comunidades.forEach((function(valor,indice,array){var html=`<li class="sidebar-item">\n                            <a class="sidebar-link" href="/fincatech/comunidad/${valor.id}">\n                                <div class="row">\n                                    <div class="col-2">\n                                        <img src="/fincatech/public/assets/img/icon_edificio.png" class="img-responsive feather">\n                                    </div>\n                                    <div class="col-10 pr-0">\n                                        <span class="align-middle">${valor.codigo} - ${valor.nombre}</span>\n                                    </div>\n                                </div>\n                            </a>\n                        </li>`;$(".navComunidades").append(html)})),feather.replace()},renderTabla:async function(){if($("#listadoComunidad").length){CoreUI.tableData.init(),CoreUI.tableData.addColumn("codigo","COD"),CoreUI.tableData.addColumn("nombre","NOMBRE");var html='<a href="mailto:data:emailcontacto$" class="pl-1 pr-1">data:emailcontacto$</a>';CoreUI.tableData.addColumn(null,"EMAIL",html),CoreUI.tableData.addColumn("telefono","TELEFONO"),CoreUI.tableData.addColumn("nombre","doc pend. de subir"),CoreUI.tableData.addColumn("nombre","doc pend. de verificar");var html="data:created$";CoreUI.tableData.addColumn(null,"Fecha alta",html);var html="data:estado$";CoreUI.tableData.addColumn(null,"Estado",html);var html='<ul class="nav justify-content-center accionesTabla">';html+='<li class="nav-item"><a href="javascript:void(0);" class="btnVerComunidad d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="eye" class="text-info img-fluid"></i></a></li>',html+=`<li class="nav-item"><a href="${baseURL}comunidad/data:id$" class="btnEditarComunidad d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="edit" class="text-success img-fluid"></i></a></li>`,html+='<li class="nav-item"><a href="javascript:void(0);" class="btnEliminarComunidad d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="trash-2" class="text-danger img-fluid"></i></li></ul>',CoreUI.tableData.addColumn(null,"",html),CoreUI.tableData.render("listadoComunidad","Comunidad","comunidad/list")}},listadoDashboard:async function(){await comunidadesCore.getAll().then(async data=>{$(".statscomunidades .total").html(comunidadesCore.comunidades.total),this.renderTabla()})},getComunidad:async function(comunidadId){await apiFincatech.get("comunidad/"+comunidadId).then(data=>(result=JSON.parse(data),responseStatus=result.status,responseData=result.data,comunidadesCore.comunidad=responseData.Comunidad[0],console.log(comunidadesCore.comunidad),comunidadesCore.comunidad))},getAll:async function(){await apiFincatech.get("comunidad/list").then(async data=>{result=JSON.parse(data),responseStatus=result.status,responseData=result.data,comunidadesCore.comunidades=responseData.Comunidad,comunidadesCore.comunidades.total=comunidadesCore.comunidades.length})},Import:{validacionPlantillaComunidades:function(){return!0},guardarComunidadDesdePlantilla(jsonExcel){},leerPlantillaComunidades:function(xlsxflag){if("undefined"!=typeof FileReader){var readerExcel=new FileReader;readerExcel.onload=function(e){$(".wrapperProgresoCarga").show();var data=e.target.result;if(xlsxflag)var workbook=XLSX.read(data,{type:"binary"});else var workbook=XLS.read(data,{type:"binary"});var sheet_name_list=workbook.SheetNames,cnt=0;sheet_name_list.forEach((function(y){if(xlsxflag)var exceljson=XLSX.utils.sheet_to_json(workbook.Sheets[y]);else var exceljson=XLS.utils.sheet_to_row_object_array(workbook.Sheets[y]);$(".wrapperProgresoCarga .progress-bar").css("width","0%"),$(".wrapperProgresoCarga .progress-bar-striped").html("0%"),exceljson.length>0&&($(".wrapperProgresoCarga .progresoCarga").html("(0 de "+(exceljson.length-4)+")"),console.log(exceljson),comunidadesCore.guardarComunidad())}))},xlsxflag?readerExcel.readAsArrayBuffer($("#ficheroAdjuntarExcel")[0].files[0]):readerExcel.readAsBinaryString($("#ficheroAdjuntarExcel")[0].files[0])}else alert("Sorry! Your browser does not support HTML5!")},importarComunidades:function(){if(!core.Files.isExcelFile("ficheroAdjuntarExcel"))return $(".wrapperMensajeErrorCarga .mensaje").html("El fichero no es válido. Seleccione un fichero de formato Excel (xls o xlsx)"),void $(".wrapperMensajeErrorCarga").show();if($(".wrapperMensajeErrorCarga").hide(),"-1"==$("#administradorCargaId option:selected").val())return $(".wrapperMensajeErrorCarga .mensaje").html("Debe seleccionar el administrador al que asignar las comunidades a importar"),void $(".wrapperMensajeErrorCarga").show();if(!comunidadesCore.Import.validacionPlantillaComunidades())return $(".wrapperMensajeErrorCarga .mensaje").html("El fichero no es válido. Utilice la plantilla de Fincatech."),void $(".wrapperMensajeErrorCarga").show();var xlsxflag=!1;$("#ficheroAdjuntarExcel").val().toLowerCase().indexOf(".xlsx")>0&&(xlsxflag=!0),$(".wrapperInformacion").hide(),$(".wrapperSelectorAdministrador").hide(),$(".wrapperSelectorFichero").hide(),$(".wrapperMensajeErrorCarga").hide(),comunidadesCore.Import.leerPlantillaComunidades(xlsxflag)}}};$(()=>{comunidadesCore.init()});