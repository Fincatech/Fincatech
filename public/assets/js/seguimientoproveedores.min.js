let SeguimientoProveedores={Init:function(){$("body #listadoEmpresasRegistradas").length>0&&SeguimientoProveedores.Controller.RenderTablaSeguimientoProveedores(),$("body #listadoSeguimientoEmpresas").length>0&&(SeguimientoProveedores.Controller.RenderTablaActuaciones(),$("body").on("hsFormDataLoaded",(function(e,a){SeguimientoProveedores.View.RenderEstadoActuacion()}))),SeguimientoProveedores.Events()},Events:function(){$("body").on(core.helper.clickEventType,".btnSaveActuacion",(function(e){SeguimientoProveedores.Model.fecha=$("#seguimientoFecha").val(),SeguimientoProveedores.Model.tipo=$("#seguimientoTipo").val(),SeguimientoProveedores.Model.observaciones=$("#seguimientoObservaciones").val(),SeguimientoProveedores.Controller.Create()})),$("body").on(core.helper.clickEventType,".btnResetActuacion",(function(e){SeguimientoProveedores.Controller.ResetForm()})),$("body").on(core.helper.clickEventType,".btnDeleteSeguimiento",(function(e){SeguimientoProveedores.Model.actuacionId=$(this).attr("data-id"),SeguimientoProveedores.Controller.Delete()})),$("body").on(core.helper.clickEventType,".btnFinishSeguimiento",(function(e){window.tablelistadoSeguimientoEmpresas.tables(0).data().length<=0?CoreUI.Modal.Error("Para finalizar el seguimiento debe haber al menos 1 actuación registrada"):SeguimientoProveedores.Controller.SetFinishedFollow()}))},Controller:{ResetForm:function(){$("#seguimientoFecha").val(""),$("#seguimientoTipo").val(""),$("#seguimientoObservaciones").val(""),SeguimientoProveedores.Model.fecha="",SeguimientoProveedores.Model.tipo="",SeguimientoProveedores.Model.observaciones=""},Create:async function(){let e=SeguimientoProveedores.Validator.Creation();if(!0===e){let e=Object();e.fecha=SeguimientoProveedores.Model.fecha,e.tipo=SeguimientoProveedores.Model.tipo,e.observaciones=SeguimientoProveedores.Model.observaciones,await apiFincatech.post(`empresa/${core.modelId}/actuacion`,e).then((e=>{CoreUI.Modal.Success("La actuación se ha generado correctamente"),SeguimientoProveedores.Controller.RenderTablaActuaciones(),SeguimientoProveedores.Controller.ResetForm()}))}else CoreUI.Modal.Error('<p class="text-left">Para guardar la actuación, corrija los siguientes errores<br><br>'+e+"</p>","Error")},Delete:async function(){Swal.fire({title:"¿Desea eliminar la actuación seleccionada?",text:"Esta acción es irreversible",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&apiFincatech.delete(`empresa/${core.modelId}/actuacion`,SeguimientoProveedores.Model.actuacionId).then((e=>{Swal.fire("Actuación eliminada correctamente","","success"),CoreUI.Modal.Success("La actuación se ha eliminado correctamente"),SeguimientoProveedores.Controller.RenderTablaActuaciones()}))}))},SetFinishedFollow:async function(){Swal.fire({title:"¿Desea dar por terminado el seguimiento para esta empresa?",text:"Esta acción es irreversible",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Terminar seguimiento",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&apiFincatech.get(`empresa/${core.modelId}/seguimiento/finished`).then((e=>{CoreUI.Modal.Success("El seguimiento se ha finalizado correctamente"),core.Modelo.entity.Empresa[0].estadoprotocolo="1",SeguimientoProveedores.View.RenderEstadoActuacion()}))}))},RenderTablaSeguimientoProveedores:function(){if($("#listadoEmpresasRegistradas").length){CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoEmpresasRegistradas","razonsocial","Empresa",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpresasRegistradas","cif","CIF",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpresasRegistradas","email","E-mail",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpresasRegistradas","telefono","Teléfono",null,"text-left"),CoreUI.tableData.addColumn("listadoEmpresasRegistradas","totalactuaciones","Nº Actuaciones realizadas",null,"text-center"),CoreUI.tableData.addColumn("listadoEmpresasRegistradas",(function(e,a,t,o){let i="-",n="";return e.actuaciones.length>0&&(n=moment(e.actuaciones[0].created,"YYYY-MM-DD hh:mm").unix(),i=moment(e.created).locale("es").format("L")),`<span style="display:none;">${n}</span><p class="mb-0 text-center">${i}</p>`}),"Última actuación",null,"text-center","10%"),CoreUI.tableData.addColumn("listadoEmpresasRegistradas",(function(e,a,t,o){return`<p class="mb-0 text-center">${"1"==e.estadoprotocolo?'<span class="badge badge-pill bg-success">Finalizado</span>':'<span class="badge badge-pill bg-primary">En seguimiento</span>'}</p>`}),"Estado Protocolo",null,"text-center"),CoreUI.tableData.addColumn("listadoEmpresasRegistradas",(function(e,a,t,o){return timeStamp=moment(e.created,"YYYY-MM-DD hh:mm").unix(),`<span style="display:none;">${timeStamp}</span><p class="mb-0 text-center">${moment(e.created).locale("es").format("L")}</p>`}),"Fecha de registro",null,"text-center","10%");'<li class="nav-item"><a href="empresa/data:id$" class="btnSeguimiento d-inline-block" data-id="data:id$"><i data-feather="edit" class="text-success img-fluid"></i></li></ul>',CoreUI.tableData.addColumn("listadoEmpresasRegistradas",null,"",'<ul class="nav justify-content-center accionesTabla"><li class="nav-item"><a href="empresa/data:id$" class="btnSeguimiento d-inline-block" data-id="data:id$"><i data-feather="edit" class="text-success img-fluid"></i></li></ul>'),$("#listadoEmpresasRegistradas").addClass("no-clicable"),CoreUI.tableData.render("listadoEmpresasRegistradas","empresas","empresa/seguimiento/list",!1,!0,!0)}},RenderTablaActuaciones:function(){if($("#listadoSeguimientoEmpresas").length){let e=core.modelId;CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoSeguimientoEmpresas",(function(e,a,t,o){return timeStamp=moment(e.created,"YYYY-MM-DD hh:mm").unix(),`<span style="display:none;">${timeStamp}</span><p class="mb-0 text-center">${moment(e.created).locale("es").format("L")}</p>`}),"Fecha",null,"text-center","15%"),CoreUI.tableData.addColumn("listadoSeguimientoEmpresas",(function(e,a,t,o){return e.subject?"E-mail":e.tipo}),"Tipo",null,"text-center","15%"),CoreUI.tableData.addColumn("listadoSeguimientoEmpresas",(function(e,a,t,o){return e.subject?"Envío E-mail de Alta en la plataforma":e.observaciones}),"Observaciones",null,"text-left"),CoreUI.tableData.addColumn("listadoSeguimientoEmpresas",(function(e,a,t,o){if(e.subject)return"";{let e='<ul class="nav justify-content-center accionesTabla">';return e+='<li class="nav-item"><a href="javascript:void(0);"" class="btnDeleteSeguimiento d-inline-block" data-id="data:id$"><i data-feather="trash-2" class="text-danger img-fluid"></i></li></ul>',e}}),"&nbsp;",null,"text-left"),$("#listadoSeguimientoEmpresas").addClass("no-clicable"),CoreUI.tableData.render("listadoSeguimientoEmpresas","actuaciones",`empresa/${e}/seguimiento`,!1,!1,!1)}}},Model:{actuacionId:null,fecha:null,tipo:null,observaciones:null},Validator:{Creation:function(){let e="";return""==SeguimientoProveedores.Model.fecha&&(e="- Fecha de la actuación<br>"),""==SeguimientoProveedores.Model.tipo&&(e=`${e}- Tipo de actuación realizada<br>`),""==SeguimientoProveedores.Model.observaciones&&(e=`${e}- Observaciones<br>`),""==e||e}},View:{RenderEstadoActuacion:function(){let e,a;$("#estadoActuacion").removeClass(),"1"==core.Modelo.entity.Empresa[0].estadoprotocolo?(a="bg-success",e="Seguimiento Finalizado",$(".btnResetActuacion").addClass("disabled"),$(".btnSaveActuacion").addClass("disabled"),$(".btnFinishSeguimiento").addClass("disabled")):(e="En seguimiento",a="bg-primary"),$("#estadoActuacion").html(e),$("#estadoActuacion").addClass(a).addClass("badge badge-pill p-2")}}};$((()=>{SeguimientoProveedores.Init()}));