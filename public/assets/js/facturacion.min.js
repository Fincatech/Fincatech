let facturacion={Init:function(){facturacion.Events(),"liquidaciones"==core.model.toLowerCase()&&facturacion.Liquidaciones.Init()},Events:function(){$("#iban").length&&($("#iban").mask("SS00 0000 0000 00 0000000000"),$("#iban").on("blur",(function(a){$("#iban").val().length>0&&(core.Validator.checkIBAN($("#iban").val())||(a.stopImmediatePropagation(),CoreUI.Modal.Error("El código IBAN no es correcto. Por favor, revíselo.")))}))),$("body").on(core.helper.clickEventType,".btnGenerarInformePrefacturacion",(function(){facturacion.Prefacturacion.generarInformePrefacturacion()})),facturacion.Bank.Events(),facturacion.Remesa.Events()},Bank:{Events:function(){$("#bancoRemesa").on("change",(function(a){new Promise((async(a,e)=>{await facturacion.Bank.Controller.Get($("#bancoRemesa option:selected").val()),a(!0)})).then((()=>{let a=facturacion.Bank.Model.Bank.nombre,e=null==facturacion.Bank.Model.Bank.iban?"No establecido":facturacion.Bank.Model.Bank.iban,t=null==facturacion.Bank.Model.Bank.creditorid?"No establecido":facturacion.Bank.Model.Bank.creditorid;$(".info-banco").html(`${a}`),$(".info-iban").html(`${e}`),$(".info-creditorid").html(`${t}`)}))}))},Controller:{Get:async function(a){await apiFincatech.get(`bank/${a}`).then((a=>{let e=JSON.parse(a);facturacion.Bank.Model.Bank=e.data.Bank[0],facturacion.Bank.Model.CuentaAsociada=null!==facturacion.Bank.Model.Bank.iban}))}},Model:{Bank:null,CuentaAsociada:!1},View:{}},Facturacion:{Constants:{ESTADO_FACTURADO:"F",ESTADO_PENDIENTE_FACTURACION:"P",ESTADO_FACTURAS_DEVUELTAS:"D"},Events:function(){"emision"==core.actionModel&&core.Forms.initializeSelectData(),$(".stats-facturacion-anual").length&&facturacion.Facturacion.Controller.LoadStatsDashboard(),facturacion.Facturacion.Controller.RenderList(),$("body .form-banco").off(core.helper.clickEventType).on(core.helper.clickEventType,".btnSaveData",(a=>{a.stopImmediatePropagation(),facturacion.Facturacion.Controller.Bank.Save()})),$("body").on(core.helper.clickEventType,".btnEliminarBanco",(function(a){let e=$(this).attr("data-nombre"),t=$(this).attr("data-id");facturacion.Facturacion.Controller.Bank.Delete(t,e)})),$("body").on(core.helper.clickEventType,".btnGenerarFactura",(function(a){facturacion.Facturacion.Controller.GenerarFacturacion()})),$("body").on(core.helper.clickEventType,".btnSimularFacturacion",(function(a){facturacion.Facturacion.Controller.SimularFacturacion()})),$("#mesFacturacion").on("change",(function(a){$(".mes-facturacion").html($("#mesFacturacion option:selected").text()),facturacion.Facturacion.Controller.InfoFacturacion()})),$("#usuarioId").on("change",(function(a){if("Facturacion"!==core.model)return;let e=$("#usuarioId option:selected").val(),t="Ninguno";parseInt(e)>0&&(t=$("#usuarioId option:selected").text()),$(".administrador-seleccionado").html(t),facturacion.Facturacion.Controller.InfoFacturacion()})),$(".chkServicio").on("change",(function(a){$(this).is(":checked")?facturacion.Facturacion.View.AddServicioToInfo($(this).val(),$(this).attr("data-nombre")):facturacion.Facturacion.View.RemoveServicioFromInfo($(this).val()),facturacion.Facturacion.Controller.InfoFacturacion()})),$("#formConfiguracion").length&&($(".btnSaveData").off(core.helper.clickEventType).on(core.helper.clickEventType,(function(a){facturacion.Facturacion.Controller.SaveConfiguration()})),facturacion.Facturacion.Controller.LoadConfiguration()),$("body").on(core.helper.clickEventType,".btnProcesoTerminado",(function(a){CoreUI.Progress.Hide()})),$("body").on(core.helper.clickEventType,".btnEliminarIngresoCuenta",(a=>{a.stopImmediatePropagation(),facturacion.Facturacion.Controller.IngresosCuenta.Delete($(a.currentTarget).attr("data-id"),$(a.currentTarget).attr("data-concepto"),$(a.currentTarget).attr("data-procesado"),$(a.currentTarget).attr("data-importe"),$(a.currentTarget).attr("data-fecha"),$(a.currentTarget).attr("data-administrador"))})),$("body .form-ingreso-cuenta").off(core.helper.clickEventType).on(core.helper.clickEventType,".btnSaveData",(a=>{a.stopImmediatePropagation(),facturacion.Facturacion.Controller.IngresosCuenta.Save()})),$("body").on(core.helper.clickEventType,".btnCrearFacturaRectificativa",(function(a){let e=$(this).attr("data-id"),t=$(this).attr("data-idrectificativa");if(!facturacion.Facturacion.Controller.ValidarFacturaRectificativa(t))return;let o=Object();o.id=e,o.numero=$(this).attr("data-numero"),o.total=$(this).attr("data-importe"),o.email=$(this).attr("data-email"),o.administrador=$(this).attr("data-administrador"),o.comunidad=$(this).attr("data-comunidad");new Promise((async(a,e)=>{await apiFincatech.getView("facturacion","modal_rectificativa",JSON.stringify(o)).then((e=>{CoreUI.Modal.CustomHTML(e,"Factura Rectificativa",(function(){$(".emailbody").trumbowyg()}),"70%"),a(!0)}))}))})),$("body").on(core.helper.clickEventType,".btnModalCrearFacturaRectificativa",(function(a){let e=$(this).attr("data-id");facturacion.Facturacion.Controller.GenerarFacturaRectificativa(e,"null")})),$("body").on(core.helper.clickEventType,".btnEnviarFactura",(function(a){let e=$(this).attr("data-id"),t=$(this).attr("data-idrectificativa"),o=$(this).attr("data-rectificativa"),r=Object();r.id=e,r.idrectificativa=t,r.numerorectificativa=o,r.numero=$(this).attr("data-numero"),r.total=$(this).attr("data-importe"),r.email=$(this).attr("data-email"),r.administrador=$(this).attr("data-administrador"),r.comunidad=$(this).attr("data-comunidad"),r.fecha=$(this).attr("data-fecha");new Promise((async(a,e)=>{await apiFincatech.getView("facturacion","modal_envio",JSON.stringify(r)).then((e=>{CoreUI.Modal.CustomHTML(e,"Enviar Factura por E-mail",(function(){$(".emailbody").trumbowyg()}),"70%"),a(!0)}))}))})),$("body").on(core.helper.clickEventType,".btnExportar",(function(a){let e=[];e.type=$(this).attr("data-type");new Promise((async(a,t)=>{await apiFincatech.getView("modals","informes/modal_excel",JSON.stringify(e)).then((e=>{CoreUI.Modal.CustomHTML(e,"",(async function(){await core.Forms.initializeSelectData()}),"50%"),a(!0)}))}))})),$("body").on(core.helper.clickEventType,".btnModalEnviarFactura",(function(a){let e=$(this).attr("data-id");facturacion.Facturacion.Controller.EnviarFactura(e)})),$("body").on(core.helper.clickEventType,".btnGenerarInformeExcel",(function(a){facturacion.Facturacion.Controller.ExportarInformeExcel()}))},Controller:{EstadoFacturacion:function(){return void 0!==facturacion.Facturacion.Model.InfoFacturacion.estadofacturacion.label_estado?facturacion.Facturacion.Model.InfoFacturacion.estadofacturacion.label_estado:facturacion.Facturacion.Constants.ESTADO_PENDIENTE_FACTURACION},Anyo:function(){return facturacion.Facturacion.Model.Anyo},SetAnyo:function(a){facturacion.Facturacion.Model.Anyo=a},Mes:function(){return facturacion.Facturacion.Model.Mes},SetMes:function(a){facturacion.Facturacion.Model.Mes=a},SetFacturacionAnual:function(a){facturacion.Facturacion.Model.FacturacionAnual=a},FacturacionAnual:function(){return facturacion.Facturacion.Model.FacturacionAnual},SetFacturacionMes:function(a){facturacion.Facturacion.Model.FacturacionMes=a},FacturacionMes:function(){return facturacion.Facturacion.Model.FacturacionMes},SetMonthCalculo:function(a){facturacion.Facturacion.Model.MonthCalculo=a},MonthCalculo:function(){return facturacion.Facturacion.Model.MonthCalculo},SetYearCalculo:function(a){facturacion.Facturacion.Model.YearCalculo=a},YearCalculo:function(){return facturacion.Facturacion.Model.YearCalculo},SetTotalIngresosCuentaPendiente:function(a){facturacion.Facturacion.Model.IngresosCuentaPendiente=a},TotalIngresosCuentaPendiente:function(){return facturacion.Facturacion.Model.IngresosCuentaPendiente},SetTotalFacturasMesEmitidas:function(a){facturacion.Facturacion.Model.FacturasMesEmitidas=a},TotalFacturasMesEmitidas:function(){return facturacion.Facturacion.Model.FacturasMesEmitidas},SetTotalFacturasMesDevueltas:function(a){facturacion.Facturacion.Model.FacturasMesDevueltas=a},TotalFacturasMesDevueltas:function(){return facturacion.Facturacion.Model.FacturasMesDevueltas},SetTotalLiquidaciones:function(a){facturacion.Facturacion.Model.TotalLiquidaciones=a},TotalLiquidaciones:function(){return facturacion.Facturacion.Model.TotalLiquidaciones},SetTotalRemesas:function(a){facturacion.Facturacion.Model.TotalRemesas=a},TotalRemesas:function(){return facturacion.Facturacion.Model.TotalRemesas},SetBestCustomer:function(a){facturacion.Facturacion.Model.BestCustomer=a},BestCustomer:function(){return facturacion.Facturacion.Model.BestCustomer},SetBestCustomerTotal:function(a){facturacion.Facturacion.Model.BestCustomerTotal=a},BestCustomerTotal:function(){return facturacion.Facturacion.Controller.Utils.FormatearNumero(facturacion.Facturacion.Model.BestCustomerTotal)},SetFacturasDevueltas:function(a){facturacion.Facturacion.Model.FacturasDevueltas=a},FacturasDevueltas:function(){return facturacion.Facturacion.Model.FacturasDevueltas},FacturasDevueltasTotal:function(){return facturacion.Facturacion.Controller.Utils.FormatearNumero(facturacion.Facturacion.Model.FacturasDevueltasTotal)},SetFacturasDevueltasTotal:function(a){facturacion.Facturacion.Model.FacturasDevueltasTotal=a},LoadStatsDashboard:async function(){facturacion.Facturacion.Controller.SetAnyo(moment().format("Y")),facturacion.Facturacion.Controller.SetMes(moment().format("M")),new Promise((async(a,e)=>{await facturacion.Facturacion.Controller.TotalFacturacionAnual(facturacion.Facturacion.Controller.Mes(),facturacion.Facturacion.Controller.Anyo()),a(!0)})).then((a=>{facturacion.Facturacion.Controller.Render()}))},TotalFacturacionAnual:async function(a,e){let t=Object();t.year=facturacion.Facturacion.Controller.Anyo(),t.month=facturacion.Facturacion.Controller.Mes(),await apiFincatech.post("facturacion/totalfacturacion",t).then((a=>{a=JSON.parse(a),facturacion.Facturacion.Controller.SetFacturacionAnual(a.data.facturacion_anual),facturacion.Facturacion.Controller.SetFacturacionMes(a.data.facturacion_mes),facturacion.Facturacion.Controller.SetMonthCalculo(a.data.month),facturacion.Facturacion.Controller.SetYearCalculo(a.data.year),facturacion.Facturacion.Controller.SetTotalIngresosCuentaPendiente(a.data.ingresoscuentapendiente),facturacion.Facturacion.Controller.SetTotalLiquidaciones(a.data.totalliquidaciones),facturacion.Facturacion.Controller.SetTotalRemesas(a.data.totalremesas),facturacion.Facturacion.Controller.SetFacturasDevueltasTotal(a.data.totalfacturasdevueltas),facturacion.Facturacion.Controller.SetFacturasDevueltas(a.data.facturasdevueltas),facturacion.Facturacion.Controller.SetTotalRemesas(a.data.totalremesas),facturacion.Facturacion.Controller.SetBestCustomer(a.data.bestcustomer),facturacion.Facturacion.Controller.SetBestCustomerTotal(a.data.bestcustomer_total_facturacion)}))},LoadConfiguration:async function(){await apiFincatech.get("facturacion/configuracion").then((a=>{a=JSON.parse(a),core.Forms.mapDataFromModel("formConfiguracion",a.data)}))},SaveConfiguration:async function(){if(core.Forms.prepareFormDataBeforeSend("formConfiguracion"),core.Forms.Validate()){new Promise((async(a,e)=>{await apiFincatech.post("facturacion/configuracion",core.Forms.data).then((e=>{a(e)}))})).then((a=>{let e=JSON.parse(a);"error"==e.status.response?CoreUI.Modal.Error(e.status.error):CoreUI.Modal.Success("La configuración se ha actualizado correctamente")}))}else CoreUI.Modal.Error(`<p class="text-left">Corrija los errores señalados para poder guardar la configuración actual:<br> ${core.Forms.errorMessage}</p>`,"Error de validación")},GetOptions:function(){let a=Object();return a.servicios=Array(),$(".chkServicio").each((function(e){$(this).is(":checked")&&a.servicios.push($(this).val())})),a.idadministrador=null==$("#usuarioId").val()?-1:$("#usuarioId").val(),a.mesfacturacion=$("#mesFacturacion").val(),a.idBanco=$("#bancoRemesa option:selected").val(),a.envioEmailAdministrador=1,a.agruparServicios=$("#chkAgrupaServicios").is(":checked"),a.agruparFacturas=1,a.envioAPI=$("#chkAPIComunidad").is(":checked"),a.conceptoCAE=$("#conceptoCAE").val(),a.conceptoDOCCAE=$("#conceptoDOCCAE").val(),a.conceptoDPD=$("#conceptoDPD").val(),a.conceptoCertificadoDigital=$("#conceptoCertificadosDigitales").val(),a.emailBody=$(".emailbody").trumbowyg("html"),a},SimularFacturacion:function(){if($("body").removeClass("progress"),!0===facturacion.Facturacion.Controller.ValidateSimulacion()){let a=facturacion.Facturacion.Controller.GetOptions();apiFincatech.post("facturacion/simulacion",a).then((a=>{let e=JSON.parse(a);"error"==e.data?CoreUI.Modal.Error("Error: "+e.status.error,"Error"):CoreUI.Modal.Success("La simulación se ha generado satisfactoriamente.<br><br>El fichero se descargará una vez cerrado este popup","",(function(){core.Files.ForceDownloadFile(e.data.base64,e.data.filename,e.data.type)}))}))}},GenerarFacturacion:function(){if($("body").removeClass("progress"),!0===facturacion.Facturacion.Controller.ValidateFacturacion()){CoreUI.Progress.Show();let a=facturacion.Facturacion.Controller.GetOptions();apiFincatech.postWithProgress("facturacion/generar",a,!1).then((a=>{try{let e=JSON.parse(a);"error"==e.data?CoreUI.Modal.Error("Error: "+e.data,"Error"):(CoreUI.Progress.SetMessage(e.data),CoreUI.Progress.Completed(),facturacion.Facturacion.Controller.InfoFacturacion())}catch(a){CoreUI.Modal.Error("Error al procesar la respuesta: "+a.message,"Error")}})).catch((a=>{CoreUI.Progress.Hide(),CoreUI.Modal.Error("Error: "+a.status.error,"Error")}))}},ValidarFacturaRectificativa:function(a){return"null"===a||(CoreUI.Modal.Error("Esta factura ya tiene asociada una factura rectificativa por lo tanto no se puede generar una nueva"),!1)},GenerarFacturaRectificativa:function(a,e){if("null"===e){let e=Object();e.concepto=$("body #conceptoFacturaRectificativa").val(),e.importe=$("body #importeFacturaRectificativa").val(),e.cuerpo=$(".emailbody").trumbowyg("html"),e.enviaremail=$("body #chkEnviarEmail").is(":checked")?1:0,new Promise((async(t,o)=>{await apiFincatech.post(`factura/${a}/rectificativa/create`,e).then((a=>{t(JSON.parse(a))}))})).then((a=>{"error"==a.data?CoreUI.Modal.Error(a.status.error):CoreUI.Modal.Success("La factura rectificativa ha sido generada correctamente con número: "+a.data,"",(function(){$("#listadoFacturacion").length&&$("#listadoFacturacion").DataTable().ajax.reload(),$("#listadoFacturasEmitidas").length&&$("#listadoFacturasEmitidas").DataTable().ajax.reload(),$("#listadoFacturasEmitidasPendiente").length&&$("#listadoFacturasEmitidasPendiente").DataTable().ajax.reload()}))}))}else CoreUI.Modal.Error("Esta factura ya tiene asociada una factura rectificativa por lo tanto no se puede generar una nueva")},EnviarFactura:function(a){let e=$("body .emailbody").trumbowyg("html"),t=$("body #asuntoEnvioFactura").val(),o=$("body #emailEnvioFactura").val();if(facturacion.Facturacion.Controller.ValidateBeforeSendInvoice()){let r=Object();r.id=a,r.asunto=t,r.email=o,r.cuerpo=e,apiFincatech.post(`factura/${a}/send`,r).then((a=>{let e=JSON.parse(a);"ok"==e.data?CoreUI.Modal.Success("La Factura ha sido enviada por e-mail satisfactoriamente","Factura enviada"):CoreUI.Forms.Errors.SetMessage("resultado","Ha ocurrido un error al intentar enviar la factura por e-mail: "+e.status.error)}))}},InfoFacturacion:async function(){let a=facturacion.Facturacion.Controller.GetOptions();facturacion.Facturacion.Model.ContratadoCae=!1,facturacion.Facturacion.Model.ContratadoDpd=!1,facturacion.Facturacion.Model.ContratadoCertificadosDigitales=!1,$(".numero-comunidades").html("0"),$(".importe-facturacion").html("0,00"),apiFincatech.post("facturacion/info",a).then((a=>{let e=JSON.parse(a);"error"==e.status.response?(facturacion.Facturacion.Model.ContratadoCae=!1,facturacion.Facturacion.Model.ContratadoDocCae=!1,facturacion.Facturacion.Model.ContratadoDpd=!1,facturacion.Facturacion.Model.ContratadoCertificadosDigitales=!1,facturacion.Facturacion.View.RemoveAllSelectedServices(),facturacion.Facturacion.View.ShowAvailableServices(),CoreUI.Modal.Error(`<p class="text-center mb-0">${e.status.error}</p>`)):(facturacion.Facturacion.Model.InfoFacturacion=e.data,facturacion.Facturacion.View.RenderInfoFacturacion())}))},ValidateSimulacion:function(){let a=!0,e="",t=null==$("#usuarioId").val()?-1:$("#usuarioId").val();return parseInt(t)<=0&&(e=`${e}-No ha seleccionado ningún administrador<br>`),""!==e&&(a=!1,CoreUI.Modal.Error(`<p class="text-left">No se ha podido simular la facturación debido a los siguientes problemas:</p><p class="text-left mb-0">${e}</p>`,"Error de validación")),a},ValidateFacturacion:function(){let a=!0,e="",t=null==$("#usuarioId").val()?-1:$("#usuarioId").val();return parseInt(t)<=0&&(e=`${e}-No ha seleccionado ningún administrador<br>`),$(".info-servicios .badge").length<=0&&(e=`${e}-Debe seleccionar al menos 1 servicio<br>`),0==parseInt($(".numero-comunidades").html())&&(e=`${e}-No hay comunidades para facturar<br>`),facturacion.Bank.Model.CuentaAsociada||(e=`${e}-El banco seleccionado no tiene informado el IBAN<br>`),""!==e&&(a=!1,CoreUI.Modal.Error(`<p class="text-left">No se ha podido generar la facturación debido a los siguientes problemas:</p><p class="text-left mb-0">${e}</p>`,"Error de validación")),a},Render:function(){let a=facturacion.Facturacion.Controller.FacturacionAnual(),e=facturacion.Facturacion.Controller.Utils.FormatearNumero(a.total_cae),t=facturacion.Facturacion.Controller.Utils.FormatearNumero(a.total_doccae),o=facturacion.Facturacion.Controller.Utils.FormatearNumero(a.total_dpd),r=facturacion.Facturacion.Controller.Utils.FormatearNumero(a.total_certificados),i=facturacion.Facturacion.Controller.Utils.FormatearNumero(a.total);$(".stats-facturacion-anual .total_cae").html(e),$(".stats-facturacion-anual .total_doccae").html(t),$(".stats-facturacion-anual .total_dpd").html(o),$(".stats-facturacion-anual .total_certificados").html(r),$(".stats-facturacion-anual .total_anual").html(i);let c=0,n=0,l=facturacion.Facturacion.Controller.FacturacionMes(),s=0;s+=parseFloat(l.facturacion_cobradas.total_cae)||0,s+=parseFloat(l.facturacion_cobradas.total_dpd)||0,s+=parseFloat(l.facturacion_cobradas.total_certificados)||0,s+=parseFloat(l.facturacion_cobradas.total_doccae)||0,s=facturacion.Facturacion.Controller.Utils.FormatearNumero(s),$(".stats-facturacion-mes .total_mes_facturas_emitidas").html(s),i=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_estimada.total),e=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_estimada.total_cae),c=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_cobradas.total_cae),n=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_devueltas.total_cae),$(".stats-facturacion-mes .total_cae").html(e),$(".stats-facturacion-mes .total_cae_emitidas").html(c),$(".stats-facturacion-mes .total_cae_devueltas").html(n),t=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_estimada.total_doccae),c=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_cobradas.total_doccae),n=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_devueltas.total_doccae),$(".stats-facturacion-mes .total_doccae").html(t),$(".stats-facturacion-mes .total_doccae_emitidas").html(c),$(".stats-facturacion-mes .total_doccae_devueltas").html(n),o=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_estimada.total_dpd),c=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_cobradas.total_dpd),n=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_devueltas.total_dpd),$(".stats-facturacion-mes .total_dpd").html(o),$(".stats-facturacion-mes .total_dpd_emitidas").html(c),$(".stats-facturacion-mes .total_dpd_devueltas").html(n),r=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_estimada.total_certificados),c=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_cobradas.total_certificados),n=facturacion.Facturacion.Controller.Utils.FormatearNumero(l.facturacion_devueltas.total_certificados),$(".stats-facturacion-mes .total_certificados").html(r),$(".stats-facturacion-mes .total_certificados_emitidas").html(c),$(".stats-facturacion-mes .total_certificados_devueltas").html(n),$(".stats-facturacion-mes .total_mes").html(i),$(".stats-facturacion-mes .month").html(facturacion.Facturacion.Controller.MonthCalculo()),$(".stats-facturacion-mes .year").html(facturacion.Facturacion.Controller.YearCalculo());let u=facturacion.Facturacion.Controller.TotalIngresosCuentaPendiente(),d=facturacion.Facturacion.Controller.TotalLiquidaciones(),f=facturacion.Facturacion.Controller.FacturasDevueltas(),m=facturacion.Facturacion.Controller.FacturasDevueltasTotal();u=facturacion.Facturacion.Controller.Utils.FormatearNumero(u),d=facturacion.Facturacion.Controller.Utils.FormatearNumero(d),$(".stats-facturacion-anual .total_ingresoscuenta_pendiente").html(u),$(".stats-facturacion-anual .total_liquidaciones").html(d),$(".stats-facturacion-anual .facturas_devueltas").html(f),$(".stats-facturacion-anual .facturas_devueltas_importe").html(m),$(".stats-facturacion-anual .total_remesas").html(facturacion.Facturacion.Controller.TotalRemesas());let b=facturacion.Facturacion.Controller.BestCustomer()+" [ "+facturacion.Facturacion.Controller.BestCustomerTotal()+"&euro; ]";$(".stats-facturacion-anual .best_customer").html(b)},ValidateBeforeSendInvoice:function(){let a="";if($(".emailEnvioFactura-msg-error").removeClass("d-none").addClass("d-none"),""==$("#swal2-html-container #emailEnvioFactura").val()&&(a="Debe escribir el e-mail al que desea enviar la factura"),""!==$("#swal2-html-container #emailEnvioFactura").val()){let e=$("#swal2-html-container #emailEnvioFactura").val().split(";");for(let t=0;t<e.length;t++)core.helper.validarEmail(e[t])||(a=`${a}El e-mail ${e[t]} no es válido<br>`)}return CoreUI.Forms.Errors.SetMessage("emailEnvioFactura",a),""===a},RenderList:function(){$("#listadoBank").length&&facturacion.Facturacion.View.ListBanks(),$("#listadoFacturasEmitidas").length&&facturacion.Facturacion.View.TableFacturasEmitidas(),$("#listadoFacturasEmitidasPendiente").length&&facturacion.Facturacion.View.TableFacturasEmitidasPendiente(),$("#listadoFacturacionRectificativas").length&&facturacion.Facturacion.View.TableFacturasRectificativas(),$("#listadoRemesas").length&&facturacion.Facturacion.View.TableRemesas(),$("#listadoFacturacion").length&&facturacion.Facturacion.View.TableFacturacion("listadoFacturacion"),$("#listadoRecibos").length&&facturacion.Facturacion.View.TableRecibos(),$("#listadoIngresosCuenta").length&&facturacion.Facturacion.View.TableIngresosCuenta(),$("#listadoLiquidaciones").length&&facturacion.Facturacion.View.TableLiquidaciones()},ExportarInformeExcel:function(){let a=$("#usuarioId").val();""==a&&(a=-1);let e=Object();e.idadministrador=a,e.datefrom=$("#exportDateFrom").val(),e.dateto=$("#exportDateTo").val(),e.estado=$("input[name=rbEstado]:checked").val(),apiFincatech.post("facturacion/informe",e).then((a=>{let e=JSON.parse(a);"error"==e.data?CoreUI.Modal.Error("No se ha podido generar el informe por el siguiente motivo:<br><br>"+e.status.error):CoreUI.Modal.Success("El informe se ha generado satisfactoriamente.<br><br>El fichero se descargará una vez cerrado este popup","",(function(){core.Files.ForceDownloadFile(e.data.base64,e.data.filename,e.data.type)}))}))},Bank:{Save:function(){let a=$("#bic").val();facturacion.Facturacion.Controller.Utils.ValidateBIC(a)?core.Forms.Validate("form-banco")?(core.Forms.mapDataToSave(),core.Forms.Save(!0)):CoreUI.Modal.Error("Rellene los campos obligatorios para poder guardar el banco","Formulario incompleto"):CoreUI.Modal.Error("El código SWIFT/BIC no es válido. Por favor, revíselo para poder continuar","Error BIC/Swift")},Delete:function(a,e){core.Modelo.Delete("bank",a,e,"listadoBank")}},IngresosCuenta:{ValidateBeforeSave:function(){return core.Forms.Validate(),"-1"==$("#usuarioId option:selected").val()&&core.Forms.SetError("Debe seleccionar un administrador"),isNaN($("#total").val())&&core.Forms.SetError("El valor del importe no es correcto"),""===core.Forms.GetErrorMessage()||(core.Forms.ShowErrorMessage(),!1)},Save:function(){facturacion.Facturacion.Controller.IngresosCuenta.ValidateBeforeSave()&&(core.Forms.mapFormDataToSave(),core.Forms.Save(!0))},Delete:function(a,e,t,o,r,i){if(!0===Boolean(parseInt(t)))CoreUI.Modal.Error("Este ingreso ya ha sido procesado en una liquidación por lo tanto no puede ser eliminado");else{let t=`<p class="mb-0 text-left"><span class="font-weight-bold">Administrador</span>: ${i}</p>\n                        <p class="mb-0 text-left"><span class="font-weight-bold">Concepto del ingreso a cuenta</span>: ${e}</p>\n                        <p class="mb-0 text-left"><span class="font-weight-bold">Importe</span>: ${Number(o).toFixed(2)}&euro;</p>\n                        <p class="mb-0 text-left"><span class="font-weight-bold">Fecha del apunte</span>: ${r}</p>`;Swal.fire({title:"¿Desea eliminar el ingreso a cuenta?",html:'<p class="font-weight-bold text-danger">Atención: Esta acción es irreversible</p>'+t,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&apiFincatech.delete("ingresoscuenta",a).then((a=>{"error"==(a=JSON.parse(a)).data?CoreUI.Modal.Error(a.status.error):(CoreUI.Modal.Success("El apunte de ingreso a cuenta se ha eliminado correctamente"),facturacion.Facturacion.View.TableIngresosCuenta())}))}))}}},Utils:{FormatearNumero:function(a){let e=parseFloat(a).toFixed(2).split("."),t=e[0],o=e[1];return t=t.replace(/\B(?=(\d{3})+(?!\d))/g,"."),t+","+o},ValidateBIC:function(a){return/^[A-Z]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$/.test(a)}}},Model:{Anyo:null,Mes:null,MonthCalculo:null,YearCalculo:null,FacturacionAnual:null,FacturacionMes:null,FacturasEmitidas:null,FacturasPendientesCobro:null,Remesas:null,IngresosCuentaPendiente:0,TotalLiquidaciones:0,TotalRemesas:0,BestCustomer:"",BestCustomerTotal:0,FacturasDevueltas:0,FacturasDevueltasTotal:0,FacturasMesEmitidas:0,FacturasMesDevueltas:0,InfoFacturacion:null,ContratadoCae:!1,ContratadoDocCae:!1,ContratadoDpd:!1,ContratadoCertificadosDigitales:!1},View:{ListBanks:function(){if($("#listadoBank").length){CoreUI.tableData.init(),CoreUI.tableData.addColumn("listadoBank","nombre","NOMBRE",null,"","60%"),CoreUI.tableData.addColumn("listadoBank","bic","BIC/SWIFT"),CoreUI.tableData.addColumn("listadoBank","codigo","Código Entidad"),CoreUI.tableData.addColumn("listadoBank","creditorid","Creditor ID"),CoreUI.tableData.addColumn("listadoBank","iban","IBAN");'<li class="nav-item"><a href="javascript:void(0);" class="btnEliminarBanco d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="trash-2" class="text-danger img-fluid icono-accion" style="width:26px;height:26px;"></i></li></ul>',CoreUI.tableData.addColumn("listadoBank",null,"",'<ul class="nav justify-content-center accionesTabla"><li class="nav-item"><a href="javascript:void(0);" class="btnEliminarBanco d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="trash-2" class="text-danger img-fluid icono-accion" style="width:26px;height:26px;"></i></li></ul>',"","80px"),CoreUI.tableData.render("listadoBank","Bank","bank/list")}},TableFacturacion:function(a){let e=a;CoreUI.tableData.init(),CoreUI.tableData.addColumn(e,"numero","Nº Fra.",null,"text-center","60px"),CoreUI.tableData.addColumn(e,"administrador","Administrador"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r="";return a.comunidad&&(r=`${a.comunidad[0].codigo} - ${a.comunidad[0].nombre}`),r}),"Comunidad",null),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r="";return a.comunidad&&(r=`${a.comunidad[0].cif}`),r}),"CIF Comunidad",null,"text-center"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r="";return r=`${moment(a.dateinvoice).locale("es").format("L")}`,r}),"Fecha Fra.",null,"text-center","120px"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r,i;return i=a.datepaid?moment(a.datepaid).locale("es").format("L"):"-",r=`${i}`,r}),"Fecha de Cobro",null,"text-center","120px"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r,i;return i=a.datereturned?moment(a.datereturned).locale("es").format("L"):"-",r=`${i}`,r}),"Fecha Devolución",null,"text-center","120px"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r="";return r=`${parseFloat(a.total_taxes_inc).toFixed(2)}&euro;`,r}),"Importe",null,"text-center"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){if(a.idrectificativa){return`\n                            <div class="d-flex align-items-center justify-content-center">\n                                <a href="${`https://factura.fincatech.es/pdf/${a.invoicerectificativa[0].nombrefichero}`}" title="Ver PDF generado" target="_blank"><i class="bi bi-filetype-pdf text-dark img-fluid icono-accion" style="font-size: 21px;"></i></a>\n                            </div>`}return'<span class="badge bg-success">No</span>'}),"Fra. Rectificativa",null,"text-center"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r="";return r=1==a.liquidada?'<span class="badge bg-success">Sí</span>':'<span class="badge bg-warning">No</span>',r}),"Liquidada",null,"text-center"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r,i,c;switch(a.estado){case"P":i="warning",c="Pendiente";break;case"D":i="danger",c="Devuelta";break;case"C":i="success",c="Cobrada";break}return r=`<span class="badge bg-${i}">${c}</span>`,r}),"Estado",null,"text-center"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r="";a.invoicerectificativa.length>0&&(r=a.invoicerectificativa[0].numero);let i=`data-id="${a.id}" data-numero="${a.numero}" data-email="${a.email}" data-administrador="${a.administrador}" data-numero="${a.id}"`;i=`${i} data-comunidad="${a.comunidad[0].nombre}" data-rectificativa="${r}" data-fecha="${moment(a.dateinvoice).locale("es").format("L")}" data-importe="${a.total_taxes_exc}" data-idrectificativa="${a.idrectificativa}"`;var c='<ul class="nav justify-content-center accionesTabla">';return c+=`<li class="nav-item"><a href="${`https://factura.fincatech.es/pdf/${a.fichero}.pdf`}" title="Ver PDF generado" target="_blank"><i class="bi bi-filetype-pdf text-success img-fluid icono-accion" style="font-size: 18px;"></i></a></li>`,c+=`<li class="nav-item"><a href="invoice/${a.id}" data-id="${a.id}" title="Ver factura"><i data-feather="eye" class="text-success img-fluid icono-accion" style="width:18px;height:18px;"></i></li>`,c+=`<li class="nav-item"><a href="javascript:void(0);" class="btnEnviarFactura" ${i} title="Enviar factura por e-mail"><i data-feather="mail" class="text-success img-fluid icono-accion" style="width:18px;height:18px;"></i></li>`,c+=`<li class="nav-item"><a href="javascript:void(0);" class="btnCrearFacturaRectificativa ml-1" ${i} title="Generar factura rectificativa"><i data-feather="rotate-ccw" class="text-danger img-fluid"></i></a></li>`,c+="</ul>"}),"&nbsp;",null,"text-center","100px"),$("#"+e).addClass("no-clicable"),CoreUI.tableData.render(e,"Invoice","invoice/list",!1,!0,!0,null,!0,!1,!1,!0,"GET",!1,!1)},TableFacturas:function(a,e){let t=a;CoreUI.tableData.init(),CoreUI.tableData.addColumn(t,(function(a,e,t,o){let r;return r=`<p class="mb-0">${a.numero}</p>`,r}),"Nº Fra.",null,"text-center","80px"),CoreUI.tableData.addColumn(t,"administrador","Administrador"),CoreUI.tableData.addColumn(t,"comunidad[0].nombre","Comunidad"),CoreUI.tableData.addColumn(t,(function(a,e,t,o){let r;return r=moment(a.dateinvoice).format("DD/MM/YYYY"),r}),"Fecha Fra.",null,"text-center"),CoreUI.tableData.addColumn(t,"total_taxes_inc","Importe"),CoreUI.tableData.addColumn(t,(function(a,e,t,o){let r,i,c;switch(a.estado){case"P":i="danger",c="Pendiente";break;case"D":i="warning",c="Devuelta";break;case"C":i="success",c="Cobrada";break}return r=`<span class="badge bg-${i}">${c}</span>`,r}),"Estado",null,"text-center"),CoreUI.tableData.addColumn(t,(function(a,e,t,o){let r,i;return a.idrectificativa&&(i='<p class="mb-0 text-center">\n                            <a href="" title="Ver PDF Fra. Rectificativa" target="_blank"><i class="bi bi-filetype-pdf text-danger" style="font-size: 21px;"></i></a>\n                        </p>'),r='\n                    <p class="mb-0 text-center">\n                        <a href="" title="Ver PDF generado" target="_blank"><i class="bi bi-filetype-pdf text-primary" style="font-size: 21px;"></i></a>\n                    </p>','\n                    <p class="mb-0 text-center">\n                        <a href="" title="Ver PDF generado" target="_blank"><i class="bi bi-filetype-pdf text-primary" style="font-size: 21px;"></i></a>\n                    </p>'}),"DOC.",null,"text-center"),CoreUI.tableData.addColumn(t,(function(a,e,t,o){let r="";a.invoicerectificativa.length>0&&(r=a.invoicerectificativa[0].numero);let i=`data-id="${a.id}" data-numero="${a.numero}" data-email="${a.email}" data-administrador="${a.administrador}" data-numero="${a.id}"`;i=`${i} data-comunidad="${a.comunidad[0].nombre}" data-rectificativa="${r}" data-fecha="${moment(a.dateinvoice).locale("es").format("L")}" data-importe="${a.total_taxes_exc}" data-idrectificativa="${a.idrectificativa}"`;var c='<ul class="nav justify-content-center accionesTabla">';return c+=`<li class="nav-item"><a href="invoice/${a.id}" data-id="${a.id}" title="Ver factura"><i data-feather="eye" class="text-success img-fluid icono-accion" style="width:18px;height:18px;"></i></li>`,c+=`<li class="nav-item"><a href="javascript:void(0);" class="btnEnviarFactura" ${i} title="Enviar factura por e-mail"><i data-feather="mail" class="text-success img-fluid icono-accion" style="width:18px;height:18px;"></i></li>`,c+=`<li class="nav-item"><a href="javascript:void(0);" class="btnCrearFacturaRectificativa ml-1" ${i} title="Generar factura rectificativa"><i data-feather="rotate-ccw" class="text-danger img-fluid"></i></a></li>`,c+="</ul>"}),"&nbsp;",null,"text-center","100px"),$("#"+t).addClass("no-clicable"),CoreUI.tableData.render(t,"Invoice",`facturacion/listado/${e}`,!1,!0,!0)},TableFacturasEmitidas:function(){facturacion.Facturacion.View.TableFacturas("listadoFacturasEmitidas","c")},TableFacturasEmitidasPendiente:function(){facturacion.Facturacion.View.TableFacturas("listadoFacturasEmitidasPendiente","D")},TableFacturasRectificativas:function(){let a="listadoFacturacionRectificativas";CoreUI.tableData.init(),CoreUI.tableData.addColumn(a,"numero","Nº Fra.",null,"text-start","120px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){return`\n                        <div class="d-flex align-items-center">\n                            <a href="${`https://factura.fincatech.es/pdf/${a.nombrefichero}.pdf`}" title="Ver PDF generado" target="_blank"><i class="bi bi-filetype-pdf text-dark img-fluid icono-accion" style="font-size: 21px;"></i></a>\n                            <p class="mb-0 text-center">${a.invoice[0].numero}</p>\n                        </div>`}),"Fra. Asociada",null,"text-start","120px"),CoreUI.tableData.addColumn(a,"administrador","Administrador"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return a.comunidad&&(r=`${a.comunidad[0].cif}`),r}),"CIF Comunidad",null,"text-center"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return a.comunidad&&(r=`${a.comunidad[0].codigo} - ${a.comunidad[0].nombre}`),r}),"Comunidad",null),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return r=`${moment(a.created).locale("es").format("L")}`,r}),"Fecha",null,"text-center","120px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return r=`${parseFloat(a.total_taxes_inc).toFixed(2)}&euro;`,r}),"Importe",null,"text-center"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r=`data-id="${a.id}" data-numero="${a.numero}" data-email="${a.email}" data-administrador="${a.administrador}" data-numero="${a.id}"`;r=`${r} data-comunidad="${a.comunidad[0].nombre}" data-invoice="${a.idinvoice}" data-fecha="${moment(a.creeated).locale("es").format("L")}" data-importe="${a.total_taxes_exc}" data-idrectificativa="${a.id}"`;var i='<ul class="nav justify-content-center accionesTabla">';return i+=`<li class="nav-item"><a href="${`https://factura.fincatech.es/pdf/${a.nombrefichero}.pdf`}" title="Ver PDF generado" target="_blank"><i class="bi bi-filetype-pdf text-success img-fluid icono-accion" style="font-size: 18px;"></i></a></li>`,i+=`<li class="nav-item"><a href="invoicerectificativa/${a.id}" data-id="${a.id}" title="Ver factura"><i data-feather="eye" class="text-success img-fluid icono-accion" style="width:18px;height:18px;"></i></li>`,i+=`<li class="nav-item"><a href="javascript:void(0);" class="btnEnviarFactura" ${r} title="Enviar factura por e-mail"><i data-feather="mail" class="text-success img-fluid icono-accion" style="width:18px;height:18px;"></i></li>`,i+="</ul>"}),"&nbsp;",null,"text-center","100px"),$("#"+a).addClass("no-clicable"),CoreUI.tableData.render(a,"InvoiceRectificativa","invoicerectificativa/list",!1,!0,!0,null,!0,!1,!1,!0,"GET",!1,!0)},TableRemesas:function(){let a="listadoRemesas";CoreUI.tableData.init(),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return r=moment(a.created).format("DD/MM/YYYY"),r}),"Fecha de remesa",null,"text-center","120px"),CoreUI.tableData.addColumn(a,"referencia","Referencia",null),CoreUI.tableData.addColumn(a,"customername","Administrador",null),CoreUI.tableData.addColumn(a,"creditoraccountiban","Banco de cobro"),CoreUI.tableData.addColumn(a,"totalrecibos","Nº de recibos",null,"text-center","100px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){return'<p class="mb-0">'+(Number(a.totalremesa).toFixed(2)+"&euro;")+"</p>"}),"Total Remesa",null,"text-center","100px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){var r='<ul class="nav justify-content-center accionesTabla">';return r+=`<li class="nav-item"><a href="${baseURL}remesa/${a.id}" class="btnEditarRemesa d-inline-block"><i data-feather="eye" class="text-success img-fluid icono-accion" style="width:32px;height:32px;"></i></a></li>`,r+=`<li class="nav-item"><a href="${baseURL}public/storage/remesas/${a.referencia}.xml" target="_blank" class="btnDescargarRemesa d-inline-block" download><i data-feather="download-cloud" class="text-primary img-fluid icono-accion" style="width:26px;height:26px;"></i></li></ul>`}),"",null,"text-center","80px"),CoreUI.tableData.render(a,"Remesa","remesa/list")},TableRecibos:function(){let a=core.modelId,e="listadoRecibos";CoreUI.tableData.init(),CoreUI.tableData.addColumn(e,"customername","Comunidad",null,""),CoreUI.tableData.addColumn(e,"descripcion","Concepto",null,""),CoreUI.tableData.addColumn(e,"customeriban","CC domiciliación",null,""),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r="";return r=Number(a.amount).toFixed(2)+"&euro;",r}),"Importe",null,"text-center"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r,i,c,n="";switch(a.estado){case"C":i="Cobrado",c="success";break;case"D":i="Devuelto",c="danger",n=moment(a.datereturned).format("DD/MM/YYYY");break}return r=`<span class="badge bg-${c}">${i}</span>`,""!==n&&(r+='<p class="mb-0 d-block"><small>'+n+"</p>"),r}),"Estado",null,"text-center"),CoreUI.tableData.addColumn(e,(function(a,e,t,o){let r="";return"D"!==a.estado&&(r='<ul class="nav justify-content-center accionesTabla">',r+=`<li class="nav-item"><a href="javascript:void(0);" data-idremesa="${a.idremesa}" data-idrecibo="${a.id}" class="btnDevolverRecibo d-inline-block"><i data-feather="rotate-ccw" class="text-danger img-fluid"></i></a></li>`,r+="</ul>"),r}),"",null,"text-center","80px"),$("#"+e).addClass("no-clicable"),CoreUI.tableData.render(e,"Recibos",`remesa/${a}/recibos`)},TableIngresosCuenta:function(){let a="listadoIngresosCuenta";CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return r=moment(a.fechaingreso).format("DD/MM/YYYY"),r}),"Fecha Ingreso",null,"text-center","100px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){return a.usuario[0].nombre}),"Administrador",null),CoreUI.tableData.addColumn(a,"concepto","Concepto",null,""),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return r=`<p class="mb-0 text-right">${CoreUI.Utils.formatNumberToCurrency(a.total)}&euro;</p>`,r}),"Importe",null,"text-center"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="",i="",c="";return 0==a.procesado?(c="No",i="danger"):(c="Sí",i="success"),r=`<span class="badge bg-${i}">${c}</span>`,r}),"Liquidado",null,"text-center"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){var r='<ul class="nav justify-content-center accionesTabla">';return r+=`<li class="nav-item"><a href="${baseURL}ingresoscuenta/${a.id}" class="btnEditarIngreso d-inline-block"><i data-feather="edit" class="text-success img-fluid icono-accion" style="width:32px;height:32px;"></i></a></li>`,r+=`<li class="nav-item"><a href="javascript:void(0);" class="btnEliminarIngresoCuenta d-inline-block" data-id="${a.id}" data-administrador="${a.usuario[0].nombre}" data-importe="${a.total}" data-fecha="${moment(a.fechaingreso).format("DD/MM/YYYY")}" data-procesado="${a.procesado}" data-concepto="${a.concepto}"><i data-feather="trash-2" class="text-danger img-fluid icono-accion" style="width:26px;height:26px;"></i></li></ul>`,r+="</ul>"}),"",null,"text-center","80px"),CoreUI.tableData.render(a,"IngresosCuenta","IngresosCuenta/list")},TableLiquidaciones:function(){let a="listadoLiquidaciones";CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return r=moment(a.created).format("DD/MM/YYYY"),r}),"Fecha Generación",null,"text-center","100px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r;return r=a.datefrom?`Desde ${moment(a.datefrom).format("DD/MM/YYYY")} hasta`:"Todo hasta",r=`${r} ${moment(a.dateto).format("DD/MM/YYYY")}`,r}),"Período liquidado",null,"text-center","200px"),CoreUI.tableData.addColumn(a,"referencia","Referencia",null,null,"270px"),CoreUI.tableData.addColumn(a,"administrador","Administrador",null,""),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="",i="",c="",n="";return a.fechapago?(c="Pagada",i="success",n=moment(a.fechapago).format("DD/MM/AAAA")):(c="Pendiente de pago",i="danger"),r=`<span class="badge bg-${i}">${c}</span>`,""!==n&&(r=`${r}<p class="mb-0 d-block">${n}</p>`),r}),"Estado",null,"text-center","100px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){return`<span class="badge bg-primary">${a.liquidaciondetalle.length}</span>`}),"Nº Facturas",null,"text-center","100px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";return r=`<p class="mb-0 text-right pr-2">${CoreUI.Utils.formatNumberToCurrency(a.total_taxes_exc)}&euro;</p>`,r}),"Total",null,"text-right","100px"),$("#"+a).addClass("no-clicable"),CoreUI.tableData.render(a,"Liquidacion","liquidaciones/list")},RenderInfoFacturacion:function(){$(".numero-comunidades").html(facturacion.Facturacion.Model.InfoFacturacion.numerocomunidades),$(".importe-facturacion").html(facturacion.Facturacion.Model.InfoFacturacion.totalfacturacion),$(".total-servicios .total-1 .importe").html(facturacion.Facturacion.Model.InfoFacturacion.total_cae),$(".total-servicios .total-2 .importe").html(facturacion.Facturacion.Model.InfoFacturacion.total_dpd),$(".total-servicios .total-3 .importe").html(facturacion.Facturacion.Model.InfoFacturacion.total_doccae),$(".total-servicios .total-5 .importe").html(facturacion.Facturacion.Model.InfoFacturacion.total_certificados);let a=facturacion.Facturacion.Model.InfoFacturacion.estadofacturacion.devueltas,e=facturacion.Facturacion.Model.InfoFacturacion.estadofacturacion.cobradas,t=facturacion.Facturacion.Model.InfoFacturacion.estadofacturacion.pendientes;$("#chkAgrupaServicios").prop("checked",facturacion.Facturacion.Model.InfoFacturacion.configuracion.optagrupaservicios),$("#chkAPIComunidad").prop("checked",facturacion.Facturacion.Model.InfoFacturacion.configuracion.optenvioapi),facturacion.Facturacion.Model.ContratadoCae=Boolean(Number(facturacion.Facturacion.Model.InfoFacturacion.servicios.cae)),facturacion.Facturacion.Model.ContratadoDocCae=Boolean(Number(facturacion.Facturacion.Model.InfoFacturacion.servicios.doccae)),facturacion.Facturacion.Model.ContratadoDpd=Boolean(Number(facturacion.Facturacion.Model.InfoFacturacion.servicios.dpd)),facturacion.Facturacion.Model.ContratadoCertificadosDigitales=Boolean(Number(facturacion.Facturacion.Model.InfoFacturacion.servicios.certificadosdigitales)),facturacion.Facturacion.View.RemoveAllSelectedServices(),facturacion.Facturacion.View.ShowAvailableServices(),!0===facturacion.Facturacion.Model.ContratadoCae&&(facturacion.Facturacion.View.AddServicioToInfo(1,"CAE"),$(".servicio-cae").show()),!0===facturacion.Facturacion.Model.ContratadoDocCae&&(facturacion.Facturacion.View.AddServicioToInfo(3,"DOCCAE"),$(".servicio-doccae").show()),!0===facturacion.Facturacion.Model.ContratadoDpd&&(facturacion.Facturacion.View.AddServicioToInfo(2,"DPD"),$(".servicio-dpd").show()),!0===facturacion.Facturacion.Model.ContratadoCertificadosDigitales&&($(".servicio-certificadosdigitales").show(),facturacion.Facturacion.View.AddServicioToInfo(5,"Certificados digitales"));let o="success",r="",i="white";switch(facturacion.Facturacion.Controller.EstadoFacturacion()){case facturacion.Facturacion.Constants.ESTADO_FACTURADO:o="success",r=`${e} Facturadas`;break;case facturacion.Facturacion.Constants.ESTADO_FACTURAS_DEVUELTAS:o="warning",r=`${a} Facturas devueltas`,i="dark";break;case facturacion.Facturacion.Constants.ESTADO_PENDIENTE_FACTURACION:o="danger",r=`${t} Pendiente de cobrar`;break}$(".estado-facturacion").html(`<span class="badge px-3 font-weight-normal text-${i} bg-${o}">${r}</span>`)},AddServicioToInfo:function(a,e){if(0==$(".info-servicios .badge").length&&$(".info-servicios").html(""),$(`.info-servicios .servicio-${a}`).length<=0){let t=`<span class="badge mr-2 rounded-pill bg-info font-weight-normal text-white servicio-${a}">${e}</span>`;$(".info-servicios").append(t),$(".total-servicios").removeClass("d-none"),$(`.total-servicios .total-${a}`).removeClass("d-none")}},RemoveServicioFromInfo:function(a){let e=0;if($(`body .info-servicios .servicio-${a}`).remove(),$(".chkServicio").each((function(a){$(this).is(":checked")&&e++})),e<=0){$(".info-servicios").html("No ha seleccionado ningún servicio"),$(".total-servicios").addClass("d-none");for(let a=1;a<=5;a++)$(`.total-servicios .total-${a}`).removeClass("d-none").addClass("d-none")}},RemoveAllSelectedServices:function(){$(".servicio-doccae").hide(),$(".servicio-cae").hide(),$(".servicio-doccae").hide(),$(".servicio-dpd").hide(),$(".servicio-certificadosdigitales").hide(),facturacion.Facturacion.View.RemoveServicioFromInfo(1),facturacion.Facturacion.View.RemoveServicioFromInfo(2),facturacion.Facturacion.View.RemoveServicioFromInfo(3),facturacion.Facturacion.View.RemoveServicioFromInfo(5)},ShowAvailableServices:function(){$(".btnGenerarFactura").removeClass("disabled"),0==facturacion.Facturacion.Model.ContratadoCae&&0==facturacion.Facturacion.Model.ContratadoDpd&&0==facturacion.Facturacion.Model.ContratadoCertificadosDigitales?($(".emision--servicios-info").hide(),$(".emision--servicios-noinfo .mensaje").text("Este administrador no tiene servicios contratados"),$(".emision--servicios-noinfo").show(),$(".btnGenerarFactura").addClass("disabled")):($(".emision--servicios-info").show(),$(".emision--servicios-noinfo").hide())}}},Liquidaciones:{Init:function(){facturacion.Liquidaciones.Events()},Events:function(){$("#dateto").val(moment().format("YYYY-MM-DD")),facturacion.Liquidaciones.Model.dateTo=moment($("#dateto").val()).format("YYYY-MM-DD"),$("#dateto").on("change",(function(a){let e=facturacion.Liquidaciones.Validator.SelectedDates();!0!==e?(CoreUI.Modal.Error(`<p>Se han encontrado los siguientes errores:</p> ${e}`),facturacion.Liquidaciones.Model.dateTo=""):(facturacion.Liquidaciones.Model.dateTo=$("#dateto").val(),facturacion.Liquidaciones.Controller.LoadInfo()),facturacion.Liquidaciones.View.RenderInformation()})),$("#datefrom").on("change",(function(a){let e=facturacion.Liquidaciones.Validator.SelectedDates();!0!==e?(CoreUI.Modal.Error(`<p>Se han encontrado los siguientes errores:</p> ${e}`),facturacion.Liquidaciones.Model.dateFrom=""):(facturacion.Liquidaciones.Model.dateFrom=$("#datefrom").val(),facturacion.Liquidaciones.Controller.LoadInfo()),facturacion.Liquidaciones.View.RenderInformation()})),$("#usuarioId").on("change",(function(a){facturacion.Liquidaciones.Model.administrador=$("#usuarioId option:selected").text(),facturacion.Liquidaciones.Model.idadministrador=$("#usuarioId option:selected").val(),facturacion.Liquidaciones.View.RenderInformation(),facturacion.Liquidaciones.Controller.LoadInfo()})),$("body").on(core.helper.clickEventType,".btnGenerarLiquidacion",(function(a){facturacion.Liquidaciones.Model.administrador=$("#usuarioId option:selected").text(),facturacion.Liquidaciones.Model.idadministrador=$("#usuarioId option:selected").val(),facturacion.Liquidaciones.Controller.Generate()}))},Controller:{Generate:function(){new Promise((async(a,e)=>{let t=Object();t.idadministrador=facturacion.Liquidaciones.Model.idadministrador,t.datefrom=facturacion.Liquidaciones.Model.dateFrom,t.dateto=facturacion.Liquidaciones.Model.dateTo,await apiFincatech.post("liquidaciones/generate",t).then((e=>{let t=JSON.parse(e);"error"==t.data?CoreUI.Modal.Error(t.status.error,"Error"):CoreUI.Modal.Success(`La liquidación se ha generado correctamente<br><br>${t.data}`,"Liquidación",(function(){facturacion.Liquidaciones.Controller.LoadInfo()})),a(!0)}))})).then((a=>{}))},LoadInfo:function(){new Promise((async(a,e)=>{let t=Object();t.idadministrador=facturacion.Liquidaciones.Model.idadministrador,t.datefrom=facturacion.Liquidaciones.Model.dateFrom,t.dateto=facturacion.Liquidaciones.Model.dateTo,await apiFincatech.post("liquidaciones/info",t).then((e=>{let t=JSON.parse(e);t=t.data,facturacion.Liquidaciones.Model.numeroComunidades=t.total_comunidades,facturacion.Liquidaciones.Model.totalTaxesExc=t.total_taxes_exc,facturacion.Liquidaciones.Model.totalTaxesInc=t.total_taxes_inc,facturacion.Liquidaciones.Model.totalIngresosCuenta=t.total_ingreso_cuenta,facturacion.Liquidaciones.Model.totalPendienteLiquidacion=t.total_liquidacion,a(!0)}))})).then((a=>{facturacion.Liquidaciones.View.RenderInformation()}))}},Model:{numeroComunidades:0,idadministrador:-1,administrador:"Ninguno",estado:"-",totalPendienteLiquidacion:0,totalIngresosCuenta:0,totalTaxesInc:0,totalTaxesExc:0,pendienteLiquidacion:0,dateFrom:"",dateTo:""},Validator:{SelectedDates:function(){let a="",e=moment();if(""==$("#dateto").val()&&(a=`${a}<p class="mb-0">- <strong>Fecha Hasta</strong> está vacía o es incorrecta</p>`),""!==$("#dateto").val()){moment($("#dateto").val(),"YYYY-MM-DD").isAfter(e)&&(a=`${a}<p class="mb-0">La fecha hasta debe ser igual o inferior a la fecha de hoy</p>`,$("#dateto").val(moment().format("YYYY-MM-DD")),facturacion.Liquidaciones.Model.dateTo=moment($("#dateto").val()).format("YYYY-MM-DD"))}if(""!==$("#datefrom").val()&&""!==$("#dateto").val()){let e=moment($("#datefrom").val(),"YYYY-MM-DD"),t=moment($("#dateto").val(),"YYYY-MM-DD");e.isAfter(t)&&(a=`${a}<p class="mb-0">- <strong>Fecha Desde</strong> debe ser inferior a la <strong>Fecha Hasta</strong></p>`,$("#datefrom").val(""))}return""==a||a}},View:{RenderInformation:function(){if($(".administrador-seleccionado").html(facturacion.Liquidaciones.Model.administrador),$(".numero-comunidades").html(facturacion.Liquidaciones.Model.numeroComunidades),!0===facturacion.Liquidaciones.Validator.SelectedDates()){let a=moment($("#datefrom").val()).format("DD/MM/YYYY"),e=moment($("#dateto").val()).format("DD/MM/YYYY");$(".periodo-liquidacion").html(`Desde ${a} hasta ${e} inclusive`)}""==facturacion.Liquidaciones.Model.dateFrom&&""!==facturacion.Liquidaciones.Model.dateTo&&$(".periodo-liquidacion").html("Todo hasta el día "+moment($("#dateto").val()).format("DD/MM/YYYY")),""==facturacion.Liquidaciones.Model.dateFrom&&""==facturacion.Liquidaciones.Model.dateTo&&$(".periodo-liquidacion").html("No ha seleccionado fechas"),$(".importe-pendiente-liquidacion").html(facturacion.Liquidaciones.Model.totalPendienteLiquidacion),$(".importe-ingresos-cuenta").html(facturacion.Liquidaciones.Model.totalIngresosCuenta),$(".total_taxes_inc").html(facturacion.Facturacion.Controller.Utils.FormatearNumero(facturacion.Liquidaciones.Model.totalTaxesInc)),$(".total_taxes_exc").html(facturacion.Facturacion.Controller.Utils.FormatearNumero(facturacion.Liquidaciones.Model.totalTaxesExc))},RenderTable:{}}},Prefacturacion:{generarInformePrefacturacion:function(){var a=$(".fechaDesde").val(),e=$(".fechaHasta").val(),t=$("#usuarioId option:selected").val(),o=$("#usuarioId option:selected").text();if(""==e||""!=a){var r=Object();r.fechaDesde=a,r.fechaHasta=e,r.nombreAdministrador=o,apiFincatech.post(`facturacion/prefacturacion/${t}`,r).then((a=>{var e=JSON.parse(a);"error"==e.status.response?CoreUI.Modal.Error(e.status.error):window.open(e.data)}))}else CoreUI.Modal.Error("Proporcione la fecha desde para generar el informe")}},Remesa:{todos:!1,Controller:{SeleccionarRecibo:function(a){facturacion.Remesa.Model.ExisteReciboSeleccionado(a)||facturacion.Remesa.Model.recibos.indexOf(a)||facturacion.Remesa.Model.recibos.push(a)},DeseleccionarRecibo:function(a){facturacion.Remesa.Model.ExisteReciboSeleccionado(a)||facturacion.Remesa.Model.recibos.length>0||facturacion.Remesa.Model.recibos.indexOf(a)&&facturacion.Remesa.Model.recibos.splice(a,1)},GenerarRemesaManual:function(){let a="",e=0,t=$("#bancoRemesa option:selected").val(),o=[];facturacion.Remesa.Model.recibosDevueltos||(a='<p class="text-left mb-0"><i class="bi bi-x-circle text-danger"></i> No hay recibos devueltos para poder crear una remesa manual</p>'),facturacion.Remesa.Model.recibosDevueltos.each(((a,t)=>{1==facturacion.Remesa.Model.recibosDevueltos[t].seleccionado&&(o.push(facturacion.Remesa.Model.recibosDevueltos[t]),e++)})),0==e&&(a=`${a}<p class="text-left mb-0"><i class="bi bi-x-circle text-danger"></i> Debe seleccionar al menos 1 recibo para poder generar una nueva remesa</p>`),t<=0&&(a=`${a}<p class="text-left mb-0"><i class="bi bi-x-circle text-danger"></i> Debe seleccionar el banco al que desea enviar la remesa</p>`),""!==a?CoreUI.Modal.Error(`<p class="text-left">No se ha podido crear la remesa por los siguientes motivos:</p><br>${a}`):(a='<p class="text-center">Se va a proceder a crear una remesa manual. Por favor, revise si es correcto antes de continuar</p><br>',a=`${a}<p class="text-center mb-0"><span class="font-weight-bold">Nº recibos</span></p><p class="text-center">${e}</p>`,a=`${a}<p class="text-center mb-0"><span class="font-weight-bold">Importe de la remesa</span></p><p class="text-center"> ${CoreUI.Utils.formatNumberToCurrency(facturacion.Remesa.Model.importeDevolucion)}€</p>`,CoreUI.Modal.Question(a,"Creación remesa manual","Sí, crear remesa manual",(function(){let a=Object();a.recibos=o,a.idbanco=t,apiFincatech.post("remesa/generacionmanual",a,!0).then((a=>{try{let e=JSON.parse(a);"error"==e.data?CoreUI.Modal.Error("Error: "+e.data,"Error"):CoreUI.Modal.Success(e.data,"Remesa generada correctamente",(function(){facturacion.Remesa.View.TablaRecibosDevueltos(),$("#informacionRecibosNuevaRemesa .total-recibos-seleccionados").html("0"),$("#informacionRecibosNuevaRemesa .total-importe-recibos-seleccionados").html("0€")}))}catch(a){CoreUI.Modal.Error("Error al procesar la respuesta: "+a.message,"Error")}})).catch((a=>{CoreUI.Progress.Hide(),CoreUI.Modal.Error("Error: "+a.status.error,"Error")}))})))}},Model:{importeDevolucion:0,recibos:Array(),recibosDevueltos:null,ExisteReciboSeleccionado:function(a){if(null!==recibos)for(let a=0;a<facturacion.Remesa.Model.recibos.length;a++);}},Events:function(){$("body").on(core.helper.clickEventType,".btnProcesarRemesaDevolucion",(function(a){apiFincatech.getView("facturacion","modal_devolucion_remesa").then((a=>{CoreUI.Modal.CustomHTML(a,null,(function(){core.Files.init()}))}))})),$("body").on(core.helper.clickEventType,".btnUploadXML",(function(a){facturacion.Remesa.ProcesarDevolucion()})),$("body").on(core.helper.clickEventType,".chkDeseleccionar",(function(a){let e=`table${$(this).attr("data-table")}`,t=`input[type="checkbox"].${$(this).attr("data-target")}`;facturacion.Remesa.Model.recibosDevueltos.each(((a,e)=>{facturacion.Remesa.Model.recibosDevueltos[e].seleccionado=!1})),facturacion.Remesa.View.RenderEstadoCheckboxSeleccion(e,t,!1),facturacion.Remesa.View.RenderInformacionRecibosDevueltos()})),$("body").on(core.helper.clickEventType,".chkSeleccionarTodo",(function(a){let e=`table${$(this).attr("data-table")}`,t=`input[type="checkbox"].${$(this).attr("data-target")}`;facturacion.Remesa.Model.recibosDevueltos.each(((a,e)=>{facturacion.Remesa.Model.recibosDevueltos[e].seleccionado=!1})),window[e].rows({search:"applied"}).data().each((function(a,e){let t=a.id,o=facturacion.Remesa.Model.recibosDevueltos.toArray().find((a=>a.id===t));o&&(o.seleccionado=!0)})),facturacion.Remesa.View.RenderEstadoCheckboxSeleccion(e,t,!0),facturacion.Remesa.View.RenderInformacionRecibosDevueltos()})),$("body").on(core.helper.clickEventType,".chkReciboDevuelto",(function(a){let e=$(this).attr("data-id"),t=facturacion.Remesa.Model.recibosDevueltos.toArray().find((a=>a.id===e));t&&(t.seleccionado=$(this).is(":checked")),facturacion.Remesa.View.RenderInformacionRecibosDevueltos()})),$("body").on(core.helper.clickEventType,".btnDevolverRecibo",(function(a){let e=$(this).attr("data-idrecibo"),t=$(this).attr("data-idremesa");facturacion.Remesa.DevolverRecibo(t,e)})),$("body").on(core.helper.clickEventType,".btnGenerarRemesaManual",(function(a){facturacion.Remesa.Controller.GenerarRemesaManual()})),facturacion.Remesa.View.RenderTables(),core.Forms.initializeSelectData()},DevolverRecibo:function(a,e){a||e?CoreUI.Modal.Question("¿Desea procesar la devolución de este recibo?","Devolución de recibo","Devolver",(function(){new Promise(((t,o)=>{apiFincatech.post(`remesa/${a}/recibo/${e}/devolucion`).then((a=>{let e=JSON.parse(a);"error"===e.status.response?CoreUI.Modal.Error(e.status.error,"Devolución de recibo"):(CoreUI.Modal.Success("El recibo ha sido devuelto satisfactoriamente"),window.tablelistadoRecibos.ajax.reload()),t(!0)}))}))})):CoreUI.Modal.Error("No se ha proporcionado la remesa y recibo a devolver")},ProcesarDevolucion:function(){let a=document.getElementById("ficheroadjuntar");if($(".wrapperMensajeErrorCarga").hide(),0===a.files.length)return $(".wrapperMensajeErrorCarga .mensaje").html("Debe adjuntar el fichero que desea procesar"),void $(".wrapperMensajeErrorCarga").show();let e=a.files[0],t=new FormData;t.append("file",e),new Promise((async(a,e)=>{apiFincatech.post("remesa/devolucion",t).then((e=>{let t=JSON.parse(e);"error"==t.status.response?CoreUI.Modal.Error("Ha ocurrido el siguiente error:<br><br>"+t.status.error):CoreUI.Modal.Success(t.data),a(e)}))})).then((a=>{}))},View:{RenderEstadoCheckboxSeleccion:function(a,e,t){window[a].rows({search:"applied"}).every((function(){$(this.node()).find(e).prop("checked",t)})).nodes()},RenderInformacionRecibosDevueltos:function(){let a=0,e=0;facturacion.Remesa.Model.recibosDevueltos.each(((t,o)=>{1==t.seleccionado&&(a++,e=parseFloat(t.amount)+parseFloat(e))})),facturacion.Remesa.Model.importeDevolucion=e,$("#informacionRecibosNuevaRemesa .total-recibos-seleccionados").html(a),$("#informacionRecibosNuevaRemesa .total-importe-recibos-seleccionados").html(`${CoreUI.Utils.formatNumberToCurrency(e)}€`)},RenderTables:function(){facturacion.Remesa.View.TablaRecibosDevueltos(),facturacion.Remesa.View.TablaRecibosCobrados()},TablaRecibosCobrados:function(){let a="listadoRecibosCobrados";$(`#${a}`).length>0&&(CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn(a,(function(a,e,t,o){return`<p class="text-center mb-0"><input class="chkRecibo" type="checkbox" name="chkRecibo${a.id}" id="chkRecibo${a.id}" data-id="${a.id}"></p>`}),"Seleccionar",null,"text-center"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";if(a.created){r=`${moment(a.created).locale("es").format("L")}`}return r}),"Fecha",null,"text-center","120px"),CoreUI.tableData.addColumn(a,"descripcion","Recibo"),CoreUI.tableData.addColumn(a,"referencia","Remesa"),CoreUI.tableData.addColumn(a,"customername","Administrador"),CoreUI.tableData.addColumn(a,"comunidad","Comunidad"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){return`<p class="mb-0 text-right pr-2">${a.amount}&euro;</p>`}),"Importe",null,"text-center"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r='<ul class="nav justify-content-center accionesTabla">';return r+=`<li class="nav-item"><a href="javascript:void(0);" data-idremesa="${a.idremesa}" data-idrecibo="${a.id}" class="btnDevolverRecibo d-inline-block"><i data-feather="rotate-ccw" class="text-danger img-fluid"></i></a></li>`,r=`${r}</ul>`,r}),"",null,"text-center"),$("#"+a).addClass("no-clicable"),CoreUI.tableData.render(a,"Remesa","remesa/reciboscobrados/list",!0,!0,!0,null,!1,!1,null,!1,"GET",!1))},TablaRecibosDevueltos:function(){if($("#listadoRecibosDevueltos").length){let a="listadoRecibosDevueltos";CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn(a,(function(a,e,t,o){return`<input class="chkReciboDevuelto" type="checkbox" name="chkRemesa${a.id}" id="chkRemesa${a.id}" data-invoiceid="${a.invoiceid}" data-id="${a.id}">`}),"&nbsp;",null),CoreUI.tableData.addColumn(a,"customername","Administrador"),CoreUI.tableData.addColumn(a,"comunidad","Comunidad"),CoreUI.tableData.addColumn(a,"descripcion","Recibo"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){return`<p class="mb-0 text-right pr-2">${a.amount}&euro;</p>`}),"Importe"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="";if(a.created){r=`${moment(a.created).locale("es").format("L")}`}return r}),"Fecha",null,"text-center","120px"),CoreUI.tableData.addColumn(a,(function(a,e,t,o){let r="N/D";if(a.fechadevolucionbanco){r=`${moment(a.fechadevolucionbanco).locale("es").format("L")}`}return r}),"Fecha Devolución",null,"text-center","120px");'<li class="nav-item"><a href="javascript:void(0);" class="btnEliminar d-inline-block" data-id="data:id$" data-nombre="data:nombre$"><i data-feather="trash-2" class="text-danger img-fluid icono-accion" style="width:26px;height:26px;"></i></li></ul>',$("#"+a).addClass("no-clicable"),CoreUI.tableData.render(a,"Remesa","remesa/recibosdevueltos/list",!0,!0,!0,null,!1,!1,null,!1,"GET",!1),window["table"+a].on("init",(function(a,e,t){facturacion.Remesa.Model.recibosDevueltos=window.tablelistadoRecibosDevueltos.rows().data();let o=0,r=0;facturacion.Remesa.Model.recibosDevueltos.rows().data().length>0&&facturacion.Remesa.Model.recibosDevueltos.each((function(a,e){o++,r=parseFloat(facturacion.Remesa.Model.recibosDevueltos[e].amount)+parseFloat(r),facturacion.Remesa.Model.recibosDevueltos[e].seleccionado=!1})),$("#informacionRemesaDevuelta .infoRecibosDevueltos").html(o),$("#informacionRemesaDevuelta .infoRecibosDevueltosImporte").html(CoreUI.Utils.formatNumberToCurrency(r)+"&euro;")})),window["table"+a].on("draw",(function(){facturacion.Remesa.Model.recibosDevueltos&&$(`#${a} tbody input[type="checkbox"]`).each((function(){let a=$(this).attr("data-id"),e=facturacion.Remesa.Model.recibosDevueltos.toArray().find((e=>e.id===a));$(this).prop("checked",e.seleccionado)}))}))}}}}};$((()=>{core.model,document.addEventListener("coreInitialized",(function(a){facturacion.Init(),facturacion.Facturacion.Events(),"Prefacturacion"!=core.model&&"emision"!=core.model||CoreUI.Controller.InitializeSelectData()}))}));