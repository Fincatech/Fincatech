let documentalCore={NotasInformativas:Object(),notainformativa:Object(),RGPD_DOCUMENTACIONBASICA:1,RGPD_CAMARASEGURIDAD:2,RGPD_CONTRATOSCESION:3,CAE_EMPRESA:4,CAE_EMPLEADO:5,CAE_COMUNIDAD:6,CAE_AUTONOMO:7,ENTIDAD_GENERAL:"informacion",ENTIDAD_EMPRESA:"empresa",ENTIDAD_COMUNIDAD:"comunidad",ENTIDAD_EMPLEADO:"empleado",idrequerimiento:null,idcomunidad:null,idempleado:null,idempresa:null,idadministrador:null,entidad:null,lastUploadedRequerimiento:null,init:async function(){$("#listadoNotasinformativas").length||(core.Files.init(),core.Files.Fichero.entidadId=core.modelId),$("#listadoDocumentacionBasica").length,documentalCore.Events(),core.Files.init(),$("#listadoNotasinformativas").length&&"DPD"==core.Security.getRole()&&notasInformativasCore.renderTabla()},Events:function(){$("body .bntUploadDocumento").off(),$("body").on(core.helper.clickEventType,".bntUploadDocumento",(function(e){e.stopImmediatePropagation(),documentalCore.uploadRequerimiento()})),$("body .btnAdjuntarFicheroDocumento").off(),$("body").on(core.helper.clickEventType,".btnAdjuntarFicheroDocumento",(async function(){console.log("btnAdjuntarFicheroDocumento contratista"),documentalCore.idadministrador=null,documentalCore.idcomunidad=$(this).attr("data-idcomunidad"),documentalCore.idempresa=$(this).attr("data-idempresa"),documentalCore.idempleado=$(this).attr("data-idempleado"),documentalCore.idrequerimiento=$(this).attr("data-idrequerimiento"),documentalCore.idrelacionrequerimiento=$(this).attr("data-idrelacionrequerimiento"),documentalCore.entidad=$(this).attr("data-entidad");const{value:file}=await Swal.fire({title:"",html:Constantes.CargaDocumento,showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,didOpen:function(){core.Files.init()}})})),$("body .btnAdjuntarDocumentoRGPD").off(),$("body").on(core.helper.clickEventType,".btnAdjuntarDocumentoRGPD",(async function(){documentalCore.idcomunidad=core.modelId,documentalCore.entidad=$(this).attr("data-tipo"),documentalCore.idrequerimiento=$(this).attr("data-idrequerimiento");const{value:file}=await Swal.fire({title:"",html:Constantes.CargaDocumentoRGPD,showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,didOpen:function(){"camarasseguridad"==documentalCore.entidad&&void 0!==documentalCore.idrequerimiento&&($(".wrapperTituloDocumento").remove(),$(".wrapperObservaciones").remove()),core.Files.init()}})})),$("body").on(core.helper.clickEventType,".btnAdjuntarDocumentoEmpleadoRGPD",(async function(){var nombreEmpleado="";documentalCore.entidad=$(this).attr("data-tipo"),documentalCore.idrequerimiento=$(this).attr("data-idrequerimiento"),void 0!==$(this).attr("data-idrow")&&(nombreEmpleado=window.tablelistadoRGPDEmpleadosAdministracion.row($(this).attr("data-idrow")).data().titulo);const{value:file}=await Swal.fire({title:"",html:rgpdCore.Constantes.CargaDocumentoEmpleadoRGPD,showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,didOpen:function(){$(".wrapperTituloDocumento .tituloDocumentoRGPD").val(nombreEmpleado),core.Files.init()}})})),$("body .bntUploadDocumentoRGPD").off(),$("body").on(core.helper.clickEventType,".bntUploadDocumentoRGPD",(function(e){e.stopImmediatePropagation(),documentalCore.uploadRequerimientoRGPD()})),$("body").on(core.helper.clickEventType,".bntUploadDocumentoEmpleadoRGPD",(function(e){e.stopImmediatePropagation(),""==$("body .tituloDocumentoRGPD").val()?$("body .tituloDocumentoRGPD").removeClass("form-error").addClass("form-error"):documentalCore.uploadContratoConfidencialidadEmpleadoRGPD()})),$("body").on(core.helper.clickEventType,".btnEliminarDocumentoRGPD",(function(e){var id=$(this).attr("data-id"),nombre=$(this).attr("data-nombre"),tipo=$(this).attr("data-tipo");documentalCore.RGPD.eliminarDocumento(id,nombre,tipo)})),$("body").on(core.helper.clickEventType,".btnDescargarFichero",(function(e){var idComunidad,idEmpresa,idFichero,idUsuario=core.Security.user;"CONTRATISTA"==core.Security.getRole()&&(idEmpresa=core.Security.user),"Comunidad"==core.model&&(idComunidad=core.modelId),idFichero=$(this).attr("data-idfichero"),documentalCore.Helper.reflejarDescargaFichero(idFichero,idComunidad,idEmpresa,idUsuario)})),$("body").on(core.helper.clickEventType,".btnVerMotivoRechazo",(function(ev){CoreUI.Modal.Info(documentalCore.Model.motivosRechazo[$(this).attr("data-idmotivo")],"Motivo del rechazo")})),$("body").on(core.helper.clickEventType,"#listadoEmpleadosComunidad tr",(function(evt){evt.stopImmediatePropagation();var idEmpleado=window.tablelistadoEmpleadosComunidad.row($(this).attr("id")).data().idempleado;core.Files.Fichero.entidadId=idEmpleado,$("body .empleadoRequerimientosInfo").text("Requerimientos de "+window.tablelistadoEmpleadosComunidad.row($(this).attr("id")).data().nombre),$("body .empleadoRequerimientosInfo").show(),$("body .wrapperDocumentacionEmpleado .mensajeInformacion").hide(),$("body #wrapperContratistaDocumentacionEmpleado").removeClass("d-none"),documentalCore.Listado.Cargar("wrapperContratistaDocumentacionEmpleado",documentalCore.ENTIDAD_EMPLEADO,documentalCore.CAE_EMPLEADO,null,core.Security.user,idEmpleado),$(".wrapperDocumentacionEmpleado").show()})),$("body #listadoEmpleadosContratista").length&&$("body").on(core.helper.clickEventType,"#listadoEmpleadosContratista tr",(function(evt){evt.stopImmediatePropagation();var idEmpleado=window.tablelistadoEmpleadosContratista.row($(this).attr("id")).data().idempleado;contratista.idEmpleadoSeleccionado=idEmpleado,core.Files.Fichero.entidadId=idEmpleado,$("body .empleadoRequerimientosInfo").text("Requerimientos de "+window.tablelistadoEmpleadosContratista.row($(this).attr("id")).data().nombre),$("body .empleadoRequerimientosInfo").show(),$("body .wrapperDocumentacionEmpleado .mensajeInformacion").hide(),$("body #wrapperContratistaDocumentacionEmpleado").removeClass("d-none"),documentalCore.Listado.Cargar("wrapperContratistaDocumentacionEmpleado",documentalCore.ENTIDAD_EMPLEADO,documentalCore.CAE_EMPLEADO,null,core.Security.user,idEmpleado),$("body .btnAdjuntarFicheroDocumento").off(),$("body").on(core.helper.clickEventType,".btnAdjuntarFicheroDocumento",(async function(){documentalCore.idadministrador=null,documentalCore.idcomunidad=$(this).attr("data-idcomunidad"),documentalCore.idempresa=$(this).attr("data-idempresa"),documentalCore.idempleado=$(this).attr("data-idempleado"),documentalCore.idrequerimiento=$(this).attr("data-idrequerimiento"),documentalCore.idrelacionrequerimiento=$(this).attr("data-idrelacionrequerimiento"),documentalCore.entidad=$(this).attr("data-entidad");const{value:file}=await Swal.fire({title:"",html:Constantes.CargaDocumento,showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,didOpen:function(){core.Files.init()}})}))})),$("body").on(core.helper.clickEventType,".btnRequisitosPendientesCAE",(function(ev){$(".wrapperRequerimientosCAE").show(),$(".infoListado .seleccionado").html("")})),$("body").on(core.helper.clickEventType,".btnRequisitosPendientes",(function(ev){switch($("#listadoRequerimientosPendientes").hide(),$(this).attr("data-tipo")){case"cae":titulo="- CAE Comunidad";break;case"cae_empresa":titulo="- CAE Empresas";break;case"rgpd":titulo="- RGPD"}$(".infoListado .seleccionado").html(titulo),"rgpd"==$(this).attr("data-tipo")&&$(".wrapperRequerimientosCAE").hide(),documentalCore.Comunidad.renderTablaDocumentacionPendienteCAE($(this).attr("data-tipo"))})),$("body").on(core.helper.clickEventType,".btnVerHistorial",(function(e){var idRelacionRequerimiento=$(this).attr("data-idrelacionrequerimiento"),entidad=$(this).attr("data-entidad");documentalCore.Render.TablaHistorico(idRelacionRequerimiento,entidad)}))},uploadRequerimiento:async function(){var data=Object();data={idcomunidad:documentalCore.idcomunidad,idempresa:documentalCore.idempresa,idempleado:documentalCore.idempleado,idrequerimiento:documentalCore.idrequerimiento,idrelacionrequerimiento:documentalCore.idrelacionrequerimiento,idadministrador:documentalCore.idadministrador,entidad:documentalCore.entidad,fichero:core.Files.fichero},await apiFincatech.post(`requerimiento/${documentalCore.entidad}/${documentalCore.idrequerimiento}`,data).then(async response=>{console.log(response);var responseData=JSON.parse(response);"ok"==responseData.status.response?(CoreUI.Modal.Success("El documento se ha registrado correctamente"),empresaCore.renderTabla(),documentalCore.refreshTables.reloadTables()):Modal.Error("No se ha podido registrar el documento por el siguiente motivo:<br><br>"+responseData.status.response)})},uploadContratoConfidencialidadEmpleadoRGPD:async function(){var _titulo=$("body .tituloDocumentoRGPD").length?$("body .tituloDocumentoRGPD").val():"",_observaciones=$("body .observacionesDocumentoRGPD").length?$("body .observacionesDocumentoRGPD").val():"",data=Object();data={idrequerimiento:void 0===documentalCore.idrequerimiento?"-1":documentalCore.idrequerimiento,entidad:documentalCore.entidad,fichero:core.Files.fichero,titulo:_titulo,observaciones:_observaciones},await apiFincatech.post("rgpd/empleados/contratos/confidencialidad/create",data).then(async response=>{var responseData=JSON.parse(response);"ok"==responseData.status.response?(CoreUI.Modal.Success("El documento se ha registrado correctamente"),documentalCore.refreshTables.reloadTables()):CoreUI.Modal.Error("No se ha podido registrar el documento por el siguiente motivo:<br><br>"+responseData.status.response)})},refreshTables:{reloadTables:function(){documentalCore.refreshTables.reloadTable("listadoDocumentacionCertificadoDigital"),documentalCore.refreshTables.reloadTable("listadoComunidad"),documentalCore.refreshTables.reloadTable("listadoDocumentacionComunidad"),CoreUI.tableData.tableEventsClick("listadoDocumentacionComunidad"),documentalCore.refreshTables.reloadTable("listadoDocumentacionComunidadCAE"),documentalCore.refreshTables.reloadTable("listadoDocumentacionComunidadCae"),documentalCore.refreshTables.reloadTable("listadoDocumentacionBasica"),documentalCore.refreshTables.reloadTable("listadoEmpresa"),documentalCore.refreshTables.reloadTable("listadoEmpresasComunidad"),documentalCore.refreshTables.reloadTable("listadoDocumentacionEmpresa"),documentalCore.refreshTables.reloadTable("listadoEmpleadosComunidad"),documentalCore.refreshTables.reloadTable("listadoEmpleadosContratista"),documentalCore.refreshTables.reloadTable("listadoNotasInformativas"),documentalCore.refreshTables.reloadTable("listadoInformevaloracionseguimiento"),documentalCore.refreshTables.reloadTable("listadoDpd"),documentalCore.refreshTables.reloadTable("listadoContratosCesion"),documentalCore.refreshTables.reloadTable("listadoCamarasSeguridad"),documentalCore.refreshTables.reloadTable("listadoContratosCesion"),documentalCore.refreshTables.reloadTable("listadoRGPDEmpleadosAdministracion"),documentalCore.refreshTables.reloadTable("listadoRequerimientosPendientes"),"undefined"!=typeof rgpdCore&&rgpdCore.comprobarContratoAdministracionComunidad(core.modelId),"CONTRATISTA"==core.Security.getRole()&&(empresaCore.comprobarAceptacionOperatoria(core.Security.user,documentalCore.idcomunidad),$("body .wrapperListadoDocumentacionCAEEmpresa").length>0&&contratista.Model.ListarDocumentosEmpresa(),$("body .wrapperContratistaDocumentacionEmpleado").length>0&&documentalCore.Listado.Cargar("wrapperContratistaDocumentacionEmpleado",documentalCore.ENTIDAD_EMPLEADO,documentalCore.CAE_EMPLEADO,null,core.Security.user,contratista.idEmpleadoSeleccionado))},reloadTable:function(_tableName){$(`body #${_tableName}`).length>0&&void 0!==window[`table${_tableName}`]&&window[`table${_tableName}`].ajax.reload()}},uploadRequerimientoRGPD:async function(){var _titulo=$("body .tituloDocumentoRGPD").length?$("body .tituloDocumentoRGPD").val():"",_observaciones=$("body .observacionesDocumentoRGPD").length?$("body .observacionesDocumentoRGPD").val():"",data=Object();data={idcomunidad:documentalCore.idcomunidad,idrequerimiento:void 0===documentalCore.idrequerimiento?"-1":documentalCore.idrequerimiento,entidad:documentalCore.entidad,fichero:core.Files.fichero,titulo:_titulo,observaciones:_observaciones},await apiFincatech.post(`rgpd/${documentalCore.entidad}/${documentalCore.idcomunidad}/create`,data).then(async response=>{var responseData=JSON.parse(response);"ok"==responseData.status.response?(CoreUI.Modal.Success("El documento se ha registrado correctamente"),documentalCore.refreshTables.reloadTables()):Modal.Error("No se ha podido registrar el documento por el siguiente motivo:<br><br>"+responseData.status.response)})},Crud:{cambiarEstadoRequerimiento:async function(datos,_idEstado,_Observaciones,_fechaCaducidad){var _entidad=datos.entidad,_idrequerimiento=datos.idrelacionrequerimiento,data=Object();data.fechacaducidad=_fechaCaducidad,data.idestado=_idEstado,data.observaciones=_Observaciones,apiFincatech.post(`requerimiento/${_entidad}/${_idrequerimiento}/estado`,data).then(result=>{switch(_entidad){case"certificadorequerimiento":TecnicoCertificado.Render.ComunidadesDocumentacionAportada(TecnicoCertificado.Model.comunidadId);break;default:tecnicoRevision.GUI.RenderTablaDocumentosPendientesVerificacion(),Swal.close(),CoreUI.Modal.Success("El estado del requerimiento se ha modificado correctamente","Revisión documental")}})},uploadRequerimiento:async function(){},uploadRequerimientoRGPD:async function(){},deleteRequerimiento:function(){}},Listado:{Cargar:function(DOMElement,entidad,tipoRequerimiento,idComunidad=null,idEmpresa=null,idEmpleado=null){documentalCore.Model.GetAll(DOMElement,entidad,tipoRequerimiento,idComunidad,idEmpresa,idEmpleado)}},Model:{entidad:null,idrequerimiento:null,idcomunidad:null,idempleado:null,idempresa:null,comunidadcae:null,documentacionempresa:null,documentacionempleado:null,documentacionbasica:null,notasinformativas:null,informesvaloracionseguimiento:null,contratoscesionterceros:null,motivosRechazo:Array(),GetAll:function(DOMElDestination,entidad,tipoRequerimiento=null,idComunidad=null,idEmpresa=null,idEmpleado=null){var data=Object();data.idcomunidad=idComunidad,data.idempresa=idEmpresa,data.idusuario=core.Security.user,data.idempleado=idEmpleado,data.entidaddestino=entidad,data.tiporequerimiento=tipoRequerimiento,apiFincatech.post("documental/requerimientos",data).then(result=>{var datos=JSON.parse(result);documentalCore.Render.List(DOMElDestination,datos.data,tipoRequerimiento,entidad,idComunidad,idEmpresa,idEmpleado)})},Get:function(entidad,_requerimientoId){}},Helper:{reflejarDescargaFichero:function(idFichero,idComunidad,idEmpresa,idUsuario){var data=Object();data.idfichero=idFichero,data.idcomunidad=idComunidad,data.idempresa=idEmpresa,data.idusuario=idUsuario,apiFincatech.post("storage/descarga",data).then(result=>{$("body .btnSubidaFichero").show(),"CONTRATISTA"==core.Security.getRole()&&documentalCore.refreshTables.reloadTables()})},ComprobarDescargaRequerimientoPorEmpresa:function(idempresa,requerimiento,descargas){var resultado=!1;if(descargas.length>0)for(var iDescarga=0;iDescarga<descargas.length;iDescarga++)if(descargas[iDescarga].idempresa==idempresa){resultado=!0;break}return resultado}},Comunidad:{renderTablaDocumentacionComunidad:async function(id){""!=id&&void 0!==id&&null!=id&&$("#listadoDocumentacionComunidad").length&&(CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoDocumentacionComunidad","requerimiento","Requerimiento",null,"text-justify","70%"),CoreUI.tableData.addColumn("listadoDocumentacionComunidad",(function(row,type,val,meta){return null==row.idficherorequerimiento?'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>':'<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Subido</span>'}),"Estado",null,"text-center","10%"),CoreUI.tableData.addColumn("listadoDocumentacionComunidad",(function(row,type,val,meta){var ficheroAdjuntado=!1,htmlSalida="",estado="";return null!=row.idficherorequerimiento&&(ficheroAdjuntado=!0,htmlSalida+=`<a href="${config.baseURL}public/storage/${row.storagefichero}" class="btnDescargarFichero" download="${row.nombre}" target="_blank"><i class="bi bi-cloud-arrow-down" style="font-size:24px;"></i></a>`),"SUDO"!=core.Security.getRole()&&"ADMINFINCAS"!=core.Security.getRole()&&"TECNICOCAE"!=core.Security.getRole()||(htmlSalida+=`<a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento ml-2" data-toggle="tooltip" data-idcomunidad="${row.idcomunidad}" data-idempresa="" data-idempleado="" data-idrequerimiento="${row.idrequerimiento}" data-idrelacionrequerimiento="${row.idrelacion}" data-entidad="comunidad"><i class="bi bi-cloud-arrow-up text-success" style="font-size: 24px;"></i></a>`),htmlSalida}),"Fichero",null,"text-center","20%"),$("#listadoDocumentacionComunidad").addClass("no-clicable"),CoreUI.tableData.render("listadoDocumentacionComunidad","documentacioncomunidad",`comunidad/${id}/documentacioncomunidad`,!1,!1,!1))},renderTablaDocumentacionComunidadCAE:async function(id){if(""!=id&&void 0!==id&&null!=id&&$("#listadoDocumentacionComunidadCae").length){CoreUI.tableData.init(),CoreUI.tableData.columns=[];var tituloColumnaRequerimiento="Requerimiento";"CONTRATISTA"==core.Security.getRole()&&(tituloColumnaRequerimiento="Requerimiento (Descargue los documentos de este listado)"),CoreUI.tableData.addColumn("listadoDocumentacionComunidadCae","requerimiento",tituloColumnaRequerimiento,null,"text-justify","70%"),CoreUI.tableData.addColumn("listadoDocumentacionComunidadCae",(function(row,type,val,meta){return null==row.idficherorequerimiento?'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>':"CONTRATISTA"==core.Security.getRole()?documentalCore.Helper.ComprobarDescargaRequerimientoPorEmpresa(core.Security.user,row.idficherorequerimiento,row.descargas)?'<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Descargado</span>':'<span class="badge rounded-pill bg-warning pl-3 pr-3 pt-2 pb-2 d-block">Pendiente descarga</span>':'<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Subido</span>'}),"Estado",null,"text-center","10%"),CoreUI.tableData.addColumn("listadoDocumentacionComunidadCae",(function(row,type,val,meta){var ficheroAdjuntado=!1,htmlSalida='<div class="row mb-0 mx-auto" style="width:fit-content;">',estado="";return null!=row.idficherorequerimiento&&(ficheroAdjuntado=!0,htmlSalida+=`<div class="col text-center align-self-center p-0"><a href="${config.baseURL}public/storage/${row.storageficherorequerimiento}" class="btnDescargarFichero" data-idfichero="${row.idficherorequerimiento}" target="_blank" download="${row.nombreficherorequerimiento}" ><i class="bi bi-cloud-arrow-down" style="font-size:24px;"></i></a></div>`),"SUDO"!=core.Security.getRole()&&"ADMINFINCAS"!=core.Security.getRole()&&"TECNICOCAE"!=core.Security.getRole()||(htmlSalida+=`<div class="col text-center align-self-center p-0"><a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento ml-2" data-toggle="tooltip" data-idcomunidad="${row.idcomunidad}" data-idempresa="" data-idempleado="" data-idrequerimiento="${row.idrequerimiento}" data-idrelacionrequerimiento="${row.idrelacion}" data-entidad="comunidad"><i class="bi bi-cloud-arrow-up text-success" style="font-size: 24px;"></i></a></div>`),!0===row.historico&&(htmlSalida+=`\n                                <div class="col text-center align-self-center p-0">\n                                    <a href="javascript:void(0)" class="btnVerHistorial ml-2" data-toggle="tooltip" data-idrelacionrequerimiento="${row.idrelacion}" data-entidad="comunidadrequerimiento" title="Ver Histórico">\n                                        <i class="bi bi-clock-history text-danger" style="font-size: 18px;"></i>\n                                    </a>\n                                </div>`),htmlSalida+"</div>"}),"Fichero",null,"text-center","20%"),$("#listadoDocumentacionComunidadCae").addClass("no-clicable"),CoreUI.tableData.render("listadoDocumentacionComunidadCae","documentacioncomunidad",`comunidad/${id}/documentacioncomunidad`,!1,!1,!1)}},renderTablaDocumentacionComunidadCertificadoDigital:async function(id){if(""!=id&&void 0!==id&&null!=id&&$("#listadoDocumentacionCertificadoDigital").length){CoreUI.tableData.init(),CoreUI.tableData.columns=[];var tituloColumnaRequerimiento="Requerimiento";CoreUI.tableData.addColumn("listadoDocumentacionCertificadoDigital","requerimiento","Requerimiento",null,"text-justify","30%"),CoreUI.tableData.addColumn("listadoDocumentacionCertificadoDigital",(function(row,type,val,meta){var htmlSalida='<div class="row mb-0 mx-auto" style="width:fit-content;">';return htmlSalida+='<div class="col text-center align-self-center p-0">',null!=row.idfichero&&(htmlSalida+=`<a href="${config.baseURL}public/storage/${row.storagefichero}" data-idfichero="${row.idficherorequerimiento}" target="_blank" download="${row.nombrefichero}" ><i class="bi bi-cloud-arrow-down" style="font-size:24px;"></i></a>`),htmlSalida+"</div></div>"}),"Modelo",null,"text-center","10%"),CoreUI.tableData.addColumn("listadoDocumentacionCertificadoDigital",(function(row,type,val,meta){var fechaCaducidad=row.fechacaducidad;return fechaCaducidad?moment(fechaCaducidad).locale("es").format("L"):"No caduca"}),"Fecha de caducidad",null,"text-center","30%"),CoreUI.tableData.addColumn("listadoDocumentacionCertificadoDigital",(function(row,type,val,meta){if(null==row.idficherorequerimiento)return'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>';if(estadoDocumento=documentalCore.Render.RenderEstadoRequerimiento(row.idestado),7==row.idestado){var nElemento=documentalCore.Model.motivosRechazo.length;documentalCore.Model.motivosRechazo[nElemento]=row.observaciones,estadoDocumento+=`<a href="javascript:void(0);" class="btnVerMotivoRechazo" data-idmotivo="${nElemento}">ver motivo rechazo</a>`}return estadoDocumento}),"Estado",null,"text-center","10%"),CoreUI.tableData.addColumn("listadoDocumentacionCertificadoDigital",(function(row,type,val,meta){var ficheroAdjuntado=!1,htmlSalida='<div class="row mb-0 mx-auto" style="width:fit-content;">',estado="";return null!=row.idficherorequerimiento&&(ficheroAdjuntado=!0,htmlSalida+=`<div class="col text-center align-self-center p-0"><a href="${config.baseURL}public/storage/${row.storageficherorequerimiento}" class="btnDescargarFichero" data-idfichero="${row.idficherorequerimiento}" target="_blank" download="${row.nombreficherorequerimiento}" ><i class="bi bi-cloud-arrow-down" style="font-size:24px;"></i></a></div>`),"SUDO"!=core.Security.getRole()&&"ADMINFINCAS"!=core.Security.getRole()&&"TECNICOCERTIFICADO"!=core.Security.getRole()||(htmlSalida+=`<div class="col text-center align-self-center p-0"><a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento ml-2" data-toggle="tooltip" data-idcomunidad="${row.idcomunidad}" data-idempresa="" data-idempleado="" data-idrequerimiento="${row.idrequerimiento}" data-idrelacionrequerimiento="${row.idrelacion}" data-entidad="certificado"><i class="bi bi-cloud-arrow-up text-success" style="font-size: 24px;"></i></a></div>`),!0===row.historico&&(htmlSalida+=`\n                                <div class="col text-center align-self-center p-0">\n                                    <a href="javascript:void(0)" class="btnVerHistorial ml-2" data-toggle="tooltip" data-idrelacionrequerimiento="${row.idrelacion}" data-entidad="certificadorequerimiento" title="Ver Histórico">\n                                        <i class="bi bi-clock-history text-danger" style="font-size: 18px;"></i>\n                                    </a>\n                                </div>`),htmlSalida+"</div>"}),"Fichero",null,"text-center","20%"),$("#listadoDocumentacionCertificadoDigital").addClass("no-clicable"),CoreUI.tableData.render("listadoDocumentacionCertificadoDigital","documentacioncertificado",`comunidad/${id}/documentacioncertificado`,!1,!1,!1)}},renderTablaDocumentacionPendienteCAE:async function(tipoRequerimiento){if($("#listadoRequerimientosPendientes").length){CoreUI.tableData.init(),CoreUI.tableData.columns=[];var endpointTabla=`requerimiento/${tipoRequerimiento}/pendientes/list`,tituloColumna="Requerimiento pendiente "+tipoRequerimiento.toUpperCase();CoreUI.tableData.addColumn("listadoRequerimientosPendientes","codigocomunidad","CÓD",null,"text-left","30px"),CoreUI.tableData.addColumn("listadoRequerimientosPendientes","comunidad","Comunidad",null,"text-left"),CoreUI.tableData.addColumn("listadoRequerimientosPendientes","requerimiento",tituloColumna,null,"text-left"),CoreUI.tableData.render("listadoRequerimientosPendientes","pendientes",endpointTabla,!1,!0,!0,null,!0,!0,"comunidad").then(()=>{window.tablelistadoRequerimientosPendientes.table(0).columns(0).visible(!1),window.tablelistadoRequerimientosPendientes.table(0).columns(1).visible(!1)}),$("#listadoRequerimientosPendientes").show()}}},CAE:{verModalAdjuntarFichero:async function(idtiporequerimiento,idempresa){},renderTablaDocumentacionEmpleado:function(idEmpleado,tablaDestino){CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn(tablaDestino,"nombre","Nombre Requerimiento",null,"text-left"),CoreUI.tableData.addColumn(tablaDestino,(function(row,type,val,meta){return null==row.idficherorequerimiento?'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>':'<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Subido</span>'}),"Estado",null,"text-center","10%"),CoreUI.tableData.addColumn(tablaDestino,(function(row,type,val,meta){var ficheroAdjuntado=!1,htmlSalida="",estado="";return null!=row.idficherorequerimiento&&(ficheroAdjuntado=!0,htmlSalida+=`<a href="${config.baseURL}public/storage/${row.storagefichero}" target="_blank" download="${row.nombre}" ><i class="bi bi-cloud-arrow-down mr-2" style="font-size:24px;"></i></a>`),"CONTRATISTA"==core.Security.getRole()&&(htmlSalida+=`<a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" data-idcomunidad="" data-idempresa="" data-idempleado="${idEmpleado}" data-idrequerimiento="${row.idrequerimiento}" data-idrelacionrequerimiento="${row.idrelacion}" data-entidad="empleado"><i class="bi bi-cloud-arrow-up text-success" style="font-size: 24px;"></i></a>`),htmlSalida}),"Documento",null,"text-center","20%"),$("#"+tablaDestino).addClass("no-clicable"),CoreUI.tableData.render(tablaDestino,"documentacioncae",`empleado/${idEmpleado}/documentacion`,!1,!1,!1)}},PRL:{verModalAdjuntarFichero:async function(){}},RGPD:{eliminarDocumento:function(id,nombre,tipo){var destinoTablaHTML="";switch(tipo){case"camarasseguridad":destinoTablaHTML="listadoCamarasSeguridad";break;case"contratoscesion":destinoTablaHTML="listadoContratosCesion";break;case"rgpdempleado":destinoTablaHTML="listadoRGPDEmpleadosAdministracion"}core.Modelo.Delete("requerimiento/"+tipo,id,"",destinoTablaHTML,"Eliminar requerimiento",`¿Desea eliminar el requerimiento ${nombre}?`)},cargarDocumentacionCamarasSeguridad:async function(){return $(".wrapperDocumentosCamarasSeguridad")&&apiFincatech.get("rgpd/requerimiento/2/list").then(result=>{var documentos=JSON.parse(result),outputHTML='<div class="row">';for(x=0;x<documentos.data.Requerimiento.length;x++){var fDescarga=documentos.data.Requerimiento[x].ficheroscomunes[0].nombrestorage,nombreFichero=documentos.data.Requerimiento[x].ficheroscomunes[0].nombre;outputHTML+=`\n                                <div class="col-12 col-sm-4">\n                                    <a href="${config.baseURL}public/storage/${fDescarga}" target="_blank" download="${nombreFichero}">\n                                        <p class="m-0 d-inline-flex">\n                                            <i class="bi bi-cloud-arrow-down mr-2" style="font-size:24px;"></i>\n                                            <span class="align-self-center">${documentos.data.Requerimiento[x].nombre}</span>\n                                        </p>\n                                    </a>\n                                </div>\n                            `}outputHTML+="</div>",$(".wrapperDocumentosCamarasSeguridad").html(outputHTML)}),!0}},Render:{List:function(DOMElDestination,data,tipoRequerimiento,entidad,idComunidad=null,idEmpresa=null,idEmpleado=null){var headerHTML="",bodyHTML="",renderHTML="";$(`#${DOMElDestination} .contenido`).html(""),headerHTML='\n                    <div class="row text-uppercase mb-2" style="background-color: rgb(243, 240, 215);">\n                        <div class="col-3 text-left">\n                            <p class="m-0 pt-2 pb-2 font-weight-bold">Requerimiento</p>\n                        </div>\n                        <div class="col-2 text-center">\n                            <p class="m-0 pt-2 pb-2 font-weight-bold">Fecha última actuación</p>\n                        </div>\n                        <div class="col-3 text-center">\n                            <p class="m-0 pt-2 pb-2 font-weight-bold">Estado</p>\n                        </div>\n                        <div class="col-1 pt-2 pb-2">&nbsp;</div>\n                        <div class="col-1 pt-2 pb-2  align-self-center">&nbsp;</div>\n                        <div class="col-2 pt-2 pb-2">&nbsp;</div>\n                    </div>';for(var i=0;i<data.length;i++){var fechaSubida="",estadoDocumento,idRelacionRequerimiento=data[i].documentoasociado.id,enlaceFicheroDescarga="javascript:void(0);",enlaceFicheroDescargaNombre="",accionHistorial="";data[i].ficheroscomunes.length>0&&(enlaceFicheroDescarga=`${config.baseURL}public/storage/${data[i].ficheroscomunes[0].nombrestorage}`,enlaceFicheroDescargaNombre=data[i].ficheroscomunes[0].nombre);var accionDescarga=`<p class="m-0 fechaSubida text-center small">\n                                                <a href="${enlaceFicheroDescarga}" download="${enlaceFicheroDescargaNombre}" target="_blank" title="Ver documento">\n                                                    <i class="bi bi-cloud-arrow-down text-primary mr-1" style="font-size: 24px;"></i>\n                                                </a>\n                                            </p>`;!0===data[i].historico&&(accionHistorial=`\n                            <a href="javascript:void(0)" class="btnVerHistorial d-inline-block position-absolute mt-1 ml-3" data-toggle="tooltip" data-idrelacionrequerimiento="${data[i].documentoasociado.id}" data-entidad="${entidad}requerimiento" title="Ver Histórico">\n                                <i class="bi bi-clock-history text-danger" style="font-size: 18px;"></i>\n                            </a>                        \n                        `);var accionVerFichero="";if(void 0!==data[i].documentoasociado&&(null===data[i].documentoasociado.fechasubida?fechaSubida="No Disponible":(fechaSubida=moment(data[i].documentoasociado.fechasubida).locale("es").format("L"),accionVerFichero=`<p class="m-0 fechaSubida text-center small">\n                                                <a href="${config.baseURL}public/storage/${data[i].documentoasociado.nombrestorage}" class="text-success" download="${data[i].documentoasociado.nombre}">\n                                                    <i class="bi bi-file-earmark-arrow-down" style="font-size: 24px;"></i>\n                                                </a>\n                                                Subido el ${fechaSubida}\n                                            </p>`,idRelacionRequerimiento=data[i].documentoasociado.id),estadoDocumento=documentalCore.Render.RenderEstadoRequerimiento(data[i].documentoasociado.idestado),7==data[i].documentoasociado.idestado)){var nElemento=documentalCore.Model.motivosRechazo.length;documentalCore.Model.motivosRechazo[nElemento]=data[i].documentoasociado.observaciones,estadoDocumento+=`<a href="javascript:void(0);" class="btnVerMotivoRechazo" data-idmotivo="${nElemento}">ver motivo rechazo</a>`}tipoRequerimiento!=documentalCore.CAE_AUTONOMO&&tipoRequerimiento!=documentalCore.CAE_EMPRESA&&tipoRequerimiento!=documentalCore.CAE_COMUNIDAD&&tipoRequerimiento!=documentalCore.CAE_EMPLEADO||(accionDescarga="");var idRequerimiento=data[i].id,accionSubida="";"CONTRATISTA"==core.Security.getRole()&&(accionSubida=`<a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" data-idcomunidad="${idComunidad}" data-idempresa="${idEmpresa}" data-idempleado="${idEmpleado}" data-idrequerimiento="${idRequerimiento}" data-idrelacionrequerimiento="${idRelacionRequerimiento}" data-entidad="${entidad}" data-placement="bottom" title="" id="home" data-original-title="Adjuntar documento">\n                                        <i class="bi bi-cloud-arrow-up text-success" style="font-size: 24px;"></i>\n                                    </a>`),bodyHTML+=`\n                <div class="row">\n                    <div class="col-3 font-weight-light text-left">\n                        <p>${data[i].nombre}</p>\n                    </div>\n                    <div class="col-2 text-center font-weight-light">\n                        <p>${fechaSubida}</p>\n                    </div>\n                    <div class="col-3 text-center font-weight-light">\n                        <p>${estadoDocumento}</p>\n                    </div>\n                    <div class="col-1 text-center">${accionDescarga}</div>\n                    <div class="col-1 text-center  align-self-center p-0">${accionSubida}${accionHistorial}</div>\n                    <div class="col-2">${accionVerFichero} </div>\n                </div>`}renderHTML=headerHTML+bodyHTML,$(`#${DOMElDestination} .contenido`).html(renderHTML)},RenderEstadoRequerimiento:function(estado){var labelEstado,claseBG,claseText="text-white";switch(estado){case"1":labelEstado="No adjuntado",claseBG="danger";break;case"2":labelEstado="No descargado",claseBG="danger";break;case"3":labelEstado="Pendiente de verificación",claseBG="warning",claseText="text-dark";break;case"4":labelEstado="Verificado",claseBG="success";break;case"5":labelEstado="Descargado",claseBG="success";break;case"6":labelEstado="Verificado",claseBG="success";break;case"7":labelEstado="Rechazado",claseBG="danger"}return labelEstado=`<span class="badge rounded-pill ${claseText} bg-${claseBG} pl-3 pr-3 pt-2 pb-2 font-weight-light d-block">${labelEstado}</span>`},TablaHistorico:function(idRelacionRequerimiento,entidad){var html='\n            <div class="row">\n                <div class="col-12">\n                    <table class="table table-hover my-0 hs-tabla w-100 no-clicable" name="listadoHistoricoRequerimiento" id="listadoHistoricoRequerimiento" data-order=\'[[2, "desc"]]\'>\n                        <thead></thead><tbody></tbody>\n                    </table>\n                </div>\n            </div>';CoreUI.Modal.CustomHTML(html,"Histórico",(function(){documentalCore.renderTablaHistorico(idRelacionRequerimiento,entidad)}),"80%","row")},Table:{}},renderTablaHistorico:function(idRelacionRequerimiento,entidad){$("#listadoHistoricoRequerimiento").length&&(CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoHistoricoRequerimiento","nombre","Nombre documento",null,"text-justify"),CoreUI.tableData.addColumn("listadoHistoricoRequerimiento",(function(row,type,val,meta){var html;return`<span>${moment(row.created_at).locale("es").format("L")}</span>`}),"Fecha de subida",null,"text-center"),CoreUI.tableData.addColumn("listadoHistoricoRequerimiento",(function(row,type,val,meta){var html;return`<span>${moment(row.created).locale("es").format("L")}</span>`}),"Fecha Inclusión histórico",null,"text-center"),CoreUI.tableData.addColumn("listadoHistoricoRequerimiento",(function(row,type,val,meta){var enlaceDescarga;return`\n                        <a href="${config.baseURL}public/storage/${row.nombrestorage}" class="btnDescargarArchivo" data-idfichero="${row.idfichero}" download="${row.nombre}" target="_blank" title="Ver documento">\n                            <i class="bi bi-cloud-arrow-down text-primary mr-1" style="font-size: 24px;"></i>\n                        </a>                    \n                    `}),"&nbsp;",null,"text-center","10%"),$("#listadoHistoricoRequerimiento").addClass("no-clicable"),CoreUI.tableData.render("listadoHistoricoRequerimiento","Historico",`requerimiento/${entidad}/${idRelacionRequerimiento}/historico`,null,!1,!1))},renderTablaDocumentacionBasica:async function(){$("#listadoDocumentacionBasica").length&&(CoreUI.tableData.init(),CoreUI.tableData.columns=[],CoreUI.tableData.addColumn("listadoDocumentacionBasica","nombre","Nombre documento",null,"text-justify"),CoreUI.tableData.addColumn("listadoDocumentacionBasica",(function(row,type,val,meta){var canUploadFile=!1,salida="",requiereDescargaPrevia=row.requieredescarga,enlaceDescarga;("1"==row.requieredescarga&&"ADMINFINCAS"==core.Security.getRole()&&(canUploadFile=!0),ficheroAdjuntado=!!row.idficherorequerimiento,void 0!==row.ficheroscomunes[0])&&(salida+=` <td class="text-center">\n                                    <a href="${config.baseURL+"public/storage/"+row.ficheroscomunes[0].nombrestorage}" class="btnDescargarArchivo" data-idfichero="${row.idfichero}" download="${row.ficheroscomunes[0].nombre}" target="_blank" title="Ver documento">\n                                        <i class="bi bi-cloud-arrow-down text-primary mr-1" style="font-size: 24px;"></i>\n                                    </a>\n                                </td>`);return canUploadFile&&(dataset=` data-idcomunidad="${row.idcomunidad}" data-idempresa="" data-idempleado="" data-idrequerimiento="${row.idrequerimiento}" data-idrelacionrequerimiento="${row.idrelacion}" data-entidad="comunidad" `,salida+=`<td class="text-center" ><a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" ${dataset} data-placement="bottom" title="" id="home" data-original-title="Adjuntar documento"><i class="bi bi-cloud-arrow-up text-success" style="font-size: 24px;"></i></a></td>`),row.requiereDescargaPrevia,salida+="<td>&nbsp;</td>",ficheroAdjuntado||canUploadFile||(salida+="<td>&nbsp;</td>"),salida}),"FICHERO",null,"text-center"),$("#listadoDocumentacionBasica").addClass("no-clicable"),await CoreUI.tableData.render("listadoDocumentacionBasica","Requerimiento","rgpd/documentacionbasica",null,!1,!1))},renderTabla:async function(){if($("#listadoNotasinformativas").length){CoreUI.tableData.init(),CoreUI.tableData.columns=[];var html="data:created$";CoreUI.tableData.addColumn("listadoNotasinformativas",null,"Fecha",html,"text-center"),CoreUI.tableData.addColumn("listadoNotasinformativas","titulo","TITULO",null,"text-justify"),CoreUI.tableData.addColumn("listadoNotasinformativas","descripcion","NOTA",null,"text-justify");var html='<a href="'+config.baseURL+'public/storage/data:ficheroscomunes.nombrestorage$" download="data:ficheroscomunes.nombre$" target="_blank"><i class="bi bi-cloud-arrow-down" style="font-size:24px;"></i></a>';CoreUI.tableData.addColumn("listadoNotasinformativas",null,"Fichero",html,"text-center"),await CoreUI.tableData.render("listadoNotasinformativas","Notasinformativas","notasinformativas/list")}},reflejarDescargaFichero:function(idFichero,idComunidad,idEmpresa,idUsuario){var data=Object();data.idfichero=idFichero,data.idcomunidad=idComunidad,data.idempresa=idEmpresa,data.idusuario=idUsuario,apiFincatech.post("storage/descarga",data).then(result=>{console.log("Descarga reflejada"),$("body .btnSubidaFichero").show()})}};$(()=>{documentalCore.init()});