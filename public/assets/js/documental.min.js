let documentalCore={NotasInformativas:Object(),notainformativa:Object(),idrequerimiento:null,idcomunidad:null,idempleado:null,idempresa:null,entidad:null,init:async function(){$("#listadoNotasinformativas").length||(core.Files.init(),core.Files.Fichero.entidadId=core.modelId),$("#listadoDocumentacionBasica").length&&documentalCore.renderTablaDocumentacionBasica(),documentalCore.Events(),core.Files.init()},Events:function(){$("body .bntUploadDocumento").off(),$("body").on(core.helper.clickEventType,".bntUploadDocumento",(function(e){e.stopImmediatePropagation(),documentalCore.uploadRequerimiento()})),$("body .btnAdjuntarFicheroDocumento").off(),$("body").on(core.helper.clickEventType,".btnAdjuntarFicheroDocumento",(async function(){documentalCore.idcomunidad=$(this).attr("data-idcomunidad"),documentalCore.idempresa=$(this).attr("data-idempresa"),documentalCore.idempleado=$(this).attr("data-idempleado"),documentalCore.idrequerimiento=$(this).attr("data-idrequerimiento"),documentalCore.idrelacionrequerimiento=$(this).attr("data-idrelacionrequerimiento"),documentalCore.entidad=$(this).attr("data-entidad");const{value:file}=await Swal.fire({title:"",html:Constantes.CargaDocumento,showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,didOpen:function(){core.Files.init()}})})),$("body .btnAdjuntarDocumentoRGPD").off(),$("body").on(core.helper.clickEventType,".btnAdjuntarDocumentoRGPD",(async function(){documentalCore.idcomunidad=core.modelId,documentalCore.entidad=$(this).attr("data-tipo");const{value:file}=await Swal.fire({title:"",html:Constantes.CargaDocumentoRGPD,showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,didOpen:function(){core.Files.init()}})})),$("body .bntUploadDocumentoRGPD").off(),$("body").on(core.helper.clickEventType,".bntUploadDocumentoRGPD",(function(e){e.stopImmediatePropagation(),documentalCore.uploadRequerimientoRGPD()})),$("body").on(core.helper.clickEventType,".btnEliminarDocumentoRGPD",(function(e){var id=$(this).attr("data-id"),nombre=$(this).attr("data-nombre"),tipo=$(this).attr("data-tipo");documentalCore.RGPD.eliminarDocumento(id,nombre,tipo)}))},uploadRequerimiento:async function(){var data=Object();data={idcomunidad:documentalCore.idcomunidad,idempresa:documentalCore.idempresa,idempleado:documentalCore.idempleado,idrequerimiento:documentalCore.idrequerimiento,idrelacionrequerimiento:documentalCore.idrelacionrequerimiento,entidad:documentalCore.entidad,fichero:core.Files.fichero},await apiFincatech.post(`requerimiento/${documentalCore.entidad}/${documentalCore.idrequerimiento}`,data).then(async response=>{var responseData=JSON.parse(response);"ok"==responseData.status.response?(CoreUI.Modal.Success("El documento se ha registrado correctamente"),empresaCore.renderTabla(),$("body #listadoComunidad").length&&window.tablelistadoComunidad.ajax.reload(),$("body #listadoDocumentacionComunidad").length&&window.tablelistadoDocumentacionComunidad.ajax.reload(),$("body #listadoEmpresa").length&&window.tablelistadoEmpresa.ajax.reload(),$("body #listadoEmpleadosComunidad").length&&window.tablelistadoEmpleadosComunidad.ajax.reload()):Modal.Error("No se ha podido registrar el documento por el siguiente motivo:<br><br>"+responseData.status.response)})},uploadRequerimientoRGPD:async function(){var data=Object();data={idcomunidad:documentalCore.idcomunidad,idrequerimiento:documentalCore.idrequerimiento,entidad:documentalCore.entidad,fichero:core.Files.fichero,titulo:$("body .tituloDocumentoRGPD").val(),observaciones:$("body .observacionesDocumentoRGPD").val()},await apiFincatech.post(`rgpd/${documentalCore.entidad}/${documentalCore.idcomunidad}/create`,data).then(async response=>{var responseData=JSON.parse(response);"ok"==responseData.status.response?(CoreUI.Modal.Success("El documento se ha registrado correctamente"),$("body #listadoCamarasSeguridad").length&&window.tablelistadoCamarasSeguridad.ajax.reload(),$("body #listadoContratosCesion").length&&window.tablelistadoContratosCesion.ajax.reload()):Modal.Error("No se ha podido registrar el documento por el siguiente motivo:<br><br>"+responseData.status.response)})},Comunidad:{renderTablaDocumentacionComunidad:async function(id){""!=id&&void 0!==id&&null!=id&&$("#listadoDocumentacionComunidad").length&&(CoreUI.tableData.init(),CoreUI.tableData.addColumn("listadoDocumentacionComunidad","requerimiento","Documento",null,"text-justify","70%"),CoreUI.tableData.addColumn("listadoDocumentacionComunidad",(function(row,type,val,meta){return null==row.idficherorequerimiento?'<span class="badge rounded-pill bg-danger pl-3 pr-3 pt-2 pb-2 d-block">No adjuntado</span>':'<span class="badge rounded-pill bg-success pl-3 pr-3 pt-2 pb-2 d-block">Subido</span>'}),"Estado",null,"text-center","10%"),CoreUI.tableData.addColumn("listadoDocumentacionComunidad",(function(row,type,val,meta){var ficheroAdjuntado=!1,htmlSalida="",estado="";return null!=row.idficherorequerimiento&&(ficheroAdjuntado=!0,htmlSalida+=`<a href="${config.baseURL}public/storage/${row.storagefichero}" target="_blank"><i class="bi bi-cloud-arrow-down" style="font-size:24px;"></i></a>`),"SUDO"!=core.Security.getRole()&&"ADMINFINCAS"!=core.Security.getRole()||null!=row.idficherorequerimiento||(htmlSalida+=`<a href="javascript:void(0)" class="btnAdjuntarFicheroDocumento" data-toggle="tooltip" data-idcomunidad="${row.idcomunidad}" data-idempresa="" data-idempleado="" data-idrequerimiento="${row.idrequerimiento}" data-idrelacionrequerimiento="${row.idrelacion}" data-entidad="comunidad"><i class="bi bi-cloud-arrow-up text-success" style="font-size: 24px;"></i></a>`),htmlSalida}),"Documento",null,"text-center","20%"),$("#listadoDocumentacionComunidad").addClass("no-clicable"),CoreUI.tableData.render("listadoDocumentacionComunidad","documentacioncomunidad",`comunidad/${id}/documentacioncomunidad`))}},CAE:{verModalAdjuntarFichero:async function(idtiporequerimiento,idempresa){}},PRL:{verModalAdjuntarFichero:async function(){}},RGPD:{eliminarDocumento:function(id,nombre,tipo){var destinoTablaHTML="camarasseguridad"==tipo?"listadoCamarasSeguridad":"listadoContratosCesion";core.Modelo.Delete(tipo,id,nombre,destinoTablaHTML)}},renderTablaDocumentacionBasica:async function(){if($("#listadoDocumentacionBasica").length){CoreUI.tableData.init(),CoreUI.tableData.addColumn("listadoDocumentacionBasica","nombre","Nombre documento",null,"text-justify");var html='<a href="'+config.baseURL+'public/storage/data:ficheroscomunes.nombrestorage$" target="_blank"><i class="bi bi-cloud-arrow-down" style="font-size:24px;"></i></a>';CoreUI.tableData.addColumn("listadoDocumentacionBasica",null,"Fichero",html,"text-center"),$("#listadoDocumentacionBasica").addClass("no-clicable"),CoreUI.tableData.render("listadoDocumentacionBasica","Requerimiento","rgpd/documentacionbasica")}},renderTabla:async function(){if($("#listadoNotasinformativas").length){CoreUI.tableData.init();var html="data:created$";CoreUI.tableData.addColumn("listadoNotasinformativas",null,"Fecha",html,"text-center"),CoreUI.tableData.addColumn("listadoNotasinformativas","titulo","TITULO",null,"text-justify"),CoreUI.tableData.addColumn("listadoNotasinformativas","descripcion","NOTA",null,"text-justify");var html='<a href="'+config.baseURL+'public/storage/data:ficheroscomunes.nombrestorage$" target="_blank"><i class="bi bi-cloud-arrow-down" style="font-size:24px;"></i></a>';CoreUI.tableData.addColumn("listadoNotasinformativas",null,"Fichero",html,"text-center"),CoreUI.tableData.render("listadoNotasinformativas","Notasinformativas","notasinformativas/list")}}};$(()=>{documentalCore.init()});